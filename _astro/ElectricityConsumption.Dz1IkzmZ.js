import{S as fe,i as ge,s as ue,d as M,e as j,t as y,f as O,h as x,j as I,m as q,k as L,l as P,n as H,p as z,q as D,u as F,z as ee,A as te,w as me,B as Z,o as V,x as ie,r as B,y as pe,b as he,c as Ee,g as _e}from"./ECharts.BHMBe_i9.js";import{d as J}from"./dayjs.min.2rai63wT.js";import{E as Ae,a as b,U as X,A as p,b as K,c as Ce,d as be}from"./AggregationLevelSelection.CYrtkvwE.js";import{T as de}from"./Toggle.D1UBLrgt.js";import{B as ne}from"./ButtonsToggle.BqKfKY1x.js";import{i as ke,h as Q,m as Ie,k as se,l as v}from"./ChartLoadingSpinner.BMKMIXVW.js";import{g as we,a as Te,b as Ne}from"./random.DTBvWXaA.js";import"./index.CFpG30dg.js";const Re=(a,t)=>t===0?0:a*t/100;function Oe(a){let t,e;return t=new Ce({props:{aggregation:a[4],energyType:be.ELECTRICITY,layout:a[5],onclick:a[14]}}),{c(){F(t.$$.fragment)},l(o){z(t.$$.fragment,o)},m(o,f){q(t,o,f),e=!0},p(o,f){const s={};f&16&&(s.aggregation=o[4]),f&32&&(s.layout=o[5]),t.$set(s)},i(o){e||(O(t.$$.fragment,o),e=!0)},o(o){y(t.$$.fragment,o),e=!1},d(o){j(t,o)}}}function re(a){let t,e,o;function f(n){a[17](n)}let s={id:"showAverageToggle",label:"show average mark line"};return a[6]!==void 0&&(s.checked=a[6]),t=new de({props:s}),he.push(()=>Ee(t,"checked",f)),{c(){F(t.$$.fragment)},l(n){z(t.$$.fragment,n)},m(n,r){q(t,n,r),o=!0},p(n,r){const m={};!e&&r&64&&(e=!0,m.checked=n[6],_e(()=>e=!1)),t.$set(m)},i(n){o||(O(t.$$.fragment,n),o=!0)},o(n){y(t.$$.fragment,n),o=!1},d(n){j(t,n)}}}function oe(a){let t,e,o="Reference power amount",f,s,n;return s=new ne({props:{name:"reference-power-toggle",selected:a[10],onchange:a[13],list:a[11]}}),{c(){t=D("div"),e=D("span"),e.textContent=o,f=B(),F(s.$$.fragment),this.h()},l(r){t=P(r,"DIV",{class:!0});var m=H(t);e=P(m,"SPAN",{"data-svelte-h":!0}),Z(e)!=="svelte-ukeiym"&&(e.textContent=o),f=V(m),z(s.$$.fragment,m),m.forEach(M),this.h()},h(){L(t,"class","flex flex-col items-center gap-2 md:flex-row")},m(r,m){x(r,t,m),I(t,e),I(t,f),q(s,t,null),n=!0},p(r,m){const u={};m&1024&&(u.selected=r[10]),m&2048&&(u.list=r[11]),s.$set(u)},i(r){n||(O(s.$$.fragment,r),n=!0)},o(r){y(s.$$.fragment,r),n=!1},d(r){r&&M(t),j(s)}}}function Pe(a){let t,e,o,f,s="Consumption",n,r,m,u,T,w,d,g="Data started at:",R,k,S=se(a[7])+"",_,Y;r=new ne({props:{name:"chart-type-toggle",selected:a[0],onchange:a[12],list:[{label:"Exceedance",value:b.EXCEEDANCE},{label:"Measured",value:b.PLAIN},{label:"Repartition",value:b.REPARTITION}]}});let l=a[0]===b.PLAIN&&re(a),i=a[0]===b.EXCEEDANCE&&oe(a);return{c(){t=D("div"),e=D("div"),o=D("div"),f=D("span"),f.textContent=s,n=B(),F(r.$$.fragment),m=B(),l&&l.c(),u=B(),i&&i.c(),T=B(),w=D("div"),d=D("span"),d.textContent=g,R=B(),k=D("span"),_=pe(S),this.h()},l(h){t=P(h,"DIV",{class:!0});var E=H(t);e=P(E,"DIV",{class:!0});var N=H(e);o=P(N,"DIV",{class:!0});var U=H(o);f=P(U,"SPAN",{"data-svelte-h":!0}),Z(f)!=="svelte-1vrp2az"&&(f.textContent=s),n=V(U),z(r.$$.fragment,U),U.forEach(M),m=V(N),l&&l.l(N),u=V(N),i&&i.l(N),N.forEach(M),T=V(E),w=P(E,"DIV",{class:!0});var W=H(w);d=P(W,"SPAN",{"data-svelte-h":!0}),Z(d)!=="svelte-1cta1ja"&&(d.textContent=g),R=V(W),k=P(W,"SPAN",{class:!0});var G=H(k);_=ie(G,S),G.forEach(M),W.forEach(M),E.forEach(M),this.h()},h(){L(o,"class","flex flex-col items-center gap-2 md:flex-row"),L(e,"class","flex flex-col items-center gap-4 lg:flex-row"),L(k,"class","font-semibold"),L(w,"class","flex items-center gap-1 text-sm"),L(t,"class","flex flex-col-reverse items-center gap-4 py-4 lg:flex-row lg:justify-between lg:gap-0 lg:py-2")},m(h,E){x(h,t,E),I(t,e),I(e,o),I(o,f),I(o,n),q(r,o,null),I(e,m),l&&l.m(e,null),I(e,u),i&&i.m(e,null),I(t,T),I(t,w),I(w,d),I(w,R),I(w,k),I(k,_),Y=!0},p(h,E){const N={};E&1&&(N.selected=h[0]),r.$set(N),h[0]===b.PLAIN?l?(l.p(h,E),E&1&&O(l,1)):(l=re(h),l.c(),O(l,1),l.m(e,u)):l&&(ee(),y(l,1,1,()=>{l=null}),te()),h[0]===b.EXCEEDANCE?i?(i.p(h,E),E&1&&O(i,1)):(i=oe(h),i.c(),O(i,1),i.m(e,null)):i&&(ee(),y(i,1,1,()=>{i=null}),te()),(!Y||E&128)&&S!==(S=se(h[7])+"")&&me(_,S)},i(h){Y||(O(r.$$.fragment,h),O(l),O(i),Y=!0)},o(h){y(r.$$.fragment,h),y(l),y(i),Y=!1},d(h){h&&M(t),j(r),l&&l.d(),i&&i.d()}}}function De(a){let t,e,o,f;return o=new Ae({props:{type:a[0],color:a[1],labels:a[2],unit:a[3],aggregation:a[4],timeseries:a[8],referencePower:a[9],showAverageMarkline:a[6],onclick:a[15],$$slots:{footer:[Pe],headerActions:[Oe]},$$scope:{ctx:a}}}),{c(){t=D("div"),e=D("div"),F(o.$$.fragment),this.h()},l(s){t=P(s,"DIV",{class:!0});var n=H(t);e=P(n,"DIV",{class:!0});var r=H(e);z(o.$$.fragment,r),r.forEach(M),n.forEach(M),this.h()},h(){L(e,"class","absolute top-0 right-0 bottom-0 left-0"),L(t,"class","relative grow")},m(s,n){x(s,t,n),I(t,e),q(o,e,null),f=!0},p(s,[n]){const r={};n&1&&(r.type=s[0]),n&2&&(r.color=s[1]),n&4&&(r.labels=s[2]),n&8&&(r.unit=s[3]),n&16&&(r.aggregation=s[4]),n&256&&(r.timeseries=s[8]),n&512&&(r.referencePower=s[9]),n&64&&(r.showAverageMarkline=s[6]),n&16780529&&(r.$$scope={dirty:n,ctx:s}),o.$set(r)},i(s){f||(O(o.$$.fragment,s),f=!0)},o(s){y(o.$$.fragment,s),f=!1},d(s){s&&M(t),j(o)}}}function Me(a,t,e){const o={[`${b.PLAIN}`]:["Consumption"],[`${b.EXCEEDANCE}`]:["Consumption","Exceedance"],[`${b.REPARTITION}`]:["Shared with me","Bought from market"]},f={[`${b.PLAIN}`]:[Q],[`${b.EXCEEDANCE}`]:[Q,Ie],[`${b.REPARTITION}`]:[ke,Q]};let s=b.PLAIN,n=f[s],r=o[s],m=X.KWH,u=p.MONTH,T=K.YEAR,w=!1,d,g=[],R=[],k="0",S=[],{data:_}=t;const Y=c=>{e(0,s=b.PLAIN),e(3,m=X.KWH),e(4,u=p.MONTH),e(5,T=K.YEAR),e(8,g=c.months.plain),e(7,d=g[0].startedAt),e(1,n=f[s]),e(2,r=o[s]),E(),console.log("ElectricityConsumption.onData",c)},l=c=>{const C=s===b.REPARTITION?"repartition":"plain";return c[C]},i=c=>{e(0,s=c),e(3,m=X.KWH),e(6,w=!1),e(4,u=p.MONTH),e(5,T=K.YEAR),e(8,g=l(_.months)),e(7,d=g[0].startedAt),e(1,n=f[s]),e(2,r=o[s]),E()},h=c=>{if(e(10,k=c),console.log("ElectricityConsumption.onReferencePowerAmountChange ",k),k==="0"){e(9,R=[]);return}N()},E=()=>{if(s!==b.EXCEEDANCE){e(10,k="0"),e(9,R=[]),e(11,S=[]);return}const c=g.length;let C=3;c<=6?C=1:c<=12&&(C=2),e(11,S=[{label:"None",value:"0"}]);for(let A=1;A<=C;A++)S.push({value:String(A)});Number(k)>C&&e(10,k=String(C)),N()},N=()=>{const c=Number(k);if(c<1)return;const C=we(g,c);e(9,R=C.map(({startedAt:ae,value:le},ce)=>{const $=10*ce;return{startedAt:ae,value:Re(le,Ne(50-$,80-$))}}));const A=Te();A&&e(9,R[0].startedAt=void 0,R),console.log("ElectricityConsumption.defineReferencePower ",{amount:c,startAtBeginning:A,referencePower:R,selectedTimeseries:C})},U=(c,C)=>{if(e(3,m=X.KWH),C===K.YEAR){switch(c){case p.MONTH:e(8,g=l(_.months));break;case p.WEEK:e(8,g=l(_.weeks));break}e(7,d=g[0].startedAt),e(4,u=c),e(5,T=C),E();return}let A=v(J(d).startOf("month"));switch(c){case p.WEEK:e(8,g=l(_.weeksMap[A]));break;case p.DAY:e(8,g=l(_.daysMap[A]));break;case p.HOUR:A=v(d),e(8,g=l(_.hoursMap[A]));break}e(7,d=g[0].startedAt),e(4,u=c),e(5,T=C),E()},W=c=>{const{startedAt:C}=c;let A=v(C);if(console.log("ElectricityConsumption.onChartClick timeserie",c),T===K.YEAR){switch(u){case p.MONTH:e(4,u=p.WEEK),e(8,g=l(_.weeksMap[A]));break;case p.WEEK:A=v(J(C).startOf("month")),e(4,u=p.DAY),e(8,g=l(_.daysMap[A]));break}e(7,d=g[0].startedAt),e(5,T=K.MONTH),E();return}switch(u){case p.WEEK:A=v(J(C).startOf("month")),e(4,u=p.DAY),e(8,g=l(_.daysMap[A]));break;case p.DAY:e(4,u=p.HOUR),e(8,g=l(_.hoursMap[A]));break;case p.HOUR:e(4,u=p.MINUTES),e(8,g=l(_.minutesMap[A])),e(3,m=X.KW);break}e(7,d=g[0].startedAt),[p.HOUR,p.MINUTES].includes(u)&&e(5,T=K.DAY),u!==p.MINUTES&&E()};function G(c){w=c,e(6,w)}return a.$$set=c=>{"data"in c&&e(16,_=c.data)},a.$$.update=()=>{a.$$.dirty&65536&&Y(_)},[s,n,r,m,u,T,w,d,g,R,k,S,i,h,U,W,_,G]}class Ve extends fe{constructor(t){super(),ge(this,t,Me,De,ue,{data:16})}}export{Ve as default};
