import{S as Q,i as Z,s as x,d as R,e as U,t as P,f as S,h as J,j as I,m as V,k as y,l as N,n as L,p as B,q as O,u as j,z as $,A as ee,w as te,B as z,o as K,x as se,r as W,y as re,b as oe,c as ae,g as ne}from"./ECharts.BHMBe_i9.js";import{d as v}from"./dayjs.min.2rai63wT.js";import{E as le,a as C,U as H,A as m,b as D,c as ce,d as ge}from"./AggregationLevelSelection.Cz1HVrHE.js";import{T as fe}from"./Toggle.D1UBLrgt.js";import{B as ue}from"./ButtonsToggle.Du77g_Yb.js";import{i as me,h as X,m as ie,k as F,l as Y}from"./ChartLoadingSpinner.Brhcwbht.js";import"./index.CFpG30dg.js";function pe(n){let t,e;return t=new ce({props:{aggregation:n[4],energyType:ge.ELECTRICITY,layout:n[5],onclick:n[10]}}),{c(){j(t.$$.fragment)},l(s){B(t.$$.fragment,s)},m(s,g){V(t,s,g),e=!0},p(s,g){const r={};g&16&&(r.aggregation=s[4]),g&32&&(r.layout=s[5]),t.$set(r)},i(s){e||(S(t.$$.fragment,s),e=!0)},o(s){P(t.$$.fragment,s),e=!1},d(s){U(t,s)}}}function G(n){let t,e,s;function g(o){n[13](o)}let r={id:"showAverageToggle",label:"show average mark line"};return n[6]!==void 0&&(r.checked=n[6]),t=new fe({props:r}),oe.push(()=>ae(t,"checked",g)),{c(){j(t.$$.fragment)},l(o){B(t.$$.fragment,o)},m(o,a){V(t,o,a),s=!0},p(o,a){const b={};!e&&a&64&&(e=!0,b.checked=o[6],ne(()=>e=!1)),t.$set(b)},i(o){s||(S(t.$$.fragment,o),s=!0)},o(o){P(t.$$.fragment,o),s=!1},d(o){U(t,o)}}}function he(n){let t,e,s,g,r="Consumption",o,a,b,i,p,T,k="Data started at:",c,u,w=F(n[7])+"",_,M;a=new ue({props:{name:"buttons-toggle",selected:n[0],onchange:n[9],list:[{label:"Measured",value:C.PLAIN},{label:"Repartition",value:C.REPARTITION},{label:"Exceedance",value:C.EXCEEDANCE,disabled:!0}]}});let f=n[0]===C.PLAIN&&G(n);return{c(){t=O("div"),e=O("div"),s=O("div"),g=O("span"),g.textContent=r,o=W(),j(a.$$.fragment),b=W(),f&&f.c(),i=W(),p=O("div"),T=O("span"),T.textContent=k,c=W(),u=O("span"),_=re(w),this.h()},l(h){t=N(h,"DIV",{class:!0});var d=L(t);e=N(d,"DIV",{class:!0});var l=L(e);s=N(l,"DIV",{class:!0});var A=L(s);g=N(A,"SPAN",{"data-svelte-h":!0}),z(g)!=="svelte-1vrp2az"&&(g.textContent=r),o=K(A),B(a.$$.fragment,A),A.forEach(R),b=K(l),f&&f.l(l),l.forEach(R),i=K(d),p=N(d,"DIV",{class:!0});var E=L(p);T=N(E,"SPAN",{"data-svelte-h":!0}),z(T)!=="svelte-1cta1ja"&&(T.textContent=k),c=K(E),u=N(E,"SPAN",{class:!0});var q=L(u);_=se(q,w),q.forEach(R),E.forEach(R),d.forEach(R),this.h()},h(){y(s,"class","flex flex-col items-center gap-2 md:flex-row"),y(e,"class","flex flex-col items-center gap-4 lg:flex-row"),y(u,"class","font-semibold"),y(p,"class","flex items-center gap-1 text-sm"),y(t,"class","flex flex-col-reverse items-center gap-4 py-4 lg:flex-row lg:justify-between lg:gap-0 lg:py-2")},m(h,d){J(h,t,d),I(t,e),I(e,s),I(s,g),I(s,o),V(a,s,null),I(e,b),f&&f.m(e,null),I(t,i),I(t,p),I(p,T),I(p,c),I(p,u),I(u,_),M=!0},p(h,d){const l={};d&1&&(l.selected=h[0]),a.$set(l),h[0]===C.PLAIN?f?(f.p(h,d),d&1&&S(f,1)):(f=G(h),f.c(),S(f,1),f.m(e,null)):f&&($(),P(f,1,1,()=>{f=null}),ee()),(!M||d&128)&&w!==(w=F(h[7])+"")&&te(_,w)},i(h){M||(S(a.$$.fragment,h),S(f),M=!0)},o(h){P(a.$$.fragment,h),P(f),M=!1},d(h){h&&R(t),U(a),f&&f.d()}}}function Ee(n){let t,e,s,g;return s=new le({props:{type:n[0],color:n[1],labels:n[2],unit:n[3],aggregation:n[4],timeseries:n[8],showAverageMarkline:n[6],onclick:n[11],$$slots:{footer:[he],headerActions:[pe]},$$scope:{ctx:n}}}),{c(){t=O("div"),e=O("div"),j(s.$$.fragment),this.h()},l(r){t=N(r,"DIV",{class:!0});var o=L(t);e=N(o,"DIV",{class:!0});var a=L(e);B(s.$$.fragment,a),a.forEach(R),o.forEach(R),this.h()},h(){y(e,"class","absolute top-0 right-0 bottom-0 left-0"),y(t,"class","relative grow")},m(r,o){J(r,t,o),I(t,e),V(s,e,null),g=!0},p(r,[o]){const a={};o&1&&(a.type=r[0]),o&2&&(a.color=r[1]),o&4&&(a.labels=r[2]),o&8&&(a.unit=r[3]),o&16&&(a.aggregation=r[4]),o&256&&(a.timeseries=r[8]),o&64&&(a.showAverageMarkline=r[6]),o&262385&&(a.$$scope={dirty:o,ctx:r}),s.$set(a)},i(r){g||(S(s.$$.fragment,r),g=!0)},o(r){P(s.$$.fragment,r),g=!1},d(r){r&&R(t),U(s)}}}function _e(n,t,e){const s={[`${C.PLAIN}`]:["Consumption","Exceedance"],[`${C.EXCEEDANCE}`]:["Consumption","Exceedance"],[`${C.REPARTITION}`]:["Shared with me","Bought from market"]},g={[`${C.PLAIN}`]:[X],[`${C.EXCEEDANCE}`]:[X,ie],[`${C.REPARTITION}`]:[me,X]};let r=C.PLAIN,o=g[r],a=s[r],b=H.KWH,i=m.MONTH,p=D.YEAR,T=!1,k,c=[],{data:u}=t;const w=l=>{e(0,r=C.PLAIN),e(3,b=H.KWH),e(4,i=m.MONTH),e(5,p=D.YEAR),e(8,c=l.months.plain),e(7,k=c[0].startedAt),e(1,o=g[r]),e(2,a=s[r]),console.log("ElectricityConsumption.onData",l)},_=l=>{const A=r===C.REPARTITION?"repartition":"plain";return l[A]},M=l=>{e(0,r=l),e(3,b=H.KWH),e(6,T=!1),e(4,i=m.MONTH),e(5,p=D.YEAR),e(8,c=_(u.months)),e(7,k=c[0].startedAt),e(1,o=g[r]),e(2,a=s[r])},f=(l,A)=>{if(e(3,b=H.KWH),A===D.YEAR){switch(l){case m.MONTH:e(8,c=_(u.months));break;case m.WEEK:e(8,c=_(u.weeks));break}e(7,k=c[0].startedAt),e(4,i=l),e(5,p=A);return}let E=Y(v(k).startOf("month"));switch(l){case m.WEEK:e(8,c=_(u.weeksMap[E]));break;case m.DAY:e(8,c=_(u.daysMap[E]));break;case m.HOUR:E=Y(k),e(8,c=_(u.hoursMap[E]));break}e(7,k=c[0].startedAt),e(4,i=l),e(5,p=A)},h=l=>{const{startedAt:A}=l;let E=Y(A);if(console.log("ElectricityConsumption.onChartClick timeserie",l),p===D.YEAR){switch(i){case m.MONTH:e(4,i=m.WEEK),e(8,c=_(u.weeksMap[E]));break;case m.WEEK:E=Y(v(A).startOf("month")),e(4,i=m.DAY),e(8,c=_(u.daysMap[E]));break}e(7,k=c[0].startedAt),e(5,p=D.MONTH);return}switch(i){case m.WEEK:E=Y(v(A).startOf("month")),e(4,i=m.DAY),e(8,c=_(u.daysMap[E]));break;case m.DAY:e(4,i=m.HOUR),e(8,c=_(u.hoursMap[E]));break;case m.HOUR:e(4,i=m.MINUTES),e(8,c=_(u.minutesMap[E])),e(3,b=H.KW);break}e(7,k=c[0].startedAt),[m.HOUR,m.MINUTES].includes(i)&&e(5,p=D.DAY)};function d(l){T=l,e(6,T)}return n.$$set=l=>{"data"in l&&e(12,u=l.data)},n.$$.update=()=>{n.$$.dirty&4096&&w(u)},[r,o,a,b,i,p,T,k,c,M,f,h,u,d]}class Ne extends Q{constructor(t){super(),Z(this,t,_e,Ee,x,{data:12})}}export{Ne as default};
