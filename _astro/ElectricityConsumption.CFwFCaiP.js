import{S as Q,i as Z,s as x,d as R,e as V,t as S,f as y,h as J,j as k,m as j,k as M,l as N,n as D,p as v,q as O,u as B,z as $,w as ee,A as z,o as K,x as te,r as W,y as se,b as re,c as oe,g as ae,B as ne}from"./ECharts.CpYfIO0D.js";import{d as X}from"./dayjs.min.2rai63wT.js";import{E as le,a as C,U as H,A as i,b as P,c as ce,d as ge}from"./AggregationLevelSelection.DG3xjRA_.js";import{T as fe}from"./Toggle.DSrT7CON.js";import{B as ue}from"./ButtonsToggle.DFVURX4c.js";import{h as U,i as F,j as ie,k as me,l as Y}from"./ChartLoadingSpinner.CgSIGXi5.js";import"./index.DACIwEDX.js";function pe(n){let t,e;return t=new ce({props:{aggregation:n[4],energyType:ge.ELECTRICITY,layout:n[5],onclick:n[10]}}),{c(){B(t.$$.fragment)},l(s){v(t.$$.fragment,s)},m(s,f){j(t,s,f),e=!0},p(s,f){const r={};f&16&&(r.aggregation=s[4]),f&32&&(r.layout=s[5]),t.$set(r)},i(s){e||(y(t.$$.fragment,s),e=!0)},o(s){S(t.$$.fragment,s),e=!1},d(s){V(t,s)}}}function G(n){let t,e,s;function f(o){n[13](o)}let r={id:"showAverageToggle",label:"show average mark line"};return n[6]!==void 0&&(r.checked=n[6]),t=new fe({props:r}),re.push(()=>oe(t,"checked",f)),{c(){B(t.$$.fragment)},l(o){v(t.$$.fragment,o)},m(o,a){j(t,o,a),s=!0},p(o,a){const I={};!e&&a&64&&(e=!0,I.checked=o[6],ae(()=>e=!1)),t.$set(I)},i(o){s||(y(t.$$.fragment,o),s=!0)},o(o){S(t.$$.fragment,o),s=!1},d(o){V(t,o)}}}function he(n){let t,e,s,f,r="Consumption",o,a,I,m,E,T,b="Data started at:",c,u,w=F(n[7])+"",_,L;a=new ue({props:{name:"buttons-toggle",selected:n[0],onchange:n[9],list:[{label:"Measured",value:C.PLAIN},{label:"Repartition",value:C.REPARTITION},{label:"Exceedance",value:C.EXCEEDANCE,disabled:!0}]}});let g=n[0]===C.PLAIN&&G(n);return{c(){t=O("div"),e=O("div"),s=O("div"),f=O("span"),f.textContent=r,o=W(),B(a.$$.fragment),I=W(),g&&g.c(),m=W(),E=O("div"),T=O("span"),T.textContent=b,c=W(),u=O("span"),_=se(w),this.h()},l(p){t=N(p,"DIV",{class:!0});var d=D(t);e=N(d,"DIV",{class:!0});var l=D(e);s=N(l,"DIV",{class:!0});var A=D(s);f=N(A,"SPAN",{"data-svelte-h":!0}),z(f)!=="svelte-1vrp2az"&&(f.textContent=r),o=K(A),v(a.$$.fragment,A),A.forEach(R),I=K(l),g&&g.l(l),l.forEach(R),m=K(d),E=N(d,"DIV",{class:!0});var h=D(E);T=N(h,"SPAN",{"data-svelte-h":!0}),z(T)!=="svelte-1cta1ja"&&(T.textContent=b),c=K(h),u=N(h,"SPAN",{class:!0});var q=D(u);_=te(q,w),q.forEach(R),h.forEach(R),d.forEach(R),this.h()},h(){M(s,"class","flex flex-col items-center gap-2 md:flex-row"),M(e,"class","flex flex-col items-center gap-4 lg:flex-row"),M(u,"class","font-semibold"),M(E,"class","flex items-center gap-1 text-sm"),M(t,"class","flex flex-col-reverse items-center gap-4 py-4 lg:flex-row lg:justify-between lg:gap-0 lg:py-2")},m(p,d){J(p,t,d),k(t,e),k(e,s),k(s,f),k(s,o),j(a,s,null),k(e,I),g&&g.m(e,null),k(t,m),k(t,E),k(E,T),k(E,c),k(E,u),k(u,_),L=!0},p(p,d){const l={};d&1&&(l.selected=p[0]),a.$set(l),p[0]===C.PLAIN?g?(g.p(p,d),d&1&&y(g,1)):(g=G(p),g.c(),y(g,1),g.m(e,null)):g&&(ne(),S(g,1,1,()=>{g=null}),$()),(!L||d&128)&&w!==(w=F(p[7])+"")&&ee(_,w)},i(p){L||(y(a.$$.fragment,p),y(g),L=!0)},o(p){S(a.$$.fragment,p),S(g),L=!1},d(p){p&&R(t),V(a),g&&g.d()}}}function Ee(n){let t,e,s,f;return s=new le({props:{type:n[0],color:n[1],labels:n[2],unit:n[3],aggregation:n[4],timeseries:n[8],showAverageMarkline:n[6],onclick:n[11],$$slots:{footer:[he],headerActions:[pe]},$$scope:{ctx:n}}}),{c(){t=O("div"),e=O("div"),B(s.$$.fragment),this.h()},l(r){t=N(r,"DIV",{class:!0});var o=D(t);e=N(o,"DIV",{class:!0});var a=D(e);v(s.$$.fragment,a),a.forEach(R),o.forEach(R),this.h()},h(){M(e,"class","absolute top-0 right-0 bottom-0 left-0"),M(t,"class","relative grow")},m(r,o){J(r,t,o),k(t,e),j(s,e,null),f=!0},p(r,[o]){const a={};o&1&&(a.type=r[0]),o&2&&(a.color=r[1]),o&4&&(a.labels=r[2]),o&8&&(a.unit=r[3]),o&16&&(a.aggregation=r[4]),o&256&&(a.timeseries=r[8]),o&64&&(a.showAverageMarkline=r[6]),o&262385&&(a.$$scope={dirty:o,ctx:r}),s.$set(a)},i(r){f||(y(s.$$.fragment,r),f=!0)},o(r){S(s.$$.fragment,r),f=!1},d(r){r&&R(t),V(s)}}}function _e(n,t,e){const s={[`${C.PLAIN}`]:["Consumption","Exceedance"],[`${C.PLAIN}_EXCEEDANCE`]:["Consumption","Exceedance"],[`${C.REPARTITION}`]:["Shared with me","Bought from market"]},f={[`${C.PLAIN}`]:[U],[`${C.PLAIN}_EXCEEDANCE`]:[U,me],[`${C.REPARTITION}`]:[ie,U]};let r=C.PLAIN,o=[U],a=["Consumption","Exceedance"],I=H.KWH,m=i.MONTH,E=P.YEAR,T=!1,b,c=[],{data:u}=t;const w=l=>{e(0,r=C.PLAIN),e(3,I=H.KWH),e(4,m=i.MONTH),e(8,c=l.months.plain),e(7,b=c[0].startedAt),e(1,o=f[r]),e(2,a=s[r]),console.log("ElectricityConsumption.onData",l)},_=l=>{const A=r===C.REPARTITION?"repartition":"plain";return l[A]},L=l=>{e(0,r=l),e(3,I=H.KWH),e(6,T=!1),e(4,m=i.MONTH),e(5,E=P.YEAR),e(8,c=_(u.months)),e(7,b=c[0].startedAt),e(1,o=f[r]),e(2,a=s[r])},g=(l,A)=>{if(e(3,I=H.KWH),A===P.YEAR){switch(l){case i.MONTH:e(8,c=_(u.months));break;case i.WEEK:e(8,c=_(u.weeks));break}e(7,b=c[0].startedAt),e(4,m=l),e(5,E=A);return}let h=Y(X(b).startOf("month"));switch(l){case i.WEEK:e(8,c=_(u.weeksMap[h]));break;case i.DAY:e(8,c=_(u.daysMap[h]));break;case i.HOUR:h=Y(b),e(8,c=_(u.hoursMap[h]));break}e(7,b=c[0].startedAt),e(4,m=l),e(5,E=A)},p=l=>{const{startedAt:A}=l;let h=Y(A);if(console.log("ElectricityConsumption.onChartClick timeserie",l),E===P.YEAR){switch(m){case i.MONTH:e(4,m=i.WEEK),e(8,c=_(u.weeksMap[h]));break;case i.WEEK:h=Y(X(A).startOf("month")),e(4,m=i.DAY),e(8,c=_(u.daysMap[h]));break}e(7,b=c[0].startedAt),e(5,E=P.MONTH);return}switch(m){case i.WEEK:h=Y(X(A).startOf("month")),e(4,m=i.DAY),e(8,c=_(u.daysMap[h]));break;case i.DAY:e(4,m=i.HOUR),e(8,c=_(u.hoursMap[h]));break;case i.HOUR:e(4,m=i.MINUTES),e(8,c=_(u.minutesMap[h])),e(3,I=H.KW);break}e(7,b=c[0].startedAt),[i.HOUR,i.MINUTES].includes(m)&&e(5,E=P.DAY)};function d(l){T=l,e(6,T)}return n.$$set=l=>{"data"in l&&e(12,u=l.data)},n.$$.update=()=>{n.$$.dirty&4096&&w(u)},[r,o,a,I,m,E,T,b,c,L,g,p,u,d]}class Ne extends Q{constructor(t){super(),Z(this,t,_e,Ee,x,{data:12})}}export{Ne as default};
