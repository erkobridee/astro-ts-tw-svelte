import{B as tt,f as N,t as T,S as De,i as Ae,s as pe,E as at,a as nt,b as Ne,c as Ce,e as ne,g as Le,m as se,p as re,u as oe,v as st,z as Te,d as C,w as Ee,U as Me,h as x,j as L,k as K,l as F,n as R,x as be,o as te,q as B,y as ke,r as ae,I as ze,F as fe,G as ue,K as Ze,L as Je,M as Qe,V as rt,T as G}from"./ECharts.C5Iir41h.js";import{g as ot,d as lt}from"./dayjs.min.2rai63wT.js";import{o as it,C as ee,c as ct,g as X,p as _e,L as ye,q as Oe,d as Se,T as Fe,r as Re,s as $e,t as ft,u as ut,v as Be,w as mt,x as ht,f as dt,i as $,y as Ue}from"./ChartLoadingSpinner.CnPI2XLW.js";import"./index.BAn-HqPX.js";function Pe(n){return n?.length!==void 0?n:Array.from(n)}function Ht(n,e){n.d(1),e.delete(n.key)}function _t(n,e){T(n,1,1,()=>{e.delete(n.key)})}function gt(n,e,a,t,s,o,i,l,r,u,f,h){let d=n.length,v=o.length,b=d;const A={};for(;b--;)A[n[b].key]=b;const w=[],M=new Map,g=new Map,m=[];for(b=v;b--;){const E=h(s,o,b),p=a(E);let c=i.get(p);c?m.push(()=>c.p(E,e)):(c=u(p,E),c.c()),M.set(p,w[b]=c),p in A&&g.set(p,Math.abs(b-A[p]))}const k=new Set,_=new Set;function y(E){N(E,1),E.m(l,f),i.set(E.key,E),f=E.first,v--}for(;d&&v;){const E=w[v-1],p=n[d-1],c=E.key,I=p.key;E===p?(f=E.first,d--,v--):M.has(I)?!i.has(c)||k.has(c)?y(E):_.has(I)?d--:g.get(c)>g.get(I)?(_.add(c),y(E)):(k.add(I),d--):(r(p,i),d--)}for(;d--;){const E=n[d];M.has(E.key)||r(E,i)}for(;v;)y(w[v-1]);return tt(m),w}var ce={exports:{}},Et=ce.exports,Ve;function bt(){return Ve||(Ve=1,function(n,e){(function(a,t){n.exports=t()})(Et,function(){return function(a,t){t.prototype.isSameOrBefore=function(s,o){return this.isSame(s,o)||this.isBefore(s,o)}}})}(ce)),ce.exports}var kt=bt();const yt=ot(kt);lt.extend(yt);const ie={KW:"kW",KWH:"kWh",M3:"mÂ³",UNDEFINED:""},H={MONTH:"month",WEEK:"week",DAY:"day",HOUR:"hour",MINUTES:"15_minutes",UNDEFINED:""},Kt={GAS:"GAS",ELECTRICITY:"ELECTRICITY"},Dt=300,At=(n,e=Dt)=>{let a;const t=()=>{clearTimeout(a)},s=function(...o){t(),a=setTimeout(()=>n.apply(this,o),e)};return s.cleanup=t,s};function pt(n){let e,a;return e=new ct({props:{color:n[3]}}),{c(){oe(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,s){se(e,t,s),a=!0},p(t,s){const o={};s&8&&(o.color=t[3]),e.$set(o)},i(t){a||(N(e.$$.fragment,t),a=!0)},o(t){T(e.$$.fragment,t),a=!1},d(t){ne(e,t)}}}function vt(n){let e,a,t,s;function o(r){n[7](r)}function i(r){n[8](r)}let l={init:nt,options:n[2],notMerge:!0,$$slots:{default:[pt]},$$scope:{ctx:n}};return n[1]!==void 0&&(l.chart=n[1]),n[0]!==void 0&&(l.chartContainerDOMRect=n[0]),e=new at({props:l}),Ne.push(()=>Ce(e,"chart",o)),Ne.push(()=>Ce(e,"chartContainerDOMRect",i)),{c(){oe(e.$$.fragment)},l(r){re(e.$$.fragment,r)},m(r,u){se(e,r,u),s=!0},p(r,[u]){const f={};u&4&&(f.options=r[2]),u&32776&&(f.$$scope={dirty:u,ctx:r}),!a&&u&2&&(a=!0,f.chart=r[1],Le(()=>a=!1)),!t&&u&1&&(t=!0,f.chartContainerDOMRect=r[0],Le(()=>t=!1)),e.$set(f)},i(r){s||(N(e.$$.fragment,r),s=!0)},o(r){T(e.$$.fragment,r),s=!1},d(r){ne(e,r)}}}const wt=n=>{const e={};for(let a=0;a<n[0].data.length;++a)for(let t=0;t<n.length;++t){const s=n[t],o=s.stack;if(!o)continue;e[o]||(e[o]={stackStart:[],stackEnd:[]});const i=e[o],l=s.data[a];(()=>{const u=l&&l.value?l.value:l;if(!u||u===null)return!1;switch(typeof u){case"number":return!isNaN(u);case"string":return u!=="-"}})()&&(i.stackStart[a]==null&&(i.stackStart[a]=t),i.stackEnd[a]=t)}return e},It=n=>{const e=wt(n);for(let a=0;a<n.length;++a){const t=n[a];if(!t.stack){t.itemStyle=Oe(Se);continue}const s=t.data,o=s.length,i=e[t.stack];for(let l=0;l<o;++l){const r=i.stackEnd[l]===a,u=s[l]&&s[l].value||s[l],f=Oe(r?Se:0);s[l]={value:u,itemStyle:f}}}return n},We="click",ge="mousemove";function Nt(n,e,a){let t,{isTinyScreen:s=!1}=e,{chartOptions:o}=e,{onclick:i=it}=e,l,r={},u,f="",h="";const d=(g,m)=>{const{color:k,categories:_,series:y,xAxisLabelFormatter:E,yAxisLabelFormatter:p=P=>X(P),tooltipFormatter:c,dataZoomLabelFormatter:I}=g;f="",h="",a(4,s=(()=>{if(!m)return!1;const{width:P,height:Y}=m;switch(screen.orientation.angle){case 0:return P<=Re&&Y<=Fe;case 90:return P<=Fe&&Y<=Re}return!1})());const W={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:"rgba(150,150,150,0.1)"}},formatter:c},q={containLabel:!0,left:0,right:0,top:0,bottom:0},U=_.length,z={type:"category",data:_,axisLabel:{color:ye,formatter:E,hideOverlap:!0,showMinLabel:!(s&&U>10||U>12)},axisTick:{show:!1,alignWithLabel:!0},axisLine:{lineStyle:_e},splitLine:{show:!0,lineStyle:_e,showMinLine:!1,showMaxLine:!1,interval:U>50?10:2}};if(a(2,r={color:k,tooltip:W,grid:q,xAxis:z,yAxis:{type:"value",position:"right",axisLabel:{verticalAlign:"bottom",padding:[0,-10,2,0],color:ye,showMinLabel:!1,showMaxLabel:!1,formatter:p},splitLine:{lineStyle:_e,showMaxLine:!1}},series:It(y)}),s&&U>12){q.bottom=55;const P=_[U-13],Y=100;a(2,r.dataZoom=[{type:"inside",startValue:P,end:Y},{show:!0,type:"slider",startValue:P,end:Y,labelFormatter:I}],r)}},b=At(g=>{!s||g.event?.type!==ge||(h=g.name)},500),A=g=>{if(!s){i(g);return}b.cleanup();const m=g.name;if(f&&m===f||h&&m===h){f="",h="",i(g);return}f=m,h=""};st(()=>(l.on(We,"series",A),l.on(ge,"series",b),console.log("BaseColumnsChart - mounted",{chart:l}),()=>{l.off(We,A),l.off(ge,b),console.log("BaseColumnsChart - destroyed",{chart:l})}));function w(g){l=g,a(1,l)}function M(g){u=g,a(0,u)}return n.$$set=g=>{"isTinyScreen"in g&&a(4,s=g.isTinyScreen),"chartOptions"in g&&a(5,o=g.chartOptions),"onclick"in g&&a(6,i=g.onclick)},n.$$.update=()=>{n.$$.dirty&32&&a(3,t=o.color[1]??o.color[0]??ee),n.$$.dirty&33&&d(o,u)},[u,l,r,t,s,o,i,w,M]}class Ct extends De{constructor(e){super(),Ae(this,e,Nt,vt,pe,{isTinyScreen:4,chartOptions:5,onclick:6})}}function He(n){let e,a;return{c(){e=B("span"),a=ke(n[3])},l(t){e=F(t,"SPAN",{});var s=R(e);a=be(s,n[3]),s.forEach(C)},m(t,s){x(t,e,s),L(e,a)},p(t,s){s&8&&Ee(a,t[3])},d(t){t&&C(e)}}}function Lt(n){let e,a,t,s,o,i,l=X(n[1],n[4])+"",r,u,f=n[3]&&He(n);return{c(){e=B("div"),a=B("span"),t=ke(n[0]),s=ae(),o=B("div"),i=B("span"),r=ke(l),u=ae(),f&&f.c(),this.h()},l(h){e=F(h,"DIV",{class:!0});var d=R(e);a=F(d,"SPAN",{});var v=R(a);t=be(v,n[0]),v.forEach(C),s=te(d),o=F(d,"DIV",{class:!0,style:!0});var b=R(o);i=F(b,"SPAN",{class:!0});var A=R(i);r=be(A,l),A.forEach(C),u=te(b),f&&f.l(b),b.forEach(C),d.forEach(C),this.h()},h(){K(i,"class","text-sm tabular-nums"),K(o,"class","text-sm font-semibold"),Me(o,"color",n[2]),K(e,"class","flex flex-col md:flex-row md:items-center md:gap-2")},m(h,d){x(h,e,d),L(e,a),L(a,t),L(e,s),L(e,o),L(o,i),L(i,r),L(o,u),f&&f.m(o,null)},p(h,[d]){d&1&&Ee(t,h[0]),d&18&&l!==(l=X(h[1],h[4])+"")&&Ee(r,l),h[3]?f?f.p(h,d):(f=He(h),f.c(),f.m(o,null)):f&&(f.d(1),f=null),d&4&&Me(o,"color",h[2])},i:Te,o:Te,d(h){h&&C(e),f&&f.d()}}}function Tt(n,e,a){let{label:t}=e,{value:s}=e,{valueColor:o=ye}=e,{unit:i}=e,{maximumFractionDigits:l=$e}=e;return n.$$set=r=>{"label"in r&&a(0,t=r.label),"value"in r&&a(1,s=r.value),"valueColor"in r&&a(2,o=r.valueColor),"unit"in r&&a(3,i=r.unit),"maximumFractionDigits"in r&&a(4,l=r.maximumFractionDigits)},[t,s,o,i,l]}class et extends De{constructor(e){super(),Ae(this,e,Tt,Lt,pe,{label:0,value:1,valueColor:2,unit:3,maximumFractionDigits:4})}}const Mt=n=>({}),Ke=n=>({}),Ot=n=>({}),Ye=n=>({});function je(n,e,a){const t=n.slice();t[22]=e[a],t[25]=a;const s=t[3][t[25]];return t[23]=s,t}function St(n){let e,a;return e=new et({props:{label:n[5](0),value:n[3][0],valueColor:n[6](0),unit:n[0],maximumFractionDigits:n[1]}}),{c(){oe(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,s){se(e,t,s),a=!0},p(t,s){const o={};s&8&&(o.value=t[3][0]),s&1&&(o.unit=t[0]),s&2&&(o.maximumFractionDigits=t[1]),e.$set(o)},i(t){a||(N(e.$$.fragment,t),a=!0)},o(t){T(e.$$.fragment,t),a=!1},d(t){ne(e,t)}}}function Ft(n){let e=[],a=new Map,t,s,o=Pe(n[2]);const i=l=>l[25];for(let l=0;l<o.length;l+=1){let r=je(n,o,l),u=i(r);a.set(u,e[l]=Ge(u,r))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=G()},l(l){for(let r=0;r<e.length;r+=1)e[r].l(l);t=G()},m(l,r){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(l,r);x(l,t,r),s=!0},p(l,r){r&79&&(o=Pe(l[2]),fe(),e=gt(e,r,i,1,l,o,a,t.parentNode,_t,Ge,t,je),ue())},i(l){if(!s){for(let r=0;r<o.length;r+=1)N(e[r]);s=!0}},o(l){for(let r=0;r<e.length;r+=1)T(e[r]);s=!1},d(l){l&&C(t);for(let r=0;r<e.length;r+=1)e[r].d(l)}}}function qe(n){let e,a;return e=new et({props:{label:n[22],value:n[3][n[25]],valueColor:n[6](n[25]),unit:n[0],maximumFractionDigits:n[1]}}),{c(){oe(e.$$.fragment)},l(t){re(e.$$.fragment,t)},m(t,s){se(e,t,s),a=!0},p(t,s){const o={};s&4&&(o.label=t[22]),s&12&&(o.value=t[3][t[25]]),s&4&&(o.valueColor=t[6](t[25])),s&1&&(o.unit=t[0]),s&2&&(o.maximumFractionDigits=t[1]),e.$set(o)},i(t){a||(N(e.$$.fragment,t),a=!0)},o(t){T(e.$$.fragment,t),a=!1},d(t){ne(e,t)}}}function Ge(n,e){let a,t=!isNaN(e[23]),s,o,i=t&&qe(e);return{key:n,first:null,c(){a=G(),i&&i.c(),s=G(),this.h()},l(l){a=G(),i&&i.l(l),s=G(),this.h()},h(){this.first=a},m(l,r){x(l,a,r),i&&i.m(l,r),x(l,s,r),o=!0},p(l,r){e=l,r&12&&(t=!isNaN(e[23])),t?i?(i.p(e,r),r&12&&N(i,1)):(i=qe(e),i.c(),N(i,1),i.m(s.parentNode,s)):i&&(fe(),T(i,1,1,()=>{i=null}),ue())},i(l){o||(N(i),o=!0)},o(l){T(i),o=!1},d(l){l&&(C(a),C(s)),i&&i.d(l)}}}function Xe(n){let e;const a=n[18].footer,t=ze(a,n,n[17],Ke);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,o){t&&t.m(s,o),e=!0},p(s,o){t&&t.p&&(!e||o&131072)&&Ze(t,a,s,s[17],e?Qe(a,s[17],o,Mt):Je(s[17]),Ke)},i(s){e||(N(t,s),e=!0)},o(s){T(t,s),e=!1},d(s){t&&t.d(s)}}}function Rt(n){let e,a,t,s,o,i,l,r,u,f,h,d,v,b;const A=[Ft,St],w=[];function M(_,y){return y&4&&(s=null),s==null&&(s=!!Array.isArray(_[2])),s?0:1}o=M(n,-1),i=w[o]=A[o](n);const g=n[18].headerActions,m=ze(g,n,n[17],Ye);d=new Ct({props:{chartOptions:n[4],onclick:n[7]}});let k=n[8].footer&&Xe(n);return{c(){e=B("div"),a=B("div"),t=B("div"),i.c(),l=ae(),r=B("div"),m&&m.c(),u=ae(),f=B("div"),h=B("div"),oe(d.$$.fragment),v=ae(),k&&k.c(),this.h()},l(_){e=F(_,"DIV",{class:!0});var y=R(e);a=F(y,"DIV",{class:!0});var E=R(a);t=F(E,"DIV",{class:!0});var p=R(t);i.l(p),p.forEach(C),l=te(E),r=F(E,"DIV",{});var c=R(r);m&&m.l(c),c.forEach(C),E.forEach(C),u=te(y),f=F(y,"DIV",{class:!0});var I=R(f);h=F(I,"DIV",{class:!0});var W=R(h);re(d.$$.fragment,W),W.forEach(C),I.forEach(C),v=te(y),k&&k.l(y),y.forEach(C),this.h()},h(){K(t,"class","flex justify-center gap-4 md:items-center md:justify-start"),K(a,"class","flex flex-col gap-4 sm:flex-row sm:flex-wrap sm:justify-between"),K(h,"class","absolute top-0 right-0 bottom-0 left-0"),K(f,"class","relative min-h-[200px] grow"),K(e,"class","flex min-h-full grow flex-col gap-2")},m(_,y){x(_,e,y),L(e,a),L(a,t),w[o].m(t,null),L(a,l),L(a,r),m&&m.m(r,null),L(e,u),L(e,f),L(f,h),se(d,h,null),L(e,v),k&&k.m(e,null),b=!0},p(_,[y]){let E=o;o=M(_,y),o===E?w[o].p(_,y):(fe(),T(w[E],1,1,()=>{w[E]=null}),ue(),i=w[o],i?i.p(_,y):(i=w[o]=A[o](_),i.c()),N(i,1),i.m(t,null)),m&&m.p&&(!b||y&131072)&&Ze(m,g,_,_[17],b?Qe(g,_[17],y,Ot):Je(_[17]),Ye);const p={};y&16&&(p.chartOptions=_[4]),d.$set(p),_[8].footer?k?(k.p(_,y),y&256&&N(k,1)):(k=Xe(_),k.c(),N(k,1),k.m(e,null)):k&&(fe(),T(k,1,1,()=>{k=null}),ue())},i(_){b||(N(i),N(m,_),N(d.$$.fragment,_),N(k),b=!0)},o(_){T(i),T(m,_),T(d.$$.fragment,_),T(k),b=!1},d(_){_&&C(e),w[o].d(),m&&m.d(_),ne(d),k&&k.d()}}}const xe={PLAIN:"PLAIN",REPARTITION:"REPARTITION",EXCEEDANCE:"EXCEEDANCE"};function Bt(n,e,a){let{$$slots:t={},$$scope:s}=e;const o=rt(t);let{type:i=xe.PLAIN}=e,{showAverageMarkline:l=!1}=e,{unit:r=ie.UNDEFINED}=e,{aggregation:u=H.UNDEFINED}=e,{maximumFractionDigits:f=$e}=e,{color:h=ee}=e,{timeseries:d=[]}=e,{referencePower:v=void 0}=e,{referencePowerOptions:b=ft}=e,{labels:A=["Consumption","Exceedance"]}=e,{onclick:w=ut}=e,M=!1,g=[0,NaN],m={color:[],categories:[],series:[]};const k=(c,I,W,q,U,z,Z,P,Y)=>{M=_(W,q);const ve=!!P,me=c===xe.REPARTITION;let he=0,we=0;const J=Z.reduce((D,O)=>{const{startedAt:j,value:V=NaN,anotherValue:S=NaN}=O;return he+=V??0,we+=S??0,D.startedAtData.push(j),me?(D.valueData.push(V),D.anotherValueData.push(S),D):(D.valueData.push(V),D)},{startedAtData:[],valueData:[],anotherValueData:[]});if(a(4,m.color=Array.isArray(z)?z:[z],m),a(4,m.categories=J.startedAtData,m),me||ve){a(3,g=[he,we]);const D={type:"bar",stack:"energy",name:A[0],data:J.valueData},O={type:"bar",stack:"energy",name:A[1],data:J.anotherValueData};a(4,m.series=[D,O],m)}else{a(3,g=[he,NaN]);const D={type:"bar",data:J.valueData};a(4,m.series=[D],m)}m.series.forEach(D=>{if(I){let O=D.markLine;const j={type:"average",label:{fontWeight:"bold",position:"insideEndTop",backgroundColor:"white",padding:2,borderRadius:5,textBorderColor:"white",textBorderWidth:3,formatter:V=>X(V.value,U)}};if(O){const{symbol:V=Be,data:S=[]}=O;D.markLine={symbol:V,data:[...S,j]}}else D.markLine={symbol:Be,data:[j]}}D.cursor=M?"zoom-in":"default"}),console.log("EnergyChart.updateChartOptions",{type:c,showAverageMarkline:I,unit:W,aggregation:q,maximumFractionDigits:U,timeseries:Z,isDrilldownEnabled:M,hasReferencePower:ve,referencePower:P,referencePowerOptions:Y,data:J});let Q=mt,le=D=>ht(D.startedAt);switch(q){case H.MONTH:Q=Ue,le=D=>Ue(D.startedAt);break;case H.WEEK:Q=$,le=D=>`${$(D.startedAt)} - ${$(D.endedAt)}`;break;case H.DAY:Q=$,le=D=>$(D.startedAt);break}a(4,m.xAxisLabelFormatter=Q,m),a(4,m.tooltipFormatter=D=>{const O=D;let j=Z[O[0].dataIndex],V=0,S="";return S+=`<div>${le(j)}</div>`,O.reverse().forEach(de=>{j=Z[de.dataIndex];const Ie=de.value;V+=Ie,S+=dt({color:de.color,value:`${X(Ie,U)} ${W}`})}),me&&(S+='<div style="padding-top: 5px;"><hr>',S+=`<span style="float:right;margin-left:20px;font-weight:600">${X(V,U)} ${W}</span>`,S+="</div>"),S},m),a(4,m.dataZoomLabelFormatter=(D,O)=>Q(O),m)},_=(c,I)=>{switch(c){case ie.M3:return![H.HOUR,H.MINUTES,H.UNDEFINED].includes(I);case ie.KW:case ie.KWH:return![H.MINUTES,H.UNDEFINED].includes(I);default:return!1}},y=(c=0)=>Array.isArray(A)?A[c]??"":A,E=(c=0)=>{let I=ee;return h&&(I=Array.isArray(h)?h[c]??ee:c===0?h:ee),I},p=c=>{c.data&&w(d[c.dataIndex])};return n.$$set=c=>{"type"in c&&a(9,i=c.type),"showAverageMarkline"in c&&a(10,l=c.showAverageMarkline),"unit"in c&&a(0,r=c.unit),"aggregation"in c&&a(11,u=c.aggregation),"maximumFractionDigits"in c&&a(1,f=c.maximumFractionDigits),"color"in c&&a(12,h=c.color),"timeseries"in c&&a(13,d=c.timeseries),"referencePower"in c&&a(14,v=c.referencePower),"referencePowerOptions"in c&&a(15,b=c.referencePowerOptions),"labels"in c&&a(2,A=c.labels),"onclick"in c&&a(16,w=c.onclick),"$$scope"in c&&a(17,s=c.$$scope)},n.$$.update=()=>{n.$$.dirty&65027&&k(i,l,r,u,f,h,d,v,b)},[r,f,A,g,m,y,E,p,o,i,l,u,h,d,v,b,w,s,t]}class Yt extends De{constructor(e){super(),Ae(this,e,Bt,Rt,pe,{type:9,showAverageMarkline:10,unit:0,aggregation:11,maximumFractionDigits:1,color:12,timeseries:13,referencePower:14,referencePowerOptions:15,labels:2,onclick:16})}}export{H as A,Yt as E,ie as U,xe as a,Kt as b,Ht as d,Pe as e,_t as o,gt as u};
