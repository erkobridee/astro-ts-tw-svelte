import{B as tt,f as N,t as L,S as De,i as ye,s as Ae,E as at,a as nt,b as Ie,c as Ne,e as ee,g as Ce,m as te,p as ae,u as ne,v as st,z as Te,d as C,w as ge,U as Le,h as G,j as T,k as H,l as S,n as F,x as Ee,o as Z,q as R,y as be,r as $,I as xe,F as ce,G as fe,K as ze,L as Je,M as Qe,V as rt,T as Y}from"./ECharts.C5Iir41h.js";import{g as ot,d as lt}from"./dayjs.min.2rai63wT.js";import{o as it,C as Q,c as ct,g as q,p as de,L as ke,q as Me,d as Oe,T as Se,r as Fe,s as Ze,t as ft,u as ut,v as Re,w as ht,x as mt,f as dt,j as J,y as Be}from"./ChartLoadingSpinner.DFYnUtdT.js";import"./index.BAn-HqPX.js";function Ue(n){return n?.length!==void 0?n:Array.from(n)}function Ht(n,e){n.d(1),e.delete(n.key)}function _t(n,e){L(n,1,1,()=>{e.delete(n.key)})}function gt(n,e,a,t,s,o,i,l,r,u,f,m){let d=n.length,p=o.length,b=d;const A={};for(;b--;)A[n[b].key]=b;const w=[],M=new Map,g=new Map,h=[];for(b=p;b--;){const E=m(s,o,b),v=a(E);let c=i.get(v);c?h.push(()=>c.p(E,e)):(c=u(v,E),c.c()),M.set(v,w[b]=c),v in A&&g.set(v,Math.abs(b-A[v]))}const k=new Set,_=new Set;function D(E){N(E,1),E.m(l,f),i.set(E.key,E),f=E.first,p--}for(;d&&p;){const E=w[p-1],v=n[d-1],c=E.key,I=v.key;E===v?(f=E.first,d--,p--):M.has(I)?!i.has(c)||k.has(c)?D(E):_.has(I)?d--:g.get(c)>g.get(I)?(_.add(c),D(E)):(k.add(I),d--):(r(v,i),d--)}for(;d--;){const E=n[d];M.has(E.key)||r(E,i)}for(;p;)D(w[p-1]);return tt(h),w}var ie={exports:{}},Et=ie.exports,Pe;function bt(){return Pe||(Pe=1,function(n,e){(function(a,t){n.exports=t()})(Et,function(){return function(a,t){t.prototype.isSameOrBefore=function(s,o){return this.isSame(s,o)||this.isBefore(s,o)}}})}(ie)),ie.exports}var kt=bt();const Dt=ot(kt);lt.extend(Dt);const le={KW:"kW",KWH:"kWh",M3:"mÂ³",UNDEFINED:""},W={MONTH:"month",WEEK:"week",DAY:"day",HOUR:"hour",MINUTES:"15_minutes",UNDEFINED:""},Kt={GAS:"GAS",ELECTRICITY:"ELECTRICITY"},yt=300,At=(n,e=yt)=>{let a;const t=()=>{clearTimeout(a)},s=function(...o){t(),a=setTimeout(()=>n.apply(this,o),e)};return s.cleanup=t,s};function vt(n){let e,a;return e=new ct({props:{color:n[3]}}),{c(){ne(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,s){te(e,t,s),a=!0},p(t,s){const o={};s&8&&(o.color=t[3]),e.$set(o)},i(t){a||(N(e.$$.fragment,t),a=!0)},o(t){L(e.$$.fragment,t),a=!1},d(t){ee(e,t)}}}function pt(n){let e,a,t,s;function o(r){n[7](r)}function i(r){n[8](r)}let l={init:nt,options:n[2],notMerge:!0,$$slots:{default:[vt]},$$scope:{ctx:n}};return n[1]!==void 0&&(l.chart=n[1]),n[0]!==void 0&&(l.chartContainerDOMRect=n[0]),e=new at({props:l}),Ie.push(()=>Ne(e,"chart",o)),Ie.push(()=>Ne(e,"chartContainerDOMRect",i)),{c(){ne(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,u){te(e,r,u),s=!0},p(r,[u]){const f={};u&4&&(f.options=r[2]),u&32776&&(f.$$scope={dirty:u,ctx:r}),!a&&u&2&&(a=!0,f.chart=r[1],Ce(()=>a=!1)),!t&&u&1&&(t=!0,f.chartContainerDOMRect=r[0],Ce(()=>t=!1)),e.$set(f)},i(r){s||(N(e.$$.fragment,r),s=!0)},o(r){L(e.$$.fragment,r),s=!1},d(r){ee(e,r)}}}const wt=n=>{const e={};for(let a=0;a<n[0].data.length;++a)for(let t=0;t<n.length;++t){const s=n[t],o=s.stack;if(!o)continue;e[o]||(e[o]={stackStart:[],stackEnd:[]});const i=e[o],l=s.data[a];(()=>{const u=l&&l.value?l.value:l;if(!u||u===null)return!1;switch(typeof u){case"number":return!isNaN(u);case"string":return u!=="-"}})()&&(i.stackStart[a]==null&&(i.stackStart[a]=t),i.stackEnd[a]=t)}return e},It=n=>{const e=wt(n);for(let a=0;a<n.length;++a){const t=n[a];if(!t.stack){t.itemStyle=Me(Oe);continue}const s=t.data,o=s.length,i=e[t.stack];for(let l=0;l<o;++l){const r=i.stackEnd[l]===a,u=s[l]&&s[l].value||s[l],f=Me(r?Oe:0);s[l]={value:u,itemStyle:f}}}return n},Ve="click",_e="mousemove";function Nt(n,e,a){let t,{isTinyScreen:s=!1}=e,{chartOptions:o}=e,{onclick:i=it}=e,l,r={},u,f="",m="";const d=(g,h)=>{const{color:k,categories:_,series:D,xAxisLabelFormatter:E,yAxisLabelFormatter:v=P=>q(P),tooltipFormatter:c}=g;f="",m="",a(4,s=(()=>{if(!h)return!1;const{width:P,height:x}=h;switch(screen.orientation.angle){case 0:return P<=Fe&&x<=Se;case 90:return P<=Se&&x<=Fe}return!1})());const I={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:"rgba(150,150,150,0.1)"}},formatter:c},U={containLabel:!0,left:0,right:0,top:0,bottom:0},X=_.length,j={type:"category",data:_,axisLabel:{color:ke,formatter:E,hideOverlap:!0,showMinLabel:!(s&&_.length>10||_.length>12)},axisTick:{show:!1,alignWithLabel:!0},axisLine:{lineStyle:de},splitLine:{show:!0,lineStyle:de,showMinLine:!1,showMaxLine:!1,interval:X>50?10:2}};a(2,r={color:k,tooltip:I,grid:U,xAxis:j,yAxis:{type:"value",position:"right",axisLabel:{verticalAlign:"bottom",padding:[0,-10,2,0],color:ke,showMinLabel:!1,showMaxLabel:!1,formatter:v},splitLine:{lineStyle:de,showMaxLine:!1}},series:It(D)})},b=At(g=>{!s||g.event?.type!==_e||(m=g.name)},500),A=g=>{if(!s){i(g);return}b.cleanup();const h=g.name;if(f&&h===f||m&&h===m){f="",m="",i(g);return}f=h,m=""};st(()=>(l.on(Ve,"series",A),l.on(_e,"series",b),console.log("BaseColumnsChart - mounted",{chart:l}),()=>{l.off(Ve,A),l.off(_e,b),console.log("BaseColumnsChart - destroyed",{chart:l})}));function w(g){l=g,a(1,l)}function M(g){u=g,a(0,u)}return n.$$set=g=>{"isTinyScreen"in g&&a(4,s=g.isTinyScreen),"chartOptions"in g&&a(5,o=g.chartOptions),"onclick"in g&&a(6,i=g.onclick)},n.$$.update=()=>{n.$$.dirty&32&&a(3,t=o.color[1]??o.color[0]??Q),n.$$.dirty&33&&d(o,u)},[u,l,r,t,s,o,i,w,M]}class Ct extends De{constructor(e){super(),ye(this,e,Nt,pt,Ae,{isTinyScreen:4,chartOptions:5,onclick:6})}}function We(n){let e,a;return{c(){e=R("span"),a=be(n[3])},l(t){e=S(t,"SPAN",{});var s=F(e);a=Ee(s,n[3]),s.forEach(C)},m(t,s){G(t,e,s),T(e,a)},p(t,s){s&8&&ge(a,t[3])},d(t){t&&C(e)}}}function Tt(n){let e,a,t,s,o,i,l=q(n[1],n[4])+"",r,u,f=n[3]&&We(n);return{c(){e=R("div"),a=R("span"),t=be(n[0]),s=$(),o=R("div"),i=R("span"),r=be(l),u=$(),f&&f.c(),this.h()},l(m){e=S(m,"DIV",{class:!0});var d=F(e);a=S(d,"SPAN",{});var p=F(a);t=Ee(p,n[0]),p.forEach(C),s=Z(d),o=S(d,"DIV",{class:!0,style:!0});var b=F(o);i=S(b,"SPAN",{class:!0});var A=F(i);r=Ee(A,l),A.forEach(C),u=Z(b),f&&f.l(b),b.forEach(C),d.forEach(C),this.h()},h(){H(i,"class","text-sm tabular-nums"),H(o,"class","text-sm font-semibold"),Le(o,"color",n[2]),H(e,"class","flex flex-col md:flex-row md:items-center md:gap-2")},m(m,d){G(m,e,d),T(e,a),T(a,t),T(e,s),T(e,o),T(o,i),T(i,r),T(o,u),f&&f.m(o,null)},p(m,[d]){d&1&&ge(t,m[0]),d&18&&l!==(l=q(m[1],m[4])+"")&&ge(r,l),m[3]?f?f.p(m,d):(f=We(m),f.c(),f.m(o,null)):f&&(f.d(1),f=null),d&4&&Le(o,"color",m[2])},i:Te,o:Te,d(m){m&&C(e),f&&f.d()}}}function Lt(n,e,a){let{label:t}=e,{value:s}=e,{valueColor:o=ke}=e,{unit:i}=e,{maximumFractionDigits:l=Ze}=e;return n.$$set=r=>{"label"in r&&a(0,t=r.label),"value"in r&&a(1,s=r.value),"valueColor"in r&&a(2,o=r.valueColor),"unit"in r&&a(3,i=r.unit),"maximumFractionDigits"in r&&a(4,l=r.maximumFractionDigits)},[t,s,o,i,l]}class $e extends De{constructor(e){super(),ye(this,e,Lt,Tt,Ae,{label:0,value:1,valueColor:2,unit:3,maximumFractionDigits:4})}}const Mt=n=>({}),He=n=>({}),Ot=n=>({}),Ke=n=>({});function je(n,e,a){const t=n.slice();t[22]=e[a],t[25]=a;const s=t[3][t[25]];return t[23]=s,t}function St(n){let e,a;return e=new $e({props:{label:n[5](0),value:n[3][0],valueColor:n[6](0),unit:n[0],maximumFractionDigits:n[1]}}),{c(){ne(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,s){te(e,t,s),a=!0},p(t,s){const o={};s&8&&(o.value=t[3][0]),s&1&&(o.unit=t[0]),s&2&&(o.maximumFractionDigits=t[1]),e.$set(o)},i(t){a||(N(e.$$.fragment,t),a=!0)},o(t){L(e.$$.fragment,t),a=!1},d(t){ee(e,t)}}}function Ft(n){let e=[],a=new Map,t,s,o=Ue(n[2]);const i=l=>l[25];for(let l=0;l<o.length;l+=1){let r=je(n,o,l),u=i(r);a.set(u,e[l]=qe(u,r))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=Y()},l(l){for(let r=0;r<e.length;r+=1)e[r].l(l);t=Y()},m(l,r){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(l,r);G(l,t,r),s=!0},p(l,r){r&79&&(o=Ue(l[2]),ce(),e=gt(e,r,i,1,l,o,a,t.parentNode,_t,qe,t,je),fe())},i(l){if(!s){for(let r=0;r<o.length;r+=1)N(e[r]);s=!0}},o(l){for(let r=0;r<e.length;r+=1)L(e[r]);s=!1},d(l){l&&C(t);for(let r=0;r<e.length;r+=1)e[r].d(l)}}}function Ye(n){let e,a;return e=new $e({props:{label:n[22],value:n[3][n[25]],valueColor:n[6](n[25]),unit:n[0],maximumFractionDigits:n[1]}}),{c(){ne(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,s){te(e,t,s),a=!0},p(t,s){const o={};s&4&&(o.label=t[22]),s&12&&(o.value=t[3][t[25]]),s&4&&(o.valueColor=t[6](t[25])),s&1&&(o.unit=t[0]),s&2&&(o.maximumFractionDigits=t[1]),e.$set(o)},i(t){a||(N(e.$$.fragment,t),a=!0)},o(t){L(e.$$.fragment,t),a=!1},d(t){ee(e,t)}}}function qe(n,e){let a,t=!isNaN(e[23]),s,o,i=t&&Ye(e);return{key:n,first:null,c(){a=Y(),i&&i.c(),s=Y(),this.h()},l(l){a=Y(),i&&i.l(l),s=Y(),this.h()},h(){this.first=a},m(l,r){G(l,a,r),i&&i.m(l,r),G(l,s,r),o=!0},p(l,r){e=l,r&12&&(t=!isNaN(e[23])),t?i?(i.p(e,r),r&12&&N(i,1)):(i=Ye(e),i.c(),N(i,1),i.m(s.parentNode,s)):i&&(ce(),L(i,1,1,()=>{i=null}),fe())},i(l){o||(N(i),o=!0)},o(l){L(i),o=!1},d(l){l&&(C(a),C(s)),i&&i.d(l)}}}function Ge(n){let e;const a=n[18].footer,t=xe(a,n,n[17],He);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,o){t&&t.m(s,o),e=!0},p(s,o){t&&t.p&&(!e||o&131072)&&ze(t,a,s,s[17],e?Qe(a,s[17],o,Mt):Je(s[17]),He)},i(s){e||(N(t,s),e=!0)},o(s){L(t,s),e=!1},d(s){t&&t.d(s)}}}function Rt(n){let e,a,t,s,o,i,l,r,u,f,m,d,p,b;const A=[Ft,St],w=[];function M(_,D){return D&4&&(s=null),s==null&&(s=!!Array.isArray(_[2])),s?0:1}o=M(n,-1),i=w[o]=A[o](n);const g=n[18].headerActions,h=xe(g,n,n[17],Ke);d=new Ct({props:{chartOptions:n[4],onclick:n[7]}});let k=n[8].footer&&Ge(n);return{c(){e=R("div"),a=R("div"),t=R("div"),i.c(),l=$(),r=R("div"),h&&h.c(),u=$(),f=R("div"),m=R("div"),ne(d.$$.fragment),p=$(),k&&k.c(),this.h()},l(_){e=S(_,"DIV",{class:!0});var D=F(e);a=S(D,"DIV",{class:!0});var E=F(a);t=S(E,"DIV",{class:!0});var v=F(t);i.l(v),v.forEach(C),l=Z(E),r=S(E,"DIV",{});var c=F(r);h&&h.l(c),c.forEach(C),E.forEach(C),u=Z(D),f=S(D,"DIV",{class:!0});var I=F(f);m=S(I,"DIV",{class:!0});var U=F(m);ae(d.$$.fragment,U),U.forEach(C),I.forEach(C),p=Z(D),k&&k.l(D),D.forEach(C),this.h()},h(){H(t,"class","flex justify-center gap-4 md:items-center md:justify-start"),H(a,"class","flex flex-col gap-4 sm:flex-row sm:flex-wrap sm:justify-between"),H(m,"class","absolute top-0 right-0 bottom-0 left-0"),H(f,"class","relative min-h-[200px] grow"),H(e,"class","flex min-h-full grow flex-col gap-2")},m(_,D){G(_,e,D),T(e,a),T(a,t),w[o].m(t,null),T(a,l),T(a,r),h&&h.m(r,null),T(e,u),T(e,f),T(f,m),te(d,m,null),T(e,p),k&&k.m(e,null),b=!0},p(_,[D]){let E=o;o=M(_,D),o===E?w[o].p(_,D):(ce(),L(w[E],1,1,()=>{w[E]=null}),fe(),i=w[o],i?i.p(_,D):(i=w[o]=A[o](_),i.c()),N(i,1),i.m(t,null)),h&&h.p&&(!b||D&131072)&&ze(h,g,_,_[17],b?Qe(g,_[17],D,Ot):Je(_[17]),Ke);const v={};D&16&&(v.chartOptions=_[4]),d.$set(v),_[8].footer?k?(k.p(_,D),D&256&&N(k,1)):(k=Ge(_),k.c(),N(k,1),k.m(e,null)):k&&(ce(),L(k,1,1,()=>{k=null}),fe())},i(_){b||(N(i),N(h,_),N(d.$$.fragment,_),N(k),b=!0)},o(_){L(i),L(h,_),L(d.$$.fragment,_),L(k),b=!1},d(_){_&&C(e),w[o].d(),h&&h.d(_),ee(d),k&&k.d()}}}const Xe={PLAIN:"PLAIN",REPARTITION:"REPARTITION",EXCEEDANCE:"EXCEEDANCE"};function Bt(n,e,a){let{$$slots:t={},$$scope:s}=e;const o=rt(t);let{type:i=Xe.PLAIN}=e,{showAverageMarkline:l=!1}=e,{unit:r=le.UNDEFINED}=e,{aggregation:u=W.UNDEFINED}=e,{maximumFractionDigits:f=Ze}=e,{color:m=Q}=e,{timeseries:d=[]}=e,{referencePower:p=void 0}=e,{referencePowerOptions:b=ft}=e,{labels:A=["Consumption","Exceedance"]}=e,{onclick:w=ut}=e,M=!1,g=[0,NaN],h={color:[],categories:[],series:[]};const k=(c,I,U,X,j,se,P,x,et)=>{M=_(U,X);const ve=!!x,ue=c===Xe.REPARTITION;let he=0,pe=0;const z=P.reduce((y,V)=>{const{startedAt:K,value:B=NaN,anotherValue:O=NaN}=V;return he+=B??0,pe+=O??0,y.startedAtData.push(K),ue?(y.valueData.push(B),y.anotherValueData.push(O),y):(y.valueData.push(B),y)},{startedAtData:[],valueData:[],anotherValueData:[]});if(a(4,h.color=Array.isArray(se)?se:[se],h),a(4,h.categories=z.startedAtData,h),ue||ve){a(3,g=[he,pe]);const y={type:"bar",stack:"energy",name:A[0],data:z.valueData},V={type:"bar",stack:"energy",name:A[1],data:z.anotherValueData};a(4,h.series=[y,V],h)}else{a(3,g=[he,NaN]);const y={type:"bar",data:z.valueData};a(4,h.series=[y],h)}h.series.forEach(y=>{if(I){let V=y.markLine;const K={type:"average",label:{fontWeight:"bold",position:"insideEndTop",backgroundColor:"white",padding:2,borderRadius:5,textBorderColor:"white",textBorderWidth:3,formatter:B=>q(B.value,j)}};if(V){const{symbol:B=Re,data:O=[]}=V;y.markLine={symbol:B,data:[...O,K]}}else y.markLine={symbol:Re,data:[K]}}y.cursor=M?"zoom-in":"default"}),console.log("EnergyChart.updateChartOptions",{type:c,showAverageMarkline:I,unit:U,aggregation:X,maximumFractionDigits:j,timeseries:P,isDrilldownEnabled:M,hasReferencePower:ve,referencePower:x,referencePowerOptions:et,data:z});let re=ht,oe=y=>mt(y.startedAt);switch(X){case W.MONTH:re=Be,oe=y=>Be(y.startedAt);break;case W.WEEK:re=J,oe=y=>`${J(y.startedAt)} - ${J(y.endedAt)}`;break;case W.DAY:re=J,oe=y=>J(y.startedAt);break}a(4,h.xAxisLabelFormatter=re,h),a(4,h.tooltipFormatter=y=>{const V=y;let K=P[V[0].dataIndex],B=0,O="";return O+=`<div>${oe(K)}</div>`,V.reverse().forEach(me=>{K=P[me.dataIndex];const we=me.value;B+=we,O+=dt({color:me.color,value:`${q(we,j)} ${U}`})}),ue&&(O+='<div style="padding-top: 5px;"><hr>',O+=`<span style="float:right;margin-left:20px;font-weight:600">${q(B,j)} ${U}</span>`,O+="</div>"),O},h)},_=(c,I)=>{switch(c){case le.M3:return![W.HOUR,W.MINUTES,W.UNDEFINED].includes(I);case le.KW:case le.KWH:return![W.MINUTES,W.UNDEFINED].includes(I);default:return!1}},D=(c=0)=>Array.isArray(A)?A[c]??"":A,E=(c=0)=>{let I=Q;return m&&(I=Array.isArray(m)?m[c]??Q:c===0?m:Q),I},v=c=>{c.data&&w(d[c.dataIndex])};return n.$$set=c=>{"type"in c&&a(9,i=c.type),"showAverageMarkline"in c&&a(10,l=c.showAverageMarkline),"unit"in c&&a(0,r=c.unit),"aggregation"in c&&a(11,u=c.aggregation),"maximumFractionDigits"in c&&a(1,f=c.maximumFractionDigits),"color"in c&&a(12,m=c.color),"timeseries"in c&&a(13,d=c.timeseries),"referencePower"in c&&a(14,p=c.referencePower),"referencePowerOptions"in c&&a(15,b=c.referencePowerOptions),"labels"in c&&a(2,A=c.labels),"onclick"in c&&a(16,w=c.onclick),"$$scope"in c&&a(17,s=c.$$scope)},n.$$.update=()=>{n.$$.dirty&65027&&k(i,l,r,u,f,m,d,p,b)},[r,f,A,g,h,D,E,v,o,i,l,u,m,d,p,b,w,s,t]}class jt extends De{constructor(e){super(),ye(this,e,Bt,Rt,Ae,{type:9,showAverageMarkline:10,unit:0,aggregation:11,maximumFractionDigits:1,color:12,timeseries:13,referencePower:14,referencePowerOptions:15,labels:2,onclick:16})}}export{W as A,jt as E,le as U,Xe as a,Kt as b,Ht as d,Ue as e,_t as o,gt as u};
