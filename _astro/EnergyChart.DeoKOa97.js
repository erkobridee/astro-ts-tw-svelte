import{B as tt,f as I,t as T,S as De,i as ye,s as Ae,E as at,a as nt,b as Ne,c as Ie,e as ee,g as Ce,m as te,p as ae,u as ne,v as st,z as Le,d as C,w as ge,U as Te,h as G,j as L,k as H,l as S,n as F,x as Ee,o as Z,q as R,y as be,r as $,I as ze,F as ce,G as fe,K as xe,L as Je,M as Qe,V as rt,T as Y}from"./ECharts.C5Iir41h.js";import{g as ot,d as lt}from"./dayjs.min.2rai63wT.js";import{q as it,C as Q,c as ct,g as q,r as de,L as ke,s as Me,d as Oe,T as Se,t as Fe,u as Ze,v as ft,n as ut,w as Re,x as ht,y as mt,f as dt,j as J,z as Be}from"./ChartLoadingSpinner.9-7-XflD.js";import"./index.BAn-HqPX.js";function Ue(n){return n?.length!==void 0?n:Array.from(n)}function Ht(n,e){n.d(1),e.delete(n.key)}function _t(n,e){T(n,1,1,()=>{e.delete(n.key)})}function gt(n,e,a,t,s,l,i,o,r,f,u,_){let h=n.length,w=l.length,b=h;const A={};for(;b--;)A[n[b].key]=b;const p=[],M=new Map,g=new Map,m=[];for(b=w;b--;){const E=_(s,l,b),v=a(E);let c=i.get(v);c?m.push(()=>c.p(E,e)):(c=f(v,E),c.c()),M.set(v,p[b]=c),v in A&&g.set(v,Math.abs(b-A[v]))}const k=new Set,d=new Set;function D(E){I(E,1),E.m(o,u),i.set(E.key,E),u=E.first,w--}for(;h&&w;){const E=p[w-1],v=n[h-1],c=E.key,N=v.key;E===v?(u=E.first,h--,w--):M.has(N)?!i.has(c)||k.has(c)?D(E):d.has(N)?h--:g.get(c)>g.get(N)?(d.add(c),D(E)):(k.add(N),h--):(r(v,i),h--)}for(;h--;){const E=n[h];M.has(E.key)||r(E,i)}for(;w;)D(p[w-1]);return tt(m),p}var ie={exports:{}},Et=ie.exports,Pe;function bt(){return Pe||(Pe=1,function(n,e){(function(a,t){n.exports=t()})(Et,function(){return function(a,t){t.prototype.isSameOrBefore=function(s,l){return this.isSame(s,l)||this.isBefore(s,l)}}})}(ie)),ie.exports}var kt=bt();const Dt=ot(kt);lt.extend(Dt);const le={KW:"kW",KWH:"kWh",M3:"mÂ³",UNDEFINED:""},W={MONTH:"month",WEEK:"week",DAY:"day",HOUR:"hour",MINUTES:"15_minutes",UNDEFINED:""},Kt={GAS:"GAS"},yt=300,At=(n,e=yt)=>{let a;return function(...t){clearTimeout(a),a=setTimeout(()=>n.apply(this,t),e)}};function vt(n){let e,a;return e=new ct({props:{color:n[3]}}),{c(){ne(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,s){te(e,t,s),a=!0},p(t,s){const l={};s&8&&(l.color=t[3]),e.$set(l)},i(t){a||(I(e.$$.fragment,t),a=!0)},o(t){T(e.$$.fragment,t),a=!1},d(t){ee(e,t)}}}function wt(n){let e,a,t,s;function l(r){n[7](r)}function i(r){n[8](r)}let o={init:nt,options:n[2],notMerge:!0,$$slots:{default:[vt]},$$scope:{ctx:n}};return n[1]!==void 0&&(o.chart=n[1]),n[0]!==void 0&&(o.chartContainerDOMRect=n[0]),e=new at({props:o}),Ne.push(()=>Ie(e,"chart",l)),Ne.push(()=>Ie(e,"chartContainerDOMRect",i)),{c(){ne(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,f){te(e,r,f),s=!0},p(r,[f]){const u={};f&4&&(u.options=r[2]),f&32776&&(u.$$scope={dirty:f,ctx:r}),!a&&f&2&&(a=!0,u.chart=r[1],Ce(()=>a=!1)),!t&&f&1&&(t=!0,u.chartContainerDOMRect=r[0],Ce(()=>t=!1)),e.$set(u)},i(r){s||(I(e.$$.fragment,r),s=!0)},o(r){T(e.$$.fragment,r),s=!1},d(r){ee(e,r)}}}const pt=n=>{const e={};for(let a=0;a<n[0].data.length;++a)for(let t=0;t<n.length;++t){const s=n[t],l=s.stack;if(!l)continue;e[l]||(e[l]={stackStart:[],stackEnd:[]});const i=e[l],o=s.data[a];(()=>{const f=o&&o.value?o.value:o;if(!f||f===null)return!1;switch(typeof f){case"number":return!isNaN(f);case"string":return f!=="-"}})()&&(i.stackStart[a]==null&&(i.stackStart[a]=t),i.stackEnd[a]=t)}return e},Nt=n=>{const e=pt(n);for(let a=0;a<n.length;++a){const t=n[a];if(!t.stack){t.itemStyle=Me(Oe);continue}const s=t.data,l=s.length,i=e[t.stack];for(let o=0;o<l;++o){const r=i.stackEnd[o]===a,f=s[o]&&s[o].value||s[o],u=Me(r?Oe:0);s[o]={value:f,itemStyle:u}}}return n},Ve="click",_e="mousemove";function It(n,e,a){let t,{isTinyScreen:s=!1}=e,{chartOptions:l}=e,{onclick:i=it}=e,o,r={},f;const u=(g,m)=>{const{color:k,categories:d,series:D,xAxisLabelFormatter:E,yAxisLabelFormatter:v=P=>q(P),tooltipFormatter:c}=g;a(4,s=(()=>{if(!m)return!1;const{width:P,height:z}=m;switch(screen.orientation.angle){case 0:return P<=Fe&&z<=Se;case 90:return P<=Se&&z<=Fe}return!1})());const N={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:"rgba(150,150,150,0.1)"}},formatter:c},U={containLabel:!0,left:0,right:0,top:0,bottom:0},X=d.length,j={type:"category",data:d,axisLabel:{color:ke,formatter:E,hideOverlap:!0,showMinLabel:!(s&&d.length>10||d.length>12)},axisTick:{show:!1,alignWithLabel:!0},axisLine:{lineStyle:de},splitLine:{show:!0,lineStyle:de,showMinLine:!1,showMaxLine:!1,interval:X>50?10:2}};a(2,r={color:k,tooltip:N,grid:U,xAxis:j,yAxis:{type:"value",position:"right",axisLabel:{verticalAlign:"bottom",padding:[0,-10,2,0],color:ke,showMinLabel:!1,showMaxLabel:!1,formatter:v},splitLine:{lineStyle:de,showMaxLine:!1}},series:Nt(D)})};let _="",h="";const b=At(g=>{!s||g.event?.type!==_e||(h=g.name)}),A=g=>{if(!s){i(g);return}const m=g.name;if(_&&m===_||h&&m===h){i(g),_="",h="";return}_=m,h=""};st(()=>(o.on(Ve,"series",A),o.on(_e,"series",b),console.log("BaseColumnsChart - mounted",{chart:o}),()=>{o.off(Ve,A),o.off(_e,b),console.log("BaseColumnsChart - destroyed",{chart:o})}));function p(g){o=g,a(1,o)}function M(g){f=g,a(0,f)}return n.$$set=g=>{"isTinyScreen"in g&&a(4,s=g.isTinyScreen),"chartOptions"in g&&a(5,l=g.chartOptions),"onclick"in g&&a(6,i=g.onclick)},n.$$.update=()=>{n.$$.dirty&32&&a(3,t=l.color[1]??l.color[0]??Q),n.$$.dirty&33&&u(l,f)},[f,o,r,t,s,l,i,p,M]}class Ct extends De{constructor(e){super(),ye(this,e,It,wt,Ae,{isTinyScreen:4,chartOptions:5,onclick:6})}}function We(n){let e,a;return{c(){e=R("span"),a=be(n[3])},l(t){e=S(t,"SPAN",{});var s=F(e);a=Ee(s,n[3]),s.forEach(C)},m(t,s){G(t,e,s),L(e,a)},p(t,s){s&8&&ge(a,t[3])},d(t){t&&C(e)}}}function Lt(n){let e,a,t,s,l,i,o=q(n[1],n[4])+"",r,f,u=n[3]&&We(n);return{c(){e=R("div"),a=R("span"),t=be(n[0]),s=$(),l=R("div"),i=R("span"),r=be(o),f=$(),u&&u.c(),this.h()},l(_){e=S(_,"DIV",{class:!0});var h=F(e);a=S(h,"SPAN",{});var w=F(a);t=Ee(w,n[0]),w.forEach(C),s=Z(h),l=S(h,"DIV",{class:!0,style:!0});var b=F(l);i=S(b,"SPAN",{class:!0});var A=F(i);r=Ee(A,o),A.forEach(C),f=Z(b),u&&u.l(b),b.forEach(C),h.forEach(C),this.h()},h(){H(i,"class","text-sm tabular-nums"),H(l,"class","text-sm font-semibold"),Te(l,"color",n[2]),H(e,"class","flex flex-col md:flex-row md:items-center md:gap-2")},m(_,h){G(_,e,h),L(e,a),L(a,t),L(e,s),L(e,l),L(l,i),L(i,r),L(l,f),u&&u.m(l,null)},p(_,[h]){h&1&&ge(t,_[0]),h&18&&o!==(o=q(_[1],_[4])+"")&&ge(r,o),_[3]?u?u.p(_,h):(u=We(_),u.c(),u.m(l,null)):u&&(u.d(1),u=null),h&4&&Te(l,"color",_[2])},i:Le,o:Le,d(_){_&&C(e),u&&u.d()}}}function Tt(n,e,a){let{label:t}=e,{value:s}=e,{valueColor:l=ke}=e,{unit:i}=e,{maximumFractionDigits:o=Ze}=e;return n.$$set=r=>{"label"in r&&a(0,t=r.label),"value"in r&&a(1,s=r.value),"valueColor"in r&&a(2,l=r.valueColor),"unit"in r&&a(3,i=r.unit),"maximumFractionDigits"in r&&a(4,o=r.maximumFractionDigits)},[t,s,l,i,o]}class $e extends De{constructor(e){super(),ye(this,e,Tt,Lt,Ae,{label:0,value:1,valueColor:2,unit:3,maximumFractionDigits:4})}}const Mt=n=>({}),He=n=>({}),Ot=n=>({}),Ke=n=>({});function je(n,e,a){const t=n.slice();t[22]=e[a],t[25]=a;const s=t[3][t[25]];return t[23]=s,t}function St(n){let e,a;return e=new $e({props:{label:n[5](0),value:n[3][0],valueColor:n[6](0),unit:n[0],maximumFractionDigits:n[1]}}),{c(){ne(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,s){te(e,t,s),a=!0},p(t,s){const l={};s&8&&(l.value=t[3][0]),s&1&&(l.unit=t[0]),s&2&&(l.maximumFractionDigits=t[1]),e.$set(l)},i(t){a||(I(e.$$.fragment,t),a=!0)},o(t){T(e.$$.fragment,t),a=!1},d(t){ee(e,t)}}}function Ft(n){let e=[],a=new Map,t,s,l=Ue(n[2]);const i=o=>o[25];for(let o=0;o<l.length;o+=1){let r=je(n,l,o),f=i(r);a.set(f,e[o]=qe(f,r))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();t=Y()},l(o){for(let r=0;r<e.length;r+=1)e[r].l(o);t=Y()},m(o,r){for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(o,r);G(o,t,r),s=!0},p(o,r){r&79&&(l=Ue(o[2]),ce(),e=gt(e,r,i,1,o,l,a,t.parentNode,_t,qe,t,je),fe())},i(o){if(!s){for(let r=0;r<l.length;r+=1)I(e[r]);s=!0}},o(o){for(let r=0;r<e.length;r+=1)T(e[r]);s=!1},d(o){o&&C(t);for(let r=0;r<e.length;r+=1)e[r].d(o)}}}function Ye(n){let e,a;return e=new $e({props:{label:n[22],value:n[3][n[25]],valueColor:n[6](n[25]),unit:n[0],maximumFractionDigits:n[1]}}),{c(){ne(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,s){te(e,t,s),a=!0},p(t,s){const l={};s&4&&(l.label=t[22]),s&12&&(l.value=t[3][t[25]]),s&4&&(l.valueColor=t[6](t[25])),s&1&&(l.unit=t[0]),s&2&&(l.maximumFractionDigits=t[1]),e.$set(l)},i(t){a||(I(e.$$.fragment,t),a=!0)},o(t){T(e.$$.fragment,t),a=!1},d(t){ee(e,t)}}}function qe(n,e){let a,t=!isNaN(e[23]),s,l,i=t&&Ye(e);return{key:n,first:null,c(){a=Y(),i&&i.c(),s=Y(),this.h()},l(o){a=Y(),i&&i.l(o),s=Y(),this.h()},h(){this.first=a},m(o,r){G(o,a,r),i&&i.m(o,r),G(o,s,r),l=!0},p(o,r){e=o,r&12&&(t=!isNaN(e[23])),t?i?(i.p(e,r),r&12&&I(i,1)):(i=Ye(e),i.c(),I(i,1),i.m(s.parentNode,s)):i&&(ce(),T(i,1,1,()=>{i=null}),fe())},i(o){l||(I(i),l=!0)},o(o){T(i),l=!1},d(o){o&&(C(a),C(s)),i&&i.d(o)}}}function Ge(n){let e;const a=n[18].footer,t=ze(a,n,n[17],He);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,l){t&&t.m(s,l),e=!0},p(s,l){t&&t.p&&(!e||l&131072)&&xe(t,a,s,s[17],e?Qe(a,s[17],l,Mt):Je(s[17]),He)},i(s){e||(I(t,s),e=!0)},o(s){T(t,s),e=!1},d(s){t&&t.d(s)}}}function Rt(n){let e,a,t,s,l,i,o,r,f,u,_,h,w,b;const A=[Ft,St],p=[];function M(d,D){return D&4&&(s=null),s==null&&(s=!!Array.isArray(d[2])),s?0:1}l=M(n,-1),i=p[l]=A[l](n);const g=n[18].headerActions,m=ze(g,n,n[17],Ke);h=new Ct({props:{chartOptions:n[4],onclick:n[7]}});let k=n[8].footer&&Ge(n);return{c(){e=R("div"),a=R("div"),t=R("div"),i.c(),o=$(),r=R("div"),m&&m.c(),f=$(),u=R("div"),_=R("div"),ne(h.$$.fragment),w=$(),k&&k.c(),this.h()},l(d){e=S(d,"DIV",{class:!0});var D=F(e);a=S(D,"DIV",{class:!0});var E=F(a);t=S(E,"DIV",{class:!0});var v=F(t);i.l(v),v.forEach(C),o=Z(E),r=S(E,"DIV",{});var c=F(r);m&&m.l(c),c.forEach(C),E.forEach(C),f=Z(D),u=S(D,"DIV",{class:!0});var N=F(u);_=S(N,"DIV",{class:!0});var U=F(_);ae(h.$$.fragment,U),U.forEach(C),N.forEach(C),w=Z(D),k&&k.l(D),D.forEach(C),this.h()},h(){H(t,"class","flex justify-center gap-4 md:items-center md:justify-start"),H(a,"class","flex flex-col gap-4 sm:flex-row sm:flex-wrap sm:justify-between"),H(_,"class","absolute top-0 right-0 bottom-0 left-0"),H(u,"class","relative min-h-[200px] grow"),H(e,"class","flex min-h-full grow flex-col gap-2")},m(d,D){G(d,e,D),L(e,a),L(a,t),p[l].m(t,null),L(a,o),L(a,r),m&&m.m(r,null),L(e,f),L(e,u),L(u,_),te(h,_,null),L(e,w),k&&k.m(e,null),b=!0},p(d,[D]){let E=l;l=M(d,D),l===E?p[l].p(d,D):(ce(),T(p[E],1,1,()=>{p[E]=null}),fe(),i=p[l],i?i.p(d,D):(i=p[l]=A[l](d),i.c()),I(i,1),i.m(t,null)),m&&m.p&&(!b||D&131072)&&xe(m,g,d,d[17],b?Qe(g,d[17],D,Ot):Je(d[17]),Ke);const v={};D&16&&(v.chartOptions=d[4]),h.$set(v),d[8].footer?k?(k.p(d,D),D&256&&I(k,1)):(k=Ge(d),k.c(),I(k,1),k.m(e,null)):k&&(ce(),T(k,1,1,()=>{k=null}),fe())},i(d){b||(I(i),I(m,d),I(h.$$.fragment,d),I(k),b=!0)},o(d){T(i),T(m,d),T(h.$$.fragment,d),T(k),b=!1},d(d){d&&C(e),p[l].d(),m&&m.d(d),ee(h),k&&k.d()}}}const Xe={PLAIN:"PLAIN",REPARTITION:"REPARTITION",EXCEEDANCE:"EXCEEDANCE"};function Bt(n,e,a){let{$$slots:t={},$$scope:s}=e;const l=rt(t);let{type:i=Xe.PLAIN}=e,{showAverageMarkline:o=!1}=e,{unit:r=le.UNDEFINED}=e,{aggregation:f=W.UNDEFINED}=e,{maximumFractionDigits:u=Ze}=e,{color:_=Q}=e,{timeseries:h=[]}=e,{referencePower:w=void 0}=e,{referencePowerOptions:b=ft}=e,{labels:A=["Consumption","Exceedance"]}=e,{onclick:p=ut}=e,M=!1,g=[0,NaN],m={color:[],categories:[],series:[]};const k=(c,N,U,X,j,se,P,z,et)=>{M=d(U,X);const ve=!!z,ue=c===Xe.REPARTITION;let he=0,we=0;const x=P.reduce((y,V)=>{const{startedAt:K,value:B=NaN,anotherValue:O=NaN}=V;return he+=B??0,we+=O??0,y.startedAtData.push(K),ue?(y.valueData.push(B),y.anotherValueData.push(O),y):(y.valueData.push(B),y)},{startedAtData:[],valueData:[],anotherValueData:[]});if(a(4,m.color=Array.isArray(se)?se:[se],m),a(4,m.categories=x.startedAtData,m),ue||ve){a(3,g=[he,we]);const y={type:"bar",stack:"energy",name:A[0],data:x.valueData},V={type:"bar",stack:"energy",name:A[1],data:x.anotherValueData};a(4,m.series=[y,V],m)}else{a(3,g=[he,NaN]);const y={type:"bar",data:x.valueData};a(4,m.series=[y],m)}m.series.forEach(y=>{if(N){let V=y.markLine;const K={type:"average",label:{fontWeight:"bold",position:"insideEndTop",backgroundColor:"white",padding:2,borderRadius:5,textBorderColor:"white",textBorderWidth:3,formatter:B=>q(B.value,j)}};if(V){const{symbol:B=Re,data:O=[]}=V;y.markLine={symbol:B,data:[...O,K]}}else y.markLine={symbol:Re,data:[K]}}y.cursor=M?"zoom-in":"default"}),console.log("EnergyChart.updateChartOptions",{type:c,showAverageMarkline:N,unit:U,aggregation:X,maximumFractionDigits:j,timeseries:P,isDrilldownEnabled:M,hasReferencePower:ve,referencePower:z,referencePowerOptions:et,data:x});let re=ht,oe=y=>mt(y.startedAt);switch(X){case W.MONTH:re=Be,oe=y=>Be(y.startedAt);break;case W.WEEK:re=J,oe=y=>`${J(y.startedAt)} - ${J(y.endedAt)}`;break;case W.DAY:re=J,oe=y=>J(y.startedAt);break}a(4,m.xAxisLabelFormatter=re,m),a(4,m.tooltipFormatter=y=>{const V=y;let K=P[V[0].dataIndex],B=0,O="";return O+=`<div>${oe(K)}</div>`,V.reverse().forEach(me=>{K=P[me.dataIndex];const pe=me.value;B+=pe,O+=dt({color:me.color,value:`${q(pe,j)} ${U}`})}),ue&&(O+='<div style="padding-top: 5px;"><hr>',O+=`<span style="float:right;margin-left:20px;font-weight:600">${q(B,j)} ${U}</span>`,O+="</div>"),O},m)},d=(c,N)=>{switch(c){case le.M3:return![W.HOUR,W.MINUTES,W.UNDEFINED].includes(N);case le.KW:case le.KWH:return![W.MINUTES,W.UNDEFINED].includes(N);default:return!1}},D=(c=0)=>Array.isArray(A)?A[c]??"":A,E=(c=0)=>{let N=Q;return _&&(N=Array.isArray(_)?_[c]??Q:c===0?_:Q),N},v=c=>{c.data&&p(h[c.dataIndex])};return n.$$set=c=>{"type"in c&&a(9,i=c.type),"showAverageMarkline"in c&&a(10,o=c.showAverageMarkline),"unit"in c&&a(0,r=c.unit),"aggregation"in c&&a(11,f=c.aggregation),"maximumFractionDigits"in c&&a(1,u=c.maximumFractionDigits),"color"in c&&a(12,_=c.color),"timeseries"in c&&a(13,h=c.timeseries),"referencePower"in c&&a(14,w=c.referencePower),"referencePowerOptions"in c&&a(15,b=c.referencePowerOptions),"labels"in c&&a(2,A=c.labels),"onclick"in c&&a(16,p=c.onclick),"$$scope"in c&&a(17,s=c.$$scope)},n.$$.update=()=>{n.$$.dirty&65027&&k(i,o,r,f,u,_,h,w,b)},[r,u,A,g,m,D,E,v,l,i,o,f,_,h,w,b,p,s,t]}class jt extends De{constructor(e){super(),ye(this,e,Bt,Rt,Ae,{type:9,showAverageMarkline:10,unit:0,aggregation:11,maximumFractionDigits:1,color:12,timeseries:13,referencePower:14,referencePowerOptions:15,labels:2,onclick:16})}}export{W as A,jt as E,le as U,Xe as a,Kt as b,Ht as d,Ue as e,_t as o,gt as u};
