import{S as Te,i as ke,s as Ne,d as O,e as G,t as N,f as C,h as te,j as k,m as J,k as H,l as M,n as Y,p as Q,q as L,u as Z,z as oe,A as ae,w as we,B as me,o as z,x as Oe,r as F,y as Re,C as le,b as Pe,c as Se,g as De}from"./ECharts.gyAWcHNC.js";import{g as Me,d as q}from"./dayjs.min.2rai63wT.js";import{E as Le,a as _,U as $,A as E,b as W,c as ye,d as ve,e as He}from"./AggregationLevelSelection.Cwqk4CVR.js";import{T as Ye}from"./Toggle.BW8rRgkn.js";import{B as Ce}from"./ButtonsToggle.DVqffPsj.js";import{k as Ve,j as ie,l as Ke,m as pe,n as ee}from"./ChartLoadingSpinner.NalG-bKT.js";import{g as Ue,a as We,b as Xe}from"./random.DTBvWXaA.js";import{g as Be}from"./math.4fE8PRGd.js";import"./index.BrkFAe0P.js";var ne={exports:{}},je=ne.exports,he;function qe(){return he||(he=1,function(o,r){(function(e,t){o.exports=t()})(je,function(){return function(e,t){t.prototype.isSameOrAfter=function(n,s){return this.isSame(n,s)||this.isAfter(n,s)}}})}(ne)),ne.exports}var ze=qe();const Fe=Me(ze);function ue(o){const r=o.slice(),e=r[8][r[27]];return r[28]=e,r}function ge(o){const r=o.slice(),e=r[26][0]?.dataIndex;return r[27]=e,r}function Ge(o){let r,e;return r=new ye({props:{aggregation:o[4],energyType:ve.ELECTRICITY,layout:o[5],onclick:o[13]}}),{c(){Z(r.$$.fragment)},l(t){Q(r.$$.fragment,t)},m(t,n){J(r,t,n),e=!0},p(t,n){const s={};n&16&&(s.aggregation=t[4]),n&32&&(s.layout=t[5]),r.$set(s)},i(t){e||(C(r.$$.fragment,t),e=!0)},o(t){N(r.$$.fragment,t),e=!1},d(t){G(r,t)}}}function Ee(o){let r,e,t;function n(l){o[16](l)}let s={id:"showAverageToggle",label:"show average mark line"};return o[6]!==void 0&&(s.checked=o[6]),r=new Ye({props:s}),Pe.push(()=>Se(r,"checked",n)),{c(){Z(r.$$.fragment)},l(l){Q(r.$$.fragment,l)},m(l,a){J(r,l,a),t=!0},p(l,a){const h={};!e&&a&64&&(e=!0,h.checked=l[6],De(()=>e=!1)),r.$set(h)},i(l){t||(C(r.$$.fragment,l),t=!0)},o(l){N(r.$$.fragment,l),t=!1},d(l){G(r,l)}}}function _e(o){let r,e,t="Reference power amount",n,s,l;return s=new Ce({props:{name:"reference-power-toggle",selected:o[9],onchange:o[12],list:o[10]}}),{c(){r=L("div"),e=L("span"),e.textContent=t,n=F(),Z(s.$$.fragment),this.h()},l(a){r=M(a,"DIV",{class:!0});var h=Y(r);e=M(h,"SPAN",{"data-svelte-h":!0}),me(e)!=="svelte-ukeiym"&&(e.textContent=t),n=z(h),Q(s.$$.fragment,h),h.forEach(O),this.h()},h(){H(r,"class","flex flex-col items-center gap-2 md:flex-row")},m(a,h){te(a,r,h),k(r,e),k(r,n),J(s,r,null),l=!0},p(a,h){const p={};h&512&&(p.selected=a[9]),h&1024&&(p.list=a[10]),s.$set(p)},i(a){l||(C(s.$$.fragment,a),l=!0)},o(a){N(s.$$.fragment,a),l=!1},d(a){a&&O(r),G(s)}}}function Je(o){let r,e,t,n,s="Consumption",l,a,h,p,R,w,I,i="Data started at:",P,b,y=pe(o[7])+"",A,V;a=new Ce({props:{name:"chart-type-toggle",selected:o[0],onchange:o[11],list:[{label:"Exceedance",value:_.EXCEEDANCE},{label:"Measured",value:_.PLAIN},{label:"Repartition",value:_.REPARTITION}]}});let g=o[0]===_.PLAIN&&Ee(o),u=o[0]===_.EXCEEDANCE&&_e(o);return{c(){r=L("div"),e=L("div"),t=L("div"),n=L("span"),n.textContent=s,l=F(),Z(a.$$.fragment),h=F(),g&&g.c(),p=F(),u&&u.c(),R=F(),w=L("div"),I=L("span"),I.textContent=i,P=F(),b=L("span"),A=Re(y),this.h()},l(f){r=M(f,"DIV",{class:!0});var T=Y(r);e=M(T,"DIV",{class:!0});var S=Y(e);t=M(S,"DIV",{class:!0});var D=Y(t);n=M(D,"SPAN",{"data-svelte-h":!0}),me(n)!=="svelte-1vrp2az"&&(n.textContent=s),l=z(D),Q(a.$$.fragment,D),D.forEach(O),h=z(S),g&&g.l(S),p=z(S),u&&u.l(S),S.forEach(O),R=z(T),w=M(T,"DIV",{class:!0});var K=Y(w);I=M(K,"SPAN",{"data-svelte-h":!0}),me(I)!=="svelte-1cta1ja"&&(I.textContent=i),P=z(K),b=M(K,"SPAN",{class:!0});var re=Y(b);A=Oe(re,y),re.forEach(O),K.forEach(O),T.forEach(O),this.h()},h(){H(t,"class","flex flex-col items-center gap-2 md:flex-row"),H(e,"class","flex flex-col items-center gap-4 lg:flex-row"),H(b,"class","font-semibold"),H(w,"class","flex items-center gap-1 text-sm"),H(r,"class","flex flex-col-reverse items-center gap-4 py-4 lg:flex-row lg:justify-between lg:gap-0 lg:py-2")},m(f,T){te(f,r,T),k(r,e),k(e,t),k(t,n),k(t,l),J(a,t,null),k(e,h),g&&g.m(e,null),k(e,p),u&&u.m(e,null),k(r,R),k(r,w),k(w,I),k(w,P),k(w,b),k(b,A),V=!0},p(f,T){const S={};T&1&&(S.selected=f[0]),a.$set(S),f[0]===_.PLAIN?g?(g.p(f,T),T&1&&C(g,1)):(g=Ee(f),g.c(),C(g,1),g.m(e,p)):g&&(oe(),N(g,1,1,()=>{g=null}),ae()),f[0]===_.EXCEEDANCE?u?(u.p(f,T),T&1&&C(u,1)):(u=_e(f),u.c(),C(u,1),u.m(e,null)):u&&(oe(),N(u,1,1,()=>{u=null}),ae()),(!V||T&128)&&y!==(y=pe(f[7])+"")&&we(A,y)},i(f){V||(C(a.$$.fragment,f),C(g),C(u),V=!0)},o(f){N(a.$$.fragment,f),N(g),N(u),V=!1},d(f){f&&O(r),G(a),g&&g.d(),u&&u.d()}}}function Ae(o){let r,e,t=o[8].length>o[27]&&de(ue(o));return{c(){t&&t.c(),r=le()},l(n){t&&t.l(n),r=le()},m(n,s){t&&t.m(n,s),te(n,r,s),e=!0},p(n,s){n[8].length>n[27]?t?(t.p(ue(n),s),s&67109120&&C(t,1)):(t=de(ue(n)),t.c(),C(t,1),t.m(r.parentNode,r)):t&&(oe(),N(t,1,1,()=>{t=null}),ae())},i(n){e||(C(t),e=!0)},o(n){N(t),e=!1},d(n){n&&O(r),t&&t.d(n)}}}function de(o){let r,e;return r=new He({props:{params:o[26],currentItem:o[28],aggregation:o[4],unit:o[3],showTotal:[`${_.REPARTITION}`,`${_.EXCEEDANCE}`].includes(o[0])}}),{c(){Z(r.$$.fragment)},l(t){Q(r.$$.fragment,t)},m(t,n){J(r,t,n),e=!0},p(t,n){const s={};n&67108864&&(s.params=t[26]),n&67109120&&(s.currentItem=t[28]),n&16&&(s.aggregation=t[4]),n&8&&(s.unit=t[3]),n&1&&(s.showTotal=[`${_.REPARTITION}`,`${_.EXCEEDANCE}`].includes(t[0])),r.$set(s)},i(t){e||(C(r.$$.fragment,t),e=!0)},o(t){N(r.$$.fragment,t),e=!1},d(t){G(r,t)}}}function Qe(o){let r,e,t=o[26]!==void 0&&Ae(ge(o));return{c(){t&&t.c(),r=le()},l(n){t&&t.l(n),r=le()},m(n,s){t&&t.m(n,s),te(n,r,s),e=!0},p(n,s){n[26]!==void 0?t?(t.p(ge(n),s),s&67108864&&C(t,1)):(t=Ae(ge(n)),t.c(),C(t,1),t.m(r.parentNode,r)):t&&(oe(),N(t,1,1,()=>{t=null}),ae())},i(n){e||(C(t),e=!0)},o(n){N(t),e=!1},d(n){n&&O(r),t&&t.d(n)}}}function Ze(o){let r,e,t,n;return t=new Le({props:{type:o[0],color:o[1],labels:o[2],unit:o[3],aggregation:o[4],timeseries:o[8],showAverageMarkline:o[6],onclick:o[14],$$slots:{tooltip:[Qe,({params:s})=>({26:s}),({params:s})=>s?67108864:0],footer:[Je],headerActions:[Ge]},$$scope:{ctx:o}}}),{c(){r=L("div"),e=L("div"),Z(t.$$.fragment),this.h()},l(s){r=M(s,"DIV",{class:!0});var l=Y(r);e=M(l,"DIV",{class:!0});var a=Y(e);Q(t.$$.fragment,a),a.forEach(O),l.forEach(O),this.h()},h(){H(e,"class","absolute top-0 right-0 bottom-0 left-0"),H(r,"class","relative grow")},m(s,l){te(s,r,l),k(r,e),J(t,e,null),n=!0},p(s,[l]){const a={};l&1&&(a.type=s[0]),l&2&&(a.color=s[1]),l&4&&(a.labels=s[2]),l&8&&(a.unit=s[3]),l&16&&(a.aggregation=s[4]),l&256&&(a.timeseries=s[8]),l&64&&(a.showAverageMarkline=s[6]),l&603981817&&(a.$$scope={dirty:l,ctx:s}),t.$set(a)},i(s){n||(C(t.$$.fragment,s),n=!0)},o(s){N(t.$$.fragment,s),n=!1},d(s){s&&O(r),G(t)}}}function xe(o,r,e){q.extend(Fe);const t={[`${_.PLAIN}`]:["Consumption"],[`${_.EXCEEDANCE}`]:["Consumption","Exceedance"],[`${_.REPARTITION}`]:["Shared with me","Bought from market"]},n={[`${_.PLAIN}`]:[ie],[`${_.EXCEEDANCE}`]:[ie,Ke],[`${_.REPARTITION}`]:[Ve,ie]};let s=_.PLAIN,l=n[s],a=t[s],h=$.KWH,p=E.MONTH,R=W.YEAR,w=!1,I,i=[],P=[],b="0",y=[],{data:A}=r;const V=c=>{e(0,s=_.PLAIN),e(3,h=$.KWH),e(4,p=E.MONTH),e(5,R=W.YEAR),e(8,i=c.months.plain),e(7,I=i[0].startedAt),e(1,l=n[s]),e(2,a=t[s]),D(),console.log("ElectricityConsumption.onData",c)};let g=[];const u=c=>c.map(({startedAt:d,endedAt:m,value:X,anotherValue:B})=>({startedAt:d,endedAt:m,value:X,anotherValue:B})),f=c=>{const d=s===_.REPARTITION?"repartition":"plain",m=c[d];return Array.isArray(m)&&m.length>0?(g=u(m),u(m)):[]},T=c=>{e(0,s=c),e(3,h=$.KWH),e(6,w=!1),e(4,p=E.MONTH),e(5,R=W.YEAR),e(8,i=f(A.months)),e(7,I=i[0].startedAt),e(1,l=n[s]),e(2,a=t[s]),D()},S=c=>{if(e(9,b=c),console.log("ElectricityConsumption.onReferencePowerAmountChange ",b),b==="0"){P=[],e(8,i=u(g));return}K()},D=()=>{if(s!==_.EXCEEDANCE){e(9,b="0"),P=[],e(10,y=[]);return}const c=i.length;let d=3;c<=6?d=1:c<=12&&(d=2),e(10,y=[{label:"None",value:"0"}]);for(let m=1;m<=d;m++)y.push({value:String(m)});Number(b)>d&&e(9,b=String(d)),K()},K=()=>{const c=Number(b);if(e(8,i=u(g)),c<1)return;P=Ue(i,c).map(({startedAt:v,value:se},fe)=>{const x=10*fe;return{startedAt:v,value:Be(se,Xe(50-x,80-x))}}),We()&&(P[0].startedAt=void 0);let X=0,B=0,U=P[B],j=P[B+1];e(8,i=i.map(v=>{const{startedAt:se,value:fe}=v;U&&(!U.startedAt||q(se).isSameOrAfter(U.startedAt))&&(X=U?.value??0),j&&j.startedAt&&q(se).isSameOrAfter(j.startedAt)&&(B++,U=j,j=P[B+1],X=U?.value??0);let x=fe??0;const ce=x-X;return X<=0||ce<=0?(v.anotherValue=0,v):(v.value=x-ce,v.anotherValue=ce,v)})),U=void 0,j=void 0},re=(c,d)=>{if(e(3,h=$.KWH),d===W.YEAR){switch(c){case E.MONTH:e(8,i=f(A.months));break;case E.WEEK:e(8,i=f(A.weeks));break}e(7,I=i[0].startedAt),e(4,p=c),e(5,R=d),D();return}let m=ee(q(I).startOf("month"));switch(c){case E.WEEK:e(8,i=f(A.weeksMap[m]));break;case E.DAY:e(8,i=f(A.daysMap[m]));break;case E.HOUR:m=ee(I),e(8,i=f(A.hoursMap[m]));break}e(7,I=i[0].startedAt),e(4,p=c),e(5,R=d),D()},Ie=c=>{const{startedAt:d}=c;let m=ee(d);if(console.log("ElectricityConsumption.onChartClick timeserie",c),R===W.YEAR){switch(p){case E.MONTH:e(4,p=E.WEEK),e(8,i=f(A.weeksMap[m]));break;case E.WEEK:m=ee(q(d).startOf("month")),e(4,p=E.DAY),e(8,i=f(A.daysMap[m]));break}e(7,I=i[0].startedAt),e(5,R=W.MONTH),D();return}switch(p){case E.WEEK:m=ee(q(d).startOf("month")),e(4,p=E.DAY),e(8,i=f(A.daysMap[m]));break;case E.DAY:e(4,p=E.HOUR),e(8,i=f(A.hoursMap[m]));break;case E.HOUR:e(4,p=E.MINUTES),e(8,i=f(A.minutesMap[m])),e(3,h=$.KW);break}e(7,I=i[0].startedAt),[E.HOUR,E.MINUTES].includes(p)&&e(5,R=W.DAY),p!==E.MINUTES&&D()};function be(c){w=c,e(6,w)}return o.$$set=c=>{"data"in c&&e(15,A=c.data)},o.$$.update=()=>{o.$$.dirty&32768&&V(A)},[s,l,a,h,p,R,w,I,i,b,y,T,S,re,Ie,A,be]}class ft extends Te{constructor(r){super(),ke(this,r,xe,Ze,Ne,{data:15})}}export{ft as default};
