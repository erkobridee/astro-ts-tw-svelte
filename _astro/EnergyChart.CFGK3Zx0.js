import{S as de,i as ge,s as _e,E as qe,a as Ye,b as Ge,c as xe,e as x,t as L,f as D,g as ze,m as z,p as Q,u as X,v as Qe,Q as ke,d as v,w as ie,R as ve,h as Y,j as k,k as M,l as w,n as p,x as ce,o as P,q as C,y as fe,r as V,A as Re,M as ue,N as me,C as Be,D as Ue,F as Pe,T as Xe,O as Ie}from"./ECharts.C62Ux_iI.js";import{g as Je,d as Ze}from"./dayjs.min.2rai63wT.js";import{m as $e,C as q,c as et,g as G,n as re,L as he,o as Le,d as ye,p as Ve,q as tt,r as at,s as Ne,t as le,k as j,u as st,v as nt,f as ot}from"./ChartLoadingSpinner.B-S2mE50.js";import"./index.BcDxIk-V.js";var ee={exports:{}},rt=ee.exports,we;function lt(){return we||(we=1,function(s,e){(function(a,t){s.exports=t()})(rt,function(){return function(a,t){t.prototype.isSameOrBefore=function(r,n){return this.isSame(r,n)||this.isBefore(r,n)}}})}(ee)),ee.exports}var it=lt();const ct=Je(it);Ze.extend(ct);const $={KW:"kW",KWH:"kWh",M3:"mÂ³",UNDEFINED:""},S={MONTH:"month",WEEK:"week",DAY:"day",HOUR:"hour",MINUTES:"15_minutes",UNDEFINED:""},Nt={GAS:"GAS"};function ft(s){let e,a;return e=new et({props:{color:s[2]}}),{c(){X(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,r){z(e,t,r),a=!0},p(t,r){const n={};r&4&&(n.color=t[2]),e.$set(n)},i(t){a||(D(e.$$.fragment,t),a=!0)},o(t){L(e.$$.fragment,t),a=!1},d(t){x(e,t)}}}function ut(s){let e,a,t;function r(o){s[5](o)}let n={init:Ye,options:s[1],notMerge:!0,$$slots:{default:[ft]},$$scope:{ctx:s}};return s[0]!==void 0&&(n.chart=s[0]),e=new qe({props:n}),Ge.push(()=>xe(e,"chart",r)),{c(){X(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,l){z(e,o,l),t=!0},p(o,[l]){const i={};l&2&&(i.options=o[1]),l&132&&(i.$$scope={dirty:l,ctx:o}),!a&&l&1&&(a=!0,i.chart=o[0],ze(()=>a=!1)),e.$set(i)},i(o){t||(D(e.$$.fragment,o),t=!0)},o(o){L(e.$$.fragment,o),t=!1},d(o){x(e,o)}}}const mt=s=>{const e={};for(let a=0;a<s[0].data.length;++a)for(let t=0;t<s.length;++t){const r=s[t],n=r.stack;if(!n)continue;e[n]||(e[n]={stackStart:[],stackEnd:[]});const o=e[n],l=r.data[a];l&&!isNaN(l)&&(o.stackStart[a]==null&&(o.stackStart[a]=t),o.stackEnd[a]=t)}return e},ht=s=>{const e=mt(s);for(let a=0;a<s.length;++a){const t=s[a];if(!t.stack){t.itemStyle=Le(ye);continue}const r=t.data,n=r.length,o=e[t.stack];for(let l=0;l<n;++l){const i=o.stackEnd[l]===a;r[l]={value:r[l],itemStyle:Le(i?ye:0)}}}return s};function dt(s,e,a){let t,{chartOptions:r}=e,{onclick:n=$e}=e,o,l={};const i=u=>{const{color:h,categories:c,series:y,xAxisLabelFormatter:_,yAxisLabelFormatter:m=U=>G(U),tooltipFormatter:d}=u;console.log(u);const E={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:"rgba(150,150,150,0.1)"}},formatter:d},I={containLabel:!0,left:10,right:10,top:10,bottom:10},b=c.length,B={type:"category",data:c,axisLabel:{color:he,formatter:_,showMinLabel:b<30},axisTick:{show:!1,alignWithLabel:!0},axisLine:{lineStyle:re},splitLine:{show:!0,lineStyle:re,showMinLine:!1,showMaxLine:!1,interval:b>50?10:2}};a(1,l={color:h,tooltip:E,grid:I,xAxis:B,yAxis:{type:"value",position:"right",axisLabel:{verticalAlign:"bottom",padding:[0,-10,2,0],color:he,showMinLabel:!1,showMaxLabel:!1,formatter:m},splitLine:{lineStyle:re,showMaxLine:!1}},series:ht(y)})};Qe(()=>(o.on("click",n),console.log("BaseColumnsChart - mounted",{chart:o}),()=>{o.off("click",n),console.log("BaseColumnsChart - destroyed",{chart:o})}));function A(u){o=u,a(0,o)}return s.$$set=u=>{"chartOptions"in u&&a(3,r=u.chartOptions),"onclick"in u&&a(4,n=u.onclick)},s.$$.update=()=>{s.$$.dirty&8&&a(2,t=r.color[0]??q),s.$$.dirty&8&&i(r)},[o,l,t,r,n,A]}class gt extends de{constructor(e){super(),ge(this,e,dt,ut,_e,{chartOptions:3,onclick:4})}}function pe(s){let e,a;return{c(){e=C("span"),a=fe(s[3])},l(t){e=w(t,"SPAN",{});var r=p(e);a=ce(r,s[3]),r.forEach(v)},m(t,r){Y(t,e,r),k(e,a)},p(t,r){r&8&&ie(a,t[3])},d(t){t&&v(e)}}}function _t(s){let e,a,t,r,n,o,l=G(s[1],s[4])+"",i,A,u=s[3]&&pe(s);return{c(){e=C("div"),a=C("span"),t=fe(s[0]),r=V(),n=C("div"),o=C("span"),i=fe(l),A=V(),u&&u.c(),this.h()},l(h){e=w(h,"DIV",{class:!0});var c=p(e);a=w(c,"SPAN",{});var y=p(a);t=ce(y,s[0]),y.forEach(v),r=P(c),n=w(c,"DIV",{class:!0,style:!0});var _=p(n);o=w(_,"SPAN",{class:!0});var m=p(o);i=ce(m,l),m.forEach(v),A=P(_),u&&u.l(_),_.forEach(v),c.forEach(v),this.h()},h(){M(o,"class","text-sm tabular-nums"),M(n,"class","text-sm font-semibold"),ve(n,"color",s[2]),M(e,"class","flex items-center gap-2")},m(h,c){Y(h,e,c),k(e,a),k(a,t),k(e,r),k(e,n),k(n,o),k(o,i),k(n,A),u&&u.m(n,null)},p(h,[c]){c&1&&ie(t,h[0]),c&18&&l!==(l=G(h[1],h[4])+"")&&ie(i,l),h[3]?u?u.p(h,c):(u=pe(h),u.c(),u.m(n,null)):u&&(u.d(1),u=null),c&4&&ve(n,"color",h[2])},i:ke,o:ke,d(h){h&&v(e),u&&u.d()}}}function Et(s,e,a){let{label:t}=e,{value:r}=e,{valueColor:n=he}=e,{unit:o}=e,{maximumFractionDigits:l=Ve}=e;return s.$$set=i=>{"label"in i&&a(0,t=i.label),"value"in i&&a(1,r=i.value),"valueColor"in i&&a(2,n=i.valueColor),"unit"in i&&a(3,o=i.unit),"maximumFractionDigits"in i&&a(4,l=i.maximumFractionDigits)},[t,r,n,o,l]}class We extends de{constructor(e){super(),ge(this,e,Et,_t,_e,{label:0,value:1,valueColor:2,unit:3,maximumFractionDigits:4})}}const bt=s=>({}),Ce=s=>({}),At=s=>({}),Oe=s=>({});function Se(s){let e,a,t,r;e=new We({props:{label:s[5](0),value:s[3][0],valueColor:s[6](0),unit:s[0],maximumFractionDigits:s[1]}});let n=s[3][1]&&Te(s);return{c(){X(e.$$.fragment),a=V(),n&&n.c(),t=Ie()},l(o){Q(e.$$.fragment,o),a=P(o),n&&n.l(o),t=Ie()},m(o,l){z(e,o,l),Y(o,a,l),n&&n.m(o,l),Y(o,t,l),r=!0},p(o,l){const i={};l&8&&(i.value=o[3][0]),l&1&&(i.unit=o[0]),l&2&&(i.maximumFractionDigits=o[1]),e.$set(i),o[3][1]?n?(n.p(o,l),l&8&&D(n,1)):(n=Te(o),n.c(),D(n,1),n.m(t.parentNode,t)):n&&(ue(),L(n,1,1,()=>{n=null}),me())},i(o){r||(D(e.$$.fragment,o),D(n),r=!0)},o(o){L(e.$$.fragment,o),L(n),r=!1},d(o){o&&(v(a),v(t)),x(e,o),n&&n.d(o)}}}function Te(s){let e,a;return e=new We({props:{label:s[5](1),value:s[3][1],valueColor:s[6](1),unit:s[0],maximumFractionDigits:s[1]}}),{c(){X(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,r){z(e,t,r),a=!0},p(t,r){const n={};r&8&&(n.value=t[3][1]),r&1&&(n.unit=t[0]),r&2&&(n.maximumFractionDigits=t[1]),e.$set(n)},i(t){a||(D(e.$$.fragment,t),a=!0)},o(t){L(e.$$.fragment,t),a=!1},d(t){x(e,t)}}}function Fe(s){let e;const a=s[18].footer,t=Re(a,s,s[17],Ce);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,n){t&&t.m(r,n),e=!0},p(r,n){t&&t.p&&(!e||n&131072)&&Be(t,a,r,r[17],e?Pe(a,r[17],n,bt):Ue(r[17]),Ce)},i(r){e||(D(t,r),e=!0)},o(r){L(t,r),e=!1},d(r){t&&t.d(r)}}}function Dt(s){let e,a,t,r,n,o,l,i,A,u,h,c=s[2].length>0&&Se(s);const y=s[18].headerActions,_=Re(y,s,s[17],Oe);A=new gt({props:{chartOptions:s[4],onclick:s[7]}});let m=s[8].footer&&Fe(s);return{c(){e=C("div"),a=C("div"),t=C("div"),c&&c.c(),r=V(),n=C("div"),_&&_.c(),o=V(),l=C("div"),i=C("div"),X(A.$$.fragment),u=V(),m&&m.c(),this.h()},l(d){e=w(d,"DIV",{class:!0});var E=p(e);a=w(E,"DIV",{class:!0});var I=p(a);t=w(I,"DIV",{class:!0});var b=p(t);c&&c.l(b),b.forEach(v),r=P(I),n=w(I,"DIV",{});var B=p(n);_&&_.l(B),B.forEach(v),I.forEach(v),o=P(E),l=w(E,"DIV",{class:!0});var W=p(l);i=w(W,"DIV",{class:!0});var U=p(i);Q(A.$$.fragment,U),U.forEach(v),W.forEach(v),u=P(E),m&&m.l(E),E.forEach(v),this.h()},h(){M(t,"class","flex items-center gap-4"),M(a,"class","flex items-center justify-between"),M(i,"class","absolute top-0 right-0 bottom-0 left-0"),M(l,"class","relative grow"),M(e,"class","flex h-full grow flex-col gap-2")},m(d,E){Y(d,e,E),k(e,a),k(a,t),c&&c.m(t,null),k(a,r),k(a,n),_&&_.m(n,null),k(e,o),k(e,l),k(l,i),z(A,i,null),k(e,u),m&&m.m(e,null),h=!0},p(d,[E]){d[2].length>0?c?(c.p(d,E),E&4&&D(c,1)):(c=Se(d),c.c(),D(c,1),c.m(t,null)):c&&(ue(),L(c,1,1,()=>{c=null}),me()),_&&_.p&&(!h||E&131072)&&Be(_,y,d,d[17],h?Pe(y,d[17],E,At):Ue(d[17]),Oe);const I={};E&16&&(I.chartOptions=d[4]),A.$set(I),d[8].footer?m?(m.p(d,E),E&256&&D(m,1)):(m=Fe(d),m.c(),D(m,1),m.m(e,null)):m&&(ue(),L(m,1,1,()=>{m=null}),me())},i(d){h||(D(c),D(_,d),D(A.$$.fragment,d),D(m),h=!0)},o(d){L(c),L(_,d),L(A.$$.fragment,d),L(m),h=!1},d(d){d&&v(e),c&&c.d(),_&&_.d(d),x(A),m&&m.d()}}}const Me={PLAIN:"PLAIN",REPARTITION:"REPARTITION"};function kt(s,e,a){let{$$slots:t={},$$scope:r}=e;const n=Xe(t);let{type:o=Me.PLAIN}=e,{showAverageMarkline:l=!1}=e,{unit:i=$.UNDEFINED}=e,{aggregation:A=S.UNDEFINED}=e,{maximumFractionDigits:u=Ve}=e,{color:h=q}=e,{timeseries:c=[]}=e,{referencePower:y=void 0}=e,{referencePowerOptions:_=tt}=e,{labels:m=["Consumption","Exceedance"]}=e,{onclick:d=at}=e,E=!1,I=[0,NaN],b={color:[],categories:[],series:[]};const B=(f,T,te,ae,se,ne,K,Ee,je)=>{E=W(te,ae);const be=!!Ee,Ae=f===Me.REPARTITION;let oe=0,De=0;const H=K.reduce((g,O)=>{const{startedAt:R,value:N=NaN,anotherValue:F=NaN}=O;return oe+=N??0,De+=F??0,g.startedAtData.push(R),Ae?(g.valueData.push(N),g.anotherValueData.push(F),g):(g.valueData.push(N),g)},{startedAtData:[],valueData:[],anotherValueData:[]});if(a(4,b.color=Array.isArray(ne)?ne:[ne],b),a(4,b.categories=H.startedAtData,b),Ae||be){a(3,I=[oe,De]);const g={type:"bar",stack:"energy",data:H.valueData},O={type:"bar",stack:"energy",data:H.anotherValueData};a(4,b.series=[g,O],b)}else{a(3,I=[oe,NaN]);const g={type:"bar",data:H.valueData};a(4,b.series=[g],b)}b.series.forEach(g=>{if(T){let O=g.markLine;const R={type:"average",label:{padding:[0,0,0,-5],shadowColor:"white",shadowBlur:2,shadowOffsetY:2,fontWeight:"bold",formatter:N=>G(N.value,se)}};if(O){const{symbol:N=Ne,data:F=[]}=O;g.markLine={symbol:N,data:[...F,R]}}else g.markLine={symbol:Ne,data:[R]}}}),console.log("EnergyChart.updateChartOptions",{type:f,showAverageMarkline:T,unit:te,aggregation:ae,maximumFractionDigits:se,timeseries:K,isDrilldownEnabled:E,hasReferencePower:be,referencePower:Ee,referencePowerOptions:je,data:H});let J=st,Z=g=>nt(g.startedAt);switch(ae){case S.MONTH:J=le,Z=g=>le(g.startedAt);break;case S.WEEK:J=K.length>6?le:j,Z=g=>`${j(g.startedAt)} - ${j(g.endedAt)}`;break;case S.DAY:J=j,Z=g=>j(g.startedAt);break}a(4,b.xAxisLabelFormatter=J,b),a(4,b.tooltipFormatter=g=>{const O=g;let R=K[O[0].dataIndex],N="";return N+=`<div>${Z(R)}</div>`,O.forEach(F=>{R=K[F.dataIndex],N+=ot({color:F.color,value:`${G(F.value,se)} ${te}`})}),N},b)},W=(f,T)=>{switch(f){case $.M3:return![S.HOUR,S.MINUTES,S.UNDEFINED].includes(T);case $.KW:case $.KWH:return![S.MINUTES,S.UNDEFINED].includes(T);default:return!1}},U=(f=0)=>Array.isArray(m)?m[f]??"":m,Ke=(f=0)=>{let T=q;return h&&(T=Array.isArray(h)?h[f]??q:f===0?h:q),T},He=f=>{console.log("EnergyChart.onChartClick",{isDrilldownEnabled:E,event:f}),f.data&&d(c[f.dataIndex])};return s.$$set=f=>{"type"in f&&a(9,o=f.type),"showAverageMarkline"in f&&a(10,l=f.showAverageMarkline),"unit"in f&&a(0,i=f.unit),"aggregation"in f&&a(11,A=f.aggregation),"maximumFractionDigits"in f&&a(1,u=f.maximumFractionDigits),"color"in f&&a(12,h=f.color),"timeseries"in f&&a(2,c=f.timeseries),"referencePower"in f&&a(13,y=f.referencePower),"referencePowerOptions"in f&&a(14,_=f.referencePowerOptions),"labels"in f&&a(15,m=f.labels),"onclick"in f&&a(16,d=f.onclick),"$$scope"in f&&a(17,r=f.$$scope)},s.$$.update=()=>{s.$$.dirty&32263&&B(o,l,i,A,u,h,c,y,_)},[i,u,c,I,b,U,Ke,He,n,o,l,A,h,y,_,m,d,r,t]}class wt extends de{constructor(e){super(),ge(this,e,kt,Dt,_e,{type:9,showAverageMarkline:10,unit:0,aggregation:11,maximumFractionDigits:1,color:12,timeseries:2,referencePower:13,referencePowerOptions:14,labels:15,onclick:16})}}export{S as A,wt as E,$ as U,Nt as a};
