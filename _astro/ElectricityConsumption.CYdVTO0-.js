import{S as Ee,i as Ae,s as _e,d as M,e as Z,t as L,f as P,h as le,j as w,m as x,k as Y,l as D,n as V,p as $,q as S,u as ee,z as ce,A as fe,w as Ce,B as ae,o as z,x as de,r as F,y as be,b as Te,c as we,g as Ie}from"./ECharts.BHMBe_i9.js";import{d as q}from"./dayjs.min.2rai63wT.js";import{E as ke,i as Ne,a as C,U as J,A as E,b as W,c as Re,d as Oe}from"./AggregationLevelSelection.fnUR6ao8.js";import{T as Pe}from"./Toggle.D1UBLrgt.js";import{B as me}from"./ButtonsToggle.COVrHaPm.js";import{k as De,j as ne,l as Se,m as ge,n as Q}from"./ChartLoadingSpinner.DLXlFOzT.js";import{g as Me,a as ye,b as Le}from"./random.DTBvWXaA.js";import{g as He}from"./math.4fE8PRGd.js";import"./index.CFpG30dg.js";function Ye(a){let t,e;return t=new Re({props:{aggregation:a[4],energyType:Oe.ELECTRICITY,layout:a[5],onclick:a[13]}}),{c(){ee(t.$$.fragment)},l(r){$(t.$$.fragment,r)},m(r,g){x(t,r,g),e=!0},p(r,g){const s={};g&16&&(s.aggregation=r[4]),g&32&&(s.layout=r[5]),t.$set(s)},i(r){e||(P(t.$$.fragment,r),e=!0)},o(r){L(t.$$.fragment,r),e=!1},d(r){Z(t,r)}}}function ue(a){let t,e,r;function g(n){a[16](n)}let s={id:"showAverageToggle",label:"show average mark line"};return a[6]!==void 0&&(s.checked=a[6]),t=new Pe({props:s}),Te.push(()=>we(t,"checked",g)),{c(){ee(t.$$.fragment)},l(n){$(t.$$.fragment,n)},m(n,o){x(t,n,o),r=!0},p(n,o){const h={};!e&&o&64&&(e=!0,h.checked=n[6],Ie(()=>e=!1)),t.$set(h)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){L(t.$$.fragment,n),r=!1},d(n){Z(t,n)}}}function ie(a){let t,e,r="Reference power amount",g,s,n;return s=new me({props:{name:"reference-power-toggle",selected:a[9],onchange:a[12],list:a[10]}}),{c(){t=S("div"),e=S("span"),e.textContent=r,g=F(),ee(s.$$.fragment),this.h()},l(o){t=D(o,"DIV",{class:!0});var h=V(t);e=D(h,"SPAN",{"data-svelte-h":!0}),ae(e)!=="svelte-ukeiym"&&(e.textContent=r),g=z(h),$(s.$$.fragment,h),h.forEach(M),this.h()},h(){Y(t,"class","flex flex-col items-center gap-2 md:flex-row")},m(o,h){le(o,t,h),w(t,e),w(t,g),x(s,t,null),n=!0},p(o,h){const m={};h&512&&(m.selected=o[9]),h&1024&&(m.list=o[10]),s.$set(m)},i(o){n||(P(s.$$.fragment,o),n=!0)},o(o){L(s.$$.fragment,o),n=!1},d(o){o&&M(t),Z(s)}}}function Ve(a){let t,e,r,g,s="Consumption",n,o,h,m,k,I,d,c="Data started at:",N,b,y=ge(a[7])+"",A,v;o=new me({props:{name:"chart-type-toggle",selected:a[0],onchange:a[11],list:[{label:"Exceedance",value:C.EXCEEDANCE},{label:"Measured",value:C.PLAIN},{label:"Repartition",value:C.REPARTITION}]}});let u=a[0]===C.PLAIN&&ue(a),i=a[0]===C.EXCEEDANCE&&ie(a);return{c(){t=S("div"),e=S("div"),r=S("div"),g=S("span"),g.textContent=s,n=F(),ee(o.$$.fragment),h=F(),u&&u.c(),m=F(),i&&i.c(),k=F(),I=S("div"),d=S("span"),d.textContent=c,N=F(),b=S("span"),A=be(y),this.h()},l(l){t=D(l,"DIV",{class:!0});var T=V(t);e=D(T,"DIV",{class:!0});var R=V(e);r=D(R,"DIV",{class:!0});var O=V(r);g=D(O,"SPAN",{"data-svelte-h":!0}),ae(g)!=="svelte-1vrp2az"&&(g.textContent=s),n=z(O),$(o.$$.fragment,O),O.forEach(M),h=z(R),u&&u.l(R),m=z(R),i&&i.l(R),R.forEach(M),k=z(T),I=D(T,"DIV",{class:!0});var K=V(I);d=D(K,"SPAN",{"data-svelte-h":!0}),ae(d)!=="svelte-1cta1ja"&&(d.textContent=c),N=z(K),b=D(K,"SPAN",{class:!0});var te=V(b);A=de(te,y),te.forEach(M),K.forEach(M),T.forEach(M),this.h()},h(){Y(r,"class","flex flex-col items-center gap-2 md:flex-row"),Y(e,"class","flex flex-col items-center gap-4 lg:flex-row"),Y(b,"class","font-semibold"),Y(I,"class","flex items-center gap-1 text-sm"),Y(t,"class","flex flex-col-reverse items-center gap-4 py-4 lg:flex-row lg:justify-between lg:gap-0 lg:py-2")},m(l,T){le(l,t,T),w(t,e),w(e,r),w(r,g),w(r,n),x(o,r,null),w(e,h),u&&u.m(e,null),w(e,m),i&&i.m(e,null),w(t,k),w(t,I),w(I,d),w(I,N),w(I,b),w(b,A),v=!0},p(l,T){const R={};T&1&&(R.selected=l[0]),o.$set(R),l[0]===C.PLAIN?u?(u.p(l,T),T&1&&P(u,1)):(u=ue(l),u.c(),P(u,1),u.m(e,m)):u&&(ce(),L(u,1,1,()=>{u=null}),fe()),l[0]===C.EXCEEDANCE?i?(i.p(l,T),T&1&&P(i,1)):(i=ie(l),i.c(),P(i,1),i.m(e,null)):i&&(ce(),L(i,1,1,()=>{i=null}),fe()),(!v||T&128)&&y!==(y=ge(l[7])+"")&&Ce(A,y)},i(l){v||(P(o.$$.fragment,l),P(u),P(i),v=!0)},o(l){L(o.$$.fragment,l),L(u),L(i),v=!1},d(l){l&&M(t),Z(o),u&&u.d(),i&&i.d()}}}function ve(a){let t,e,r,g;return r=new ke({props:{type:a[0],color:a[1],labels:a[2],unit:a[3],aggregation:a[4],timeseries:a[8],showAverageMarkline:a[6],onclick:a[14],$$slots:{footer:[Ve],headerActions:[Ye]},$$scope:{ctx:a}}}),{c(){t=S("div"),e=S("div"),ee(r.$$.fragment),this.h()},l(s){t=D(s,"DIV",{class:!0});var n=V(t);e=D(n,"DIV",{class:!0});var o=V(e);$(r.$$.fragment,o),o.forEach(M),n.forEach(M),this.h()},h(){Y(e,"class","absolute top-0 right-0 bottom-0 left-0"),Y(t,"class","relative grow")},m(s,n){le(s,t,n),w(t,e),x(r,e,null),g=!0},p(s,[n]){const o={};n&1&&(o.type=s[0]),n&2&&(o.color=s[1]),n&4&&(o.labels=s[2]),n&8&&(o.unit=s[3]),n&16&&(o.aggregation=s[4]),n&256&&(o.timeseries=s[8]),n&64&&(o.showAverageMarkline=s[6]),n&67110641&&(o.$$scope={dirty:n,ctx:s}),r.$set(o)},i(s){g||(P(r.$$.fragment,s),g=!0)},o(s){L(r.$$.fragment,s),g=!1},d(s){s&&M(t),Z(r)}}}function Ke(a,t,e){q.extend(Ne);const r={[`${C.PLAIN}`]:["Consumption"],[`${C.EXCEEDANCE}`]:["Consumption","Exceedance"],[`${C.REPARTITION}`]:["Shared with me","Bought from market"]},g={[`${C.PLAIN}`]:[ne],[`${C.EXCEEDANCE}`]:[ne,Se],[`${C.REPARTITION}`]:[De,ne]};let s=C.PLAIN,n=g[s],o=r[s],h=J.KWH,m=E.MONTH,k=W.YEAR,I=!1,d,c=[],N=[],b="0",y=[],{data:A}=t;const v=f=>{e(0,s=C.PLAIN),e(3,h=J.KWH),e(4,m=E.MONTH),e(5,k=W.YEAR),e(8,c=f.months.plain),e(7,d=c[0].startedAt),e(1,n=g[s]),e(2,o=r[s]),O(),console.log("ElectricityConsumption.onData",f)};let u=[];const i=f=>f.map(({startedAt:_,endedAt:p,value:B,anotherValue:X})=>({startedAt:_,endedAt:p,value:B,anotherValue:X})),l=f=>{const _=s===C.REPARTITION?"repartition":"plain",p=f[_];return s===C.EXCEEDANCE&&Array.isArray(p)&&p.length>0&&(u=i(p)),c},T=f=>{e(0,s=f),e(3,h=J.KWH),e(6,I=!1),e(4,m=E.MONTH),e(5,k=W.YEAR),e(8,c=l(A.months)),e(7,d=c[0].startedAt),e(1,n=g[s]),e(2,o=r[s]),O()},R=f=>{if(e(9,b=f),console.log("ElectricityConsumption.onReferencePowerAmountChange ",b),b==="0"){N=[],e(8,c=i(u));return}K()},O=()=>{if(s!==C.EXCEEDANCE){e(9,b="0"),N=[],e(10,y=[]);return}const f=c.length;let _=3;f<=6?_=1:f<=12&&(_=2),e(10,y=[{label:"None",value:"0"}]);for(let p=1;p<=_;p++)y.push({value:String(p)});Number(b)>_&&e(9,b=String(_)),K()},K=()=>{const f=Number(b);if(e(8,c=i(u)),f<1)return;N=Me(c,f).map(({startedAt:H,value:se},re)=>{const G=10*re;return{startedAt:H,value:He(se,Le(50-G,80-G))}}),ye()&&(N[0].startedAt=void 0);let B=0,X=0,U=N[X],j=N[X+1];e(8,c=c.map(H=>{const{startedAt:se,value:re}=H;U&&(!U.startedAt||q(se).isSameOrAfter(U.startedAt))&&(B=U?.value??0),j&&j.startedAt&&q(se).isSameOrAfter(j.startedAt)&&(X++,U=j,j=N[X+1],B=U?.value??0);let G=re??0;const oe=G-B;return B<=0||oe<=0?(H.anotherValue=0,H):(H.value=G-oe,H.anotherValue=oe,H)})),U=void 0,j=void 0},te=(f,_)=>{if(e(3,h=J.KWH),_===W.YEAR){switch(f){case E.MONTH:e(8,c=l(A.months));break;case E.WEEK:e(8,c=l(A.weeks));break}e(7,d=c[0].startedAt),e(4,m=f),e(5,k=_),O();return}let p=Q(q(d).startOf("month"));switch(f){case E.WEEK:e(8,c=l(A.weeksMap[p]));break;case E.DAY:e(8,c=l(A.daysMap[p]));break;case E.HOUR:p=Q(d),e(8,c=l(A.hoursMap[p]));break}e(7,d=c[0].startedAt),e(4,m=f),e(5,k=_),O()},pe=f=>{const{startedAt:_}=f;let p=Q(_);if(console.log("ElectricityConsumption.onChartClick timeserie",f),k===W.YEAR){switch(m){case E.MONTH:e(4,m=E.WEEK),e(8,c=l(A.weeksMap[p]));break;case E.WEEK:p=Q(q(_).startOf("month")),e(4,m=E.DAY),e(8,c=l(A.daysMap[p]));break}e(7,d=c[0].startedAt),e(5,k=W.MONTH),O();return}switch(m){case E.WEEK:p=Q(q(_).startOf("month")),e(4,m=E.DAY),e(8,c=l(A.daysMap[p]));break;case E.DAY:e(4,m=E.HOUR),e(8,c=l(A.hoursMap[p]));break;case E.HOUR:e(4,m=E.MINUTES),e(8,c=l(A.minutesMap[p])),e(3,h=J.KW);break}e(7,d=c[0].startedAt),[E.HOUR,E.MINUTES].includes(m)&&e(5,k=W.DAY),m!==E.MINUTES&&O()};function he(f){I=f,e(6,I)}return a.$$set=f=>{"data"in f&&e(15,A=f.data)},a.$$.update=()=>{a.$$.dirty&32768&&v(A)},[s,n,o,h,m,k,I,d,c,b,y,T,R,te,pe,A,he]}class Je extends Ee{constructor(t){super(),Ae(this,t,Ke,ve,_e,{data:15})}}export{Je as default};
