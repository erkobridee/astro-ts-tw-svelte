import{S as ne,i as le,s as re,z as F,d as O,h as B,k as C,l as R,n as w,q as v,A as ue,B as fe,C as J,w as oe,j as k,D as Q,o as P,x as ce,r as S,y as ie,e as V,t as H,f as D,m as j,p as G,u as X,F as ge,G as _e,H as Z,b as he,c as me,g as de}from"./ECharts.C5Iir41h.js";import{d as q}from"./dayjs.min.2rai63wT.js";import{e as x,u as pe,d as Ee,E as be,a as N,U as Y,A as p,b as Ae}from"./EnergyChart.DLiAY58f.js";import{c as K,A as M,a as ke}from"./AggregationLevelSelection.BaQ6EWlV.js";import{T as Ce}from"./Toggle.DGDEntvT.js";import{h as W,i as $,j as Ie,k as Te,l as U}from"./ChartLoadingSpinner.CnPI2XLW.js";import"./index.BAn-HqPX.js";function ee(r,t,e){const s=r.slice();s[9]=t[e],s[12]=e;const c=s[9].disabled||s[2];return s[10]=c,s}function te(r,t){let e,s,c,l=!1,a,n,i,_=t[9].label+"",m,b,u,f,h,L,E;return h=ue(t[8][0]),{key:r,first:null,c(){e=v("label"),s=v("input"),n=S(),i=v("span"),m=ie(_),u=S(),this.h()},l(I){e=R(I,"LABEL",{class:!0});var o=w(e);s=R(o,"INPUT",{class:!0,type:!0,name:!0}),n=P(o),i=R(o,"SPAN",{class:!0});var d=w(i);m=ce(d,_),d.forEach(O),u=P(o),o.forEach(O),this.h()},h(){C(s,"class","peer hidden"),C(s,"type","radio"),C(s,"name",t[1]),s.__value=c=t[9].value,J(s,s.__value),s.disabled=a=t[10],C(i,"class",b=K(se,{"rounded-l-md":t[12]===0,"rounded-r-md":t[12]===t[4]})),C(e,"class",f=K("inline-flex items-center rounded-md text-gray-800",{"cursor-pointer":!t[10]})),h.p(s),this.first=e},m(I,o){B(I,e,o),k(e,s),s.checked=s.__value===t[0],k(e,n),k(e,i),k(i,m),k(e,u),L||(E=[Q(s,"change",t[7]),Q(s,"input",t[5])],L=!0)},p(I,o){t=I,o&2&&C(s,"name",t[1]),o&8&&c!==(c=t[9].value)&&(s.__value=c,J(s,s.__value),l=!0),o&12&&a!==(a=t[10])&&(s.disabled=a),(l||o&9)&&(s.checked=s.__value===t[0]),o&8&&_!==(_=t[9].label+"")&&oe(m,_),o&24&&b!==(b=K(se,{"rounded-l-md":t[12]===0,"rounded-r-md":t[12]===t[4]}))&&C(i,"class",b),o&12&&f!==(f=K("inline-flex items-center rounded-md text-gray-800",{"cursor-pointer":!t[10]}))&&C(e,"class",f)},d(I){I&&O(e),h.r(),L=!1,fe(E)}}}function Ne(r){let t,e=[],s=new Map,c=x(r[3]);const l=a=>a[9].value;for(let a=0;a<c.length;a+=1){let n=ee(r,c,a),i=l(n);s.set(i,e[a]=te(i,n))}return{c(){t=v("div");for(let a=0;a<e.length;a+=1)e[a].c();this.h()},l(a){t=R(a,"DIV",{class:!0});var n=w(t);for(let i=0;i<e.length;i+=1)e[i].l(n);n.forEach(O),this.h()},h(){C(t,"class","flex items-center")},m(a,n){B(a,t,n);for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(t,null)},p(a,[n]){n&63&&(c=x(a[3]),e=pe(e,n,l,1,a,c,s,t,Ee,te,null,ee))},i:F,o:F,d(a){a&&O(t);for(let n=0;n<e.length;n+=1)e[n].d()}}}const Oe=()=>{},se="bg-gray-300 px-4 py-1 peer-checked:bg-blue-300 peer-disabled:opacity-50";function ye(r,t,e){let s,{name:c}=t,{selected:l}=t,{disabled:a=!1}=t,{list:n}=t,{onchange:i=Oe}=t;const _=u=>{i(u.target?.value)},m=[[]];function b(){l=this.__value,e(0,l)}return r.$$set=u=>{"name"in u&&e(1,c=u.name),"selected"in u&&e(0,l=u.selected),"disabled"in u&&e(2,a=u.disabled),"list"in u&&e(3,n=u.list),"onchange"in u&&e(6,i=u.onchange)},r.$$.update=()=>{r.$$.dirty&8&&e(4,s=n.length-1)},[l,c,a,n,s,_,i,b,m]}class Re extends ne{constructor(t){super(),le(this,t,ye,Ne,re,{name:1,selected:0,disabled:2,list:3,onchange:6})}}function ve(r){let t,e;return t=new ke({props:{aggregation:r[4],energyType:Ae.ELECTRICITY,layout:r[5],onclick:r[10]}}),{c(){X(t.$$.fragment)},l(s){G(t.$$.fragment,s)},m(s,c){j(t,s,c),e=!0},p(s,c){const l={};c&16&&(l.aggregation=s[4]),c&32&&(l.layout=s[5]),t.$set(l)},i(s){e||(D(t.$$.fragment,s),e=!0)},o(s){H(t.$$.fragment,s),e=!1},d(s){V(t,s)}}}function ae(r){let t,e,s;function c(a){r[13](a)}let l={id:"showAverageToggle",label:"show average mark line"};return r[6]!==void 0&&(l.checked=r[6]),t=new Ce({props:l}),he.push(()=>me(t,"checked",c)),{c(){X(t.$$.fragment)},l(a){G(t.$$.fragment,a)},m(a,n){j(t,a,n),s=!0},p(a,n){const i={};!e&&n&64&&(e=!0,i.checked=a[6],de(()=>e=!1)),t.$set(i)},i(a){s||(D(t.$$.fragment,a),s=!0)},o(a){H(t.$$.fragment,a),s=!1},d(a){V(t,a)}}}function Le(r){let t,e,s,c,l="Consumption",a,n,i,_,m,b,u="Data started at:",f,h,L=$(r[7])+"",E,I;n=new Re({props:{name:"buttons-toggle",selected:r[0],onchange:r[9],list:[{label:"Measured",value:N.PLAIN},{label:"Repartition",value:N.REPARTITION},{label:"Exceedance",value:N.EXCEEDANCE,disabled:!0}]}});let o=r[0]===N.PLAIN&&ae(r);return{c(){t=v("div"),e=v("div"),s=v("div"),c=v("span"),c.textContent=l,a=S(),X(n.$$.fragment),i=S(),o&&o.c(),_=S(),m=v("div"),b=v("span"),b.textContent=u,f=S(),h=v("span"),E=ie(L),this.h()},l(d){t=R(d,"DIV",{class:!0});var y=w(t);e=R(y,"DIV",{class:!0});var g=w(e);s=R(g,"DIV",{class:!0});var T=w(s);c=R(T,"SPAN",{"data-svelte-h":!0}),Z(c)!=="svelte-1vrp2az"&&(c.textContent=l),a=P(T),G(n.$$.fragment,T),T.forEach(O),i=P(g),o&&o.l(g),g.forEach(O),_=P(y),m=R(y,"DIV",{class:!0});var A=w(m);b=R(A,"SPAN",{"data-svelte-h":!0}),Z(b)!=="svelte-1cta1ja"&&(b.textContent=u),f=P(A),h=R(A,"SPAN",{class:!0});var z=w(h);E=ce(z,L),z.forEach(O),A.forEach(O),y.forEach(O),this.h()},h(){C(s,"class","flex flex-col items-center gap-2 md:flex-row"),C(e,"class","flex flex-col items-center gap-4 lg:flex-row"),C(h,"class","font-semibold"),C(m,"class","flex items-center gap-1 text-sm"),C(t,"class","flex flex-col-reverse items-center gap-4 py-4 lg:flex-row lg:justify-between lg:gap-0 lg:py-2")},m(d,y){B(d,t,y),k(t,e),k(e,s),k(s,c),k(s,a),j(n,s,null),k(e,i),o&&o.m(e,null),k(t,_),k(t,m),k(m,b),k(m,f),k(m,h),k(h,E),I=!0},p(d,y){const g={};y&1&&(g.selected=d[0]),n.$set(g),d[0]===N.PLAIN?o?(o.p(d,y),y&1&&D(o,1)):(o=ae(d),o.c(),D(o,1),o.m(e,null)):o&&(ge(),H(o,1,1,()=>{o=null}),_e()),(!I||y&128)&&L!==(L=$(d[7])+"")&&oe(E,L)},i(d){I||(D(n.$$.fragment,d),D(o),I=!0)},o(d){H(n.$$.fragment,d),H(o),I=!1},d(d){d&&O(t),V(n),o&&o.d()}}}function we(r){let t,e,s,c;return s=new be({props:{type:r[0],color:r[1],labels:r[2],unit:r[3],aggregation:r[4],timeseries:r[8],showAverageMarkline:r[6],onclick:r[11],$$slots:{footer:[Le],headerActions:[ve]},$$scope:{ctx:r}}}),{c(){t=v("div"),e=v("div"),X(s.$$.fragment),this.h()},l(l){t=R(l,"DIV",{class:!0});var a=w(t);e=R(a,"DIV",{class:!0});var n=w(e);G(s.$$.fragment,n),n.forEach(O),a.forEach(O),this.h()},h(){C(e,"class","absolute top-0 right-0 bottom-0 left-0"),C(t,"class","relative grow")},m(l,a){B(l,t,a),k(t,e),j(s,e,null),c=!0},p(l,[a]){const n={};a&1&&(n.type=l[0]),a&2&&(n.color=l[1]),a&4&&(n.labels=l[2]),a&8&&(n.unit=l[3]),a&16&&(n.aggregation=l[4]),a&256&&(n.timeseries=l[8]),a&64&&(n.showAverageMarkline=l[6]),a&262385&&(n.$$scope={dirty:a,ctx:l}),s.$set(n)},i(l){c||(D(s.$$.fragment,l),c=!0)},o(l){H(s.$$.fragment,l),c=!1},d(l){l&&O(t),V(s)}}}function De(r,t,e){const s={[`${N.PLAIN}`]:["Consumption","Exceedance"],[`${N.PLAIN}_EXCEEDANCE`]:["Consumption","Exceedance"],[`${N.REPARTITION}`]:["Shared with me","Bought from market"]},c={[`${N.PLAIN}`]:[W],[`${N.PLAIN}_EXCEEDANCE`]:[W,Te],[`${N.REPARTITION}`]:[Ie,W]};let l=N.PLAIN,a=[W],n=["Consumption","Exceedance"],i=Y.KWH,_=p.MONTH,m=M.YEAR,b=!1,u,f=[],{data:h}=t;const L=g=>{e(0,l=N.PLAIN),e(3,i=Y.KWH),e(4,_=p.MONTH),e(8,f=g.months.plain),e(7,u=f[0].startedAt),e(1,a=c[l]),e(2,n=s[l]),console.log("ElectricityConsumption.onData",g)},E=g=>{const T=l===N.REPARTITION?"repartition":"plain";return g[T]},I=g=>{e(0,l=g),e(3,i=Y.KWH),e(6,b=!1),e(4,_=p.MONTH),e(5,m=M.YEAR),e(8,f=E(h.months)),e(7,u=f[0].startedAt),e(1,a=c[l]),e(2,n=s[l])},o=(g,T)=>{if(e(3,i=Y.KWH),T===M.YEAR){switch(g){case p.MONTH:e(8,f=E(h.months));break;case p.WEEK:e(8,f=E(h.weeks));break}e(7,u=f[0].startedAt),e(4,_=g),e(5,m=T);return}let A=U(q(u).startOf("month"));switch(g){case p.WEEK:e(8,f=E(h.weeksMap[A]));break;case p.DAY:e(8,f=E(h.daysMap[A]));break;case p.HOUR:A=U(u),e(8,f=E(h.hoursMap[A]));break}e(7,u=f[0].startedAt),e(4,_=g),e(5,m=T)},d=g=>{const{startedAt:T}=g;let A=U(T);if(console.log("ElectricityConsumption.onChartClick timeserie",g),m===M.YEAR){switch(_){case p.MONTH:e(4,_=p.WEEK),e(8,f=E(h.weeksMap[A]));break;case p.WEEK:A=U(q(T).startOf("month")),e(4,_=p.DAY),e(8,f=E(h.daysMap[A]));break}e(7,u=f[0].startedAt),e(5,m=M.MONTH);return}switch(_){case p.WEEK:A=U(q(T).startOf("month")),e(4,_=p.DAY),e(8,f=E(h.daysMap[A]));break;case p.DAY:e(4,_=p.HOUR),e(8,f=E(h.hoursMap[A]));break;case p.HOUR:e(4,_=p.MINUTES),e(8,f=E(h.minutesMap[A])),e(3,i=Y.KW);break}e(7,u=f[0].startedAt),[p.HOUR,p.MINUTES].includes(_)&&e(5,m=M.DAY)};function y(g){b=g,e(6,b)}return r.$$set=g=>{"data"in g&&e(12,h=g.data)},r.$$.update=()=>{r.$$.dirty&4096&&L(h)},[l,a,n,i,_,m,b,u,f,I,o,d,h,y]}class We extends ne{constructor(t){super(),le(this,t,De,we,re,{data:12})}}export{We as default};
