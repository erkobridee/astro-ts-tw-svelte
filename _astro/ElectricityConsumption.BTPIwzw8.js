import{S as ne,i as ae,s as le,d as D,e as v,t as S,f as R,h as x,j as d,m as q,k as y,l as O,n as L,p as z,q as P,u as F,z as $,A as ee,w as ce,B as Z,o as B,x as fe,r as V,y as ge,b as ue,c as ie,g as me}from"./ECharts.BHMBe_i9.js";import{d as J}from"./dayjs.min.2rai63wT.js";import{E as pe,a as C,U as X,A as E,b as K,c as he,d as Ee}from"./AggregationLevelSelection.lhvDKkoz.js";import{T as _e}from"./Toggle.D1UBLrgt.js";import{B as re}from"./ButtonsToggle.BWumItfM.js";import{i as Ae,h as Q,j as Ce,k as te,l as j}from"./ChartLoadingSpinner.CQx5T2HE.js";import{g as be}from"./random.DQNpRTiV.js";import"./index.CFpG30dg.js";function ke(a){let t,e;return t=new he({props:{aggregation:a[4],energyType:Ee.ELECTRICITY,layout:a[5],onclick:a[14]}}),{c(){F(t.$$.fragment)},l(r){z(t.$$.fragment,r)},m(r,c){q(t,r,c),e=!0},p(r,c){const s={};c&16&&(s.aggregation=r[4]),c&32&&(s.layout=r[5]),t.$set(s)},i(r){e||(R(t.$$.fragment,r),e=!0)},o(r){S(t.$$.fragment,r),e=!1},d(r){v(t,r)}}}function se(a){let t,e,r;function c(n){a[17](n)}let s={id:"showAverageToggle",label:"show average mark line"};return a[6]!==void 0&&(s.checked=a[6]),t=new _e({props:s}),ue.push(()=>ie(t,"checked",c)),{c(){F(t.$$.fragment)},l(n){z(t.$$.fragment,n)},m(n,o){q(t,n,o),r=!0},p(n,o){const u={};!e&&o&64&&(e=!0,u.checked=n[6],me(()=>e=!1)),t.$set(u)},i(n){r||(R(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){v(t,n)}}}function oe(a){let t,e,r="Reference power amount",c,s,n;return s=new re({props:{name:"reference-power-toggle",selected:a[10],onchange:a[13],list:a[11]}}),{c(){t=P("div"),e=P("span"),e.textContent=r,c=V(),F(s.$$.fragment),this.h()},l(o){t=O(o,"DIV",{class:!0});var u=L(t);e=O(u,"SPAN",{"data-svelte-h":!0}),Z(e)!=="svelte-ukeiym"&&(e.textContent=r),c=B(u),z(s.$$.fragment,u),u.forEach(D),this.h()},h(){y(t,"class","flex flex-col items-center gap-2 md:flex-row")},m(o,u){x(o,t,u),d(t,e),d(t,c),q(s,t,null),n=!0},p(o,u){const i={};u&1024&&(i.selected=o[10]),u&2048&&(i.list=o[11]),s.$set(i)},i(o){n||(R(s.$$.fragment,o),n=!0)},o(o){S(s.$$.fragment,o),n=!1},d(o){o&&D(t),v(s)}}}function we(a){let t,e,r,c,s="Consumption",n,o,u,i,N,I,b,g="Data started at:",H,w,M=te(a[7])+"",_,Y;o=new re({props:{name:"chart-type-toggle",selected:a[0],onchange:a[12],list:[{label:"Exceedance",value:C.EXCEEDANCE},{label:"Measured",value:C.PLAIN},{label:"Repartition",value:C.REPARTITION}]}});let l=a[0]===C.PLAIN&&se(a),m=a[0]===C.EXCEEDANCE&&oe(a);return{c(){t=P("div"),e=P("div"),r=P("div"),c=P("span"),c.textContent=s,n=V(),F(o.$$.fragment),u=V(),l&&l.c(),i=V(),m&&m.c(),N=V(),I=P("div"),b=P("span"),b.textContent=g,H=V(),w=P("span"),_=ge(M),this.h()},l(p){t=O(p,"DIV",{class:!0});var h=L(t);e=O(h,"DIV",{class:!0});var T=L(e);r=O(T,"DIV",{class:!0});var W=L(r);c=O(W,"SPAN",{"data-svelte-h":!0}),Z(c)!=="svelte-1vrp2az"&&(c.textContent=s),n=B(W),z(o.$$.fragment,W),W.forEach(D),u=B(T),l&&l.l(T),i=B(T),m&&m.l(T),T.forEach(D),N=B(h),I=O(h,"DIV",{class:!0});var U=L(I);b=O(U,"SPAN",{"data-svelte-h":!0}),Z(b)!=="svelte-1cta1ja"&&(b.textContent=g),H=B(U),w=O(U,"SPAN",{class:!0});var G=L(w);_=fe(G,M),G.forEach(D),U.forEach(D),h.forEach(D),this.h()},h(){y(r,"class","flex flex-col items-center gap-2 md:flex-row"),y(e,"class","flex flex-col items-center gap-4 lg:flex-row"),y(w,"class","font-semibold"),y(I,"class","flex items-center gap-1 text-sm"),y(t,"class","flex flex-col-reverse items-center gap-4 py-4 lg:flex-row lg:justify-between lg:gap-0 lg:py-2")},m(p,h){x(p,t,h),d(t,e),d(e,r),d(r,c),d(r,n),q(o,r,null),d(e,u),l&&l.m(e,null),d(e,i),m&&m.m(e,null),d(t,N),d(t,I),d(I,b),d(I,H),d(I,w),d(w,_),Y=!0},p(p,h){const T={};h&1&&(T.selected=p[0]),o.$set(T),p[0]===C.PLAIN?l?(l.p(p,h),h&1&&R(l,1)):(l=se(p),l.c(),R(l,1),l.m(e,i)):l&&($(),S(l,1,1,()=>{l=null}),ee()),p[0]===C.EXCEEDANCE?m?(m.p(p,h),h&1&&R(m,1)):(m=oe(p),m.c(),R(m,1),m.m(e,null)):m&&($(),S(m,1,1,()=>{m=null}),ee()),(!Y||h&128)&&M!==(M=te(p[7])+"")&&ce(_,M)},i(p){Y||(R(o.$$.fragment,p),R(l),R(m),Y=!0)},o(p){S(o.$$.fragment,p),S(l),S(m),Y=!1},d(p){p&&D(t),v(o),l&&l.d(),m&&m.d()}}}function de(a){let t,e,r,c;return r=new pe({props:{type:a[0],color:a[1],labels:a[2],unit:a[3],aggregation:a[4],timeseries:a[8],referencePower:a[9],showAverageMarkline:a[6],onclick:a[15],$$slots:{footer:[we],headerActions:[ke]},$$scope:{ctx:a}}}),{c(){t=P("div"),e=P("div"),F(r.$$.fragment),this.h()},l(s){t=O(s,"DIV",{class:!0});var n=L(t);e=O(n,"DIV",{class:!0});var o=L(e);z(r.$$.fragment,o),o.forEach(D),n.forEach(D),this.h()},h(){y(e,"class","absolute top-0 right-0 bottom-0 left-0"),y(t,"class","relative grow")},m(s,n){x(s,t,n),d(t,e),q(r,e,null),c=!0},p(s,[n]){const o={};n&1&&(o.type=s[0]),n&2&&(o.color=s[1]),n&4&&(o.labels=s[2]),n&8&&(o.unit=s[3]),n&16&&(o.aggregation=s[4]),n&256&&(o.timeseries=s[8]),n&512&&(o.referencePower=s[9]),n&64&&(o.showAverageMarkline=s[6]),n&16780529&&(o.$$scope={dirty:n,ctx:s}),r.$set(o)},i(s){c||(R(r.$$.fragment,s),c=!0)},o(s){S(r.$$.fragment,s),c=!1},d(s){s&&D(t),v(r)}}}function Ie(a,t,e){const r={[`${C.PLAIN}`]:["Consumption"],[`${C.EXCEEDANCE}`]:["Consumption","Exceedance"],[`${C.REPARTITION}`]:["Shared with me","Bought from market"]},c={[`${C.PLAIN}`]:[Q],[`${C.EXCEEDANCE}`]:[Q,Ce],[`${C.REPARTITION}`]:[Ae,Q]};let s=C.PLAIN,n=c[s],o=r[s],u=X.KWH,i=E.MONTH,N=K.YEAR,I=!1,b,g=[],H=[],w="0",M=[],{data:_}=t;const Y=f=>{e(0,s=C.PLAIN),e(3,u=X.KWH),e(4,i=E.MONTH),e(5,N=K.YEAR),e(8,g=f.months.plain),e(7,b=g[0].startedAt),e(1,n=c[s]),e(2,o=r[s]),h(),console.log("ElectricityConsumption.onData",f)},l=f=>{const A=s===C.REPARTITION?"repartition":"plain";return f[A]},m=f=>{e(0,s=f),e(3,u=X.KWH),e(6,I=!1),e(4,i=E.MONTH),e(5,N=K.YEAR),e(8,g=l(_.months)),e(7,b=g[0].startedAt),e(1,n=c[s]),e(2,o=r[s]),h()},p=f=>{if(e(10,w=f),console.log("ElectricityConsumption.onReferencePowerAmountChange ",w),w==="0"){e(9,H=[]);return}T()},h=()=>{if(s!==C.EXCEEDANCE){e(10,w="0"),e(9,H=[]),e(11,M=[]);return}const f=g.length;let A=3;f<=6?A=1:f<=12&&(A=2),Number(w)>A&&e(10,w=String(A)),e(11,M=[{label:"None",value:"0"}]);for(let k=1;k<=A;k++)M.push({value:String(k)});T()},T=()=>{const f=Number(w),A=be();console.log("ElectricityConsumption.defineReferencePower ",{amount:f,startAtBeginning:A})},W=(f,A)=>{if(e(3,u=X.KWH),A===K.YEAR){switch(f){case E.MONTH:e(8,g=l(_.months));break;case E.WEEK:e(8,g=l(_.weeks));break}e(7,b=g[0].startedAt),e(4,i=f),e(5,N=A),h();return}let k=j(J(b).startOf("month"));switch(f){case E.WEEK:e(8,g=l(_.weeksMap[k]));break;case E.DAY:e(8,g=l(_.daysMap[k]));break;case E.HOUR:k=j(b),e(8,g=l(_.hoursMap[k]));break}e(7,b=g[0].startedAt),e(4,i=f),e(5,N=A),h()},U=f=>{const{startedAt:A}=f;let k=j(A);if(console.log("ElectricityConsumption.onChartClick timeserie",f),N===K.YEAR){switch(i){case E.MONTH:e(4,i=E.WEEK),e(8,g=l(_.weeksMap[k]));break;case E.WEEK:k=j(J(A).startOf("month")),e(4,i=E.DAY),e(8,g=l(_.daysMap[k]));break}e(7,b=g[0].startedAt),e(5,N=K.MONTH),h();return}switch(i){case E.WEEK:k=j(J(A).startOf("month")),e(4,i=E.DAY),e(8,g=l(_.daysMap[k]));break;case E.DAY:e(4,i=E.HOUR),e(8,g=l(_.hoursMap[k]));break;case E.HOUR:e(4,i=E.MINUTES),e(8,g=l(_.minutesMap[k])),e(3,u=X.KW);break}e(7,b=g[0].startedAt),[E.HOUR,E.MINUTES].includes(i)&&e(5,N=K.DAY),h()};function G(f){I=f,e(6,I)}return a.$$set=f=>{"data"in f&&e(16,_=f.data)},a.$$.update=()=>{a.$$.dirty&65536&&Y(_)},[s,n,o,u,i,N,I,b,g,H,w,M,m,p,W,U,_,G]}class ye extends ne{constructor(t){super(),ae(this,t,Ie,de,le,{data:16})}}export{ye as default};
