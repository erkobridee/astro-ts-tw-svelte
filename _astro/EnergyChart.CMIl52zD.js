import{S as de,i as ge,s as _e,E as qe,a as Ye,b as ze,c as xe,e as z,t as L,f as k,g as Ge,m as x,p as G,u as Q,v as Qe,P as Ae,d as v,w as ie,Q as ve,h as q,j as A,k as M,l as p,n as C,x as ce,o as U,q as w,y as fe,r as V,z as Re,L as ue,M as me,B as Be,C as Pe,D as Ue,R as Xe,O as Ie}from"./ECharts.D95WmH5f.js";import{g as Je,d as Ze}from"./dayjs.min.2rai63wT.js";import{l as $e,C as j,c as et,g as Y,m as oe,L as he,n as Le,d as Ne,o as Ve,p as tt,q as at,r as ye,s as re,k as le,t as nt,u as st,f as ot}from"./ChartLoadingSpinner.Cld0SpUW.js";import"./index.mQcJkb5e.js";var J={exports:{}},rt=J.exports,pe;function lt(){return pe||(pe=1,function(n,e){(function(a,t){n.exports=t()})(rt,function(){return function(a,t){t.prototype.isSameOrBefore=function(r,s){return this.isSame(r,s)||this.isBefore(r,s)}}})}(J)),J.exports}var it=lt();const ct=Je(it);Ze.extend(ct);const X={KW:"kW",KWH:"kWh",M3:"mÂ³",UNDEFINED:""},F={MONTH:"month",WEEK:"week",DAY:"day",HOUR:"hour",MINUTES:"15_minutes",UNDEFINED:""};function ft(n){let e,a;return e=new et({props:{color:n[2]}}),{c(){Q(e.$$.fragment)},l(t){G(e.$$.fragment,t)},m(t,r){x(e,t,r),a=!0},p(t,r){const s={};r&4&&(s.color=t[2]),e.$set(s)},i(t){a||(k(e.$$.fragment,t),a=!0)},o(t){L(e.$$.fragment,t),a=!1},d(t){z(e,t)}}}function ut(n){let e,a,t;function r(o){n[5](o)}let s={init:Ye,options:n[1],notMerge:!0,$$slots:{default:[ft]},$$scope:{ctx:n}};return n[0]!==void 0&&(s.chart=n[0]),e=new qe({props:s}),ze.push(()=>xe(e,"chart",r)),{c(){Q(e.$$.fragment)},l(o){G(e.$$.fragment,o)},m(o,l){x(e,o,l),t=!0},p(o,[l]){const i={};l&2&&(i.options=o[1]),l&132&&(i.$$scope={dirty:l,ctx:o}),!a&&l&1&&(a=!0,i.chart=o[0],Ge(()=>a=!1)),e.$set(i)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){L(e.$$.fragment,o),t=!1},d(o){z(e,o)}}}const mt=n=>{const e={};for(let a=0;a<n[0].data.length;++a)for(let t=0;t<n.length;++t){const r=n[t],s=r.stack;if(!s)continue;e[s]||(e[s]={stackStart:[],stackEnd:[]});const o=e[s],l=r.data[a];l&&!isNaN(l)&&(o.stackStart[a]==null&&(o.stackStart[a]=t),o.stackEnd[a]=t)}return e},ht=n=>{const e=mt(n);for(let a=0;a<n.length;++a){const t=n[a];if(!t.stack){t.itemStyle=Le(Ne);continue}const r=t.data,s=r.length,o=e[t.stack];for(let l=0;l<s;++l){const i=o.stackEnd[l]===a;r[l]={value:r[l],itemStyle:Le(i?Ne:0)}}}return n};function dt(n,e,a){let t,{chartOptions:r}=e,{onclick:s=$e}=e,o,l={};const i=u=>{const{color:h,categories:c,series:N,xAxisLabelFormatter:g,yAxisLabelFormatter:m=P=>Y(P),tooltipFormatter:d}=u;console.log(u);const E={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:"rgba(150,150,150,0.1)"}},formatter:d},I={containLabel:!0,left:10,right:10,top:10,bottom:10},b=c.length,B={type:"category",data:c,axisLabel:{color:he,formatter:g,showMinLabel:b<50},axisTick:{show:!1,alignWithLabel:!0},axisLine:{lineStyle:oe},splitLine:{show:!0,lineStyle:oe,showMinLine:!1,showMaxLine:!1,interval:b>50?10:2}};a(1,l={color:h,tooltip:E,grid:I,xAxis:B,yAxis:{type:"value",position:"right",axisLabel:{verticalAlign:"bottom",padding:[0,-10,2,0],color:he,showMinLabel:!1,showMaxLabel:!1,formatter:m},splitLine:{lineStyle:oe,showMaxLine:!1}},series:ht(N)})};Qe(()=>(o.on("click",s),console.log("BaseColumnsChart - mounted",{chart:o}),()=>{o.off("click",s),console.log("BaseColumnsChart - destroyed",{chart:o})}));function D(u){o=u,a(0,o)}return n.$$set=u=>{"chartOptions"in u&&a(3,r=u.chartOptions),"onclick"in u&&a(4,s=u.onclick)},n.$$.update=()=>{n.$$.dirty&8&&a(2,t=r.color[0]??j),n.$$.dirty&8&&i(r)},[o,l,t,r,s,D]}class gt extends de{constructor(e){super(),ge(this,e,dt,ut,_e,{chartOptions:3,onclick:4})}}function Ce(n){let e,a;return{c(){e=w("span"),a=fe(n[3])},l(t){e=p(t,"SPAN",{});var r=C(e);a=ce(r,n[3]),r.forEach(v)},m(t,r){q(t,e,r),A(e,a)},p(t,r){r&8&&ie(a,t[3])},d(t){t&&v(e)}}}function _t(n){let e,a,t,r,s,o,l=Y(n[1],n[4])+"",i,D,u=n[3]&&Ce(n);return{c(){e=w("div"),a=w("span"),t=fe(n[0]),r=V(),s=w("div"),o=w("span"),i=fe(l),D=V(),u&&u.c(),this.h()},l(h){e=p(h,"DIV",{class:!0});var c=C(e);a=p(c,"SPAN",{});var N=C(a);t=ce(N,n[0]),N.forEach(v),r=U(c),s=p(c,"DIV",{class:!0,style:!0});var g=C(s);o=p(g,"SPAN",{class:!0});var m=C(o);i=ce(m,l),m.forEach(v),D=U(g),u&&u.l(g),g.forEach(v),c.forEach(v),this.h()},h(){M(o,"class","text-sm tabular-nums"),M(s,"class","text-sm font-semibold"),ve(s,"color",n[2]),M(e,"class","flex items-center gap-2")},m(h,c){q(h,e,c),A(e,a),A(a,t),A(e,r),A(e,s),A(s,o),A(o,i),A(s,D),u&&u.m(s,null)},p(h,[c]){c&1&&ie(t,h[0]),c&18&&l!==(l=Y(h[1],h[4])+"")&&ie(i,l),h[3]?u?u.p(h,c):(u=Ce(h),u.c(),u.m(s,null)):u&&(u.d(1),u=null),c&4&&ve(s,"color",h[2])},i:Ae,o:Ae,d(h){h&&v(e),u&&u.d()}}}function Et(n,e,a){let{label:t}=e,{value:r}=e,{valueColor:s=he}=e,{unit:o}=e,{maximumFractionDigits:l=Ve}=e;return n.$$set=i=>{"label"in i&&a(0,t=i.label),"value"in i&&a(1,r=i.value),"valueColor"in i&&a(2,s=i.valueColor),"unit"in i&&a(3,o=i.unit),"maximumFractionDigits"in i&&a(4,l=i.maximumFractionDigits)},[t,r,s,o,l]}class We extends de{constructor(e){super(),ge(this,e,Et,_t,_e,{label:0,value:1,valueColor:2,unit:3,maximumFractionDigits:4})}}const bt=n=>({}),we=n=>({}),Dt=n=>({}),Oe=n=>({});function Se(n){let e,a,t,r;e=new We({props:{label:n[5](0),value:n[3][0],valueColor:n[6](0),unit:n[0],maximumFractionDigits:n[1]}});let s=n[3][1]&&Te(n);return{c(){Q(e.$$.fragment),a=V(),s&&s.c(),t=Ie()},l(o){G(e.$$.fragment,o),a=U(o),s&&s.l(o),t=Ie()},m(o,l){x(e,o,l),q(o,a,l),s&&s.m(o,l),q(o,t,l),r=!0},p(o,l){const i={};l&8&&(i.value=o[3][0]),l&1&&(i.unit=o[0]),l&2&&(i.maximumFractionDigits=o[1]),e.$set(i),o[3][1]?s?(s.p(o,l),l&8&&k(s,1)):(s=Te(o),s.c(),k(s,1),s.m(t.parentNode,t)):s&&(ue(),L(s,1,1,()=>{s=null}),me())},i(o){r||(k(e.$$.fragment,o),k(s),r=!0)},o(o){L(e.$$.fragment,o),L(s),r=!1},d(o){o&&(v(a),v(t)),z(e,o),s&&s.d(o)}}}function Te(n){let e,a;return e=new We({props:{label:n[5](1),value:n[3][1],valueColor:n[6](1),unit:n[0],maximumFractionDigits:n[1]}}),{c(){Q(e.$$.fragment)},l(t){G(e.$$.fragment,t)},m(t,r){x(e,t,r),a=!0},p(t,r){const s={};r&8&&(s.value=t[3][1]),r&1&&(s.unit=t[0]),r&2&&(s.maximumFractionDigits=t[1]),e.$set(s)},i(t){a||(k(e.$$.fragment,t),a=!0)},o(t){L(e.$$.fragment,t),a=!1},d(t){z(e,t)}}}function Fe(n){let e;const a=n[18].footer,t=Re(a,n,n[17],we);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,s){t&&t.m(r,s),e=!0},p(r,s){t&&t.p&&(!e||s&131072)&&Be(t,a,r,r[17],e?Ue(a,r[17],s,bt):Pe(r[17]),we)},i(r){e||(k(t,r),e=!0)},o(r){L(t,r),e=!1},d(r){t&&t.d(r)}}}function kt(n){let e,a,t,r,s,o,l,i,D,u,h,c=n[2].length>0&&Se(n);const N=n[18].headerActions,g=Re(N,n,n[17],Oe);D=new gt({props:{chartOptions:n[4],onclick:n[7]}});let m=n[8].footer&&Fe(n);return{c(){e=w("div"),a=w("div"),t=w("div"),c&&c.c(),r=V(),s=w("div"),g&&g.c(),o=V(),l=w("div"),i=w("div"),Q(D.$$.fragment),u=V(),m&&m.c(),this.h()},l(d){e=p(d,"DIV",{class:!0});var E=C(e);a=p(E,"DIV",{class:!0});var I=C(a);t=p(I,"DIV",{class:!0});var b=C(t);c&&c.l(b),b.forEach(v),r=U(I),s=p(I,"DIV",{});var B=C(s);g&&g.l(B),B.forEach(v),I.forEach(v),o=U(E),l=p(E,"DIV",{class:!0});var W=C(l);i=p(W,"DIV",{class:!0});var P=C(i);G(D.$$.fragment,P),P.forEach(v),W.forEach(v),u=U(E),m&&m.l(E),E.forEach(v),this.h()},h(){M(t,"class","flex items-center gap-4"),M(a,"class","flex items-center justify-between"),M(i,"class","absolute top-0 right-0 bottom-0 left-0"),M(l,"class","relative grow"),M(e,"class","flex h-full grow flex-col gap-2")},m(d,E){q(d,e,E),A(e,a),A(a,t),c&&c.m(t,null),A(a,r),A(a,s),g&&g.m(s,null),A(e,o),A(e,l),A(l,i),x(D,i,null),A(e,u),m&&m.m(e,null),h=!0},p(d,[E]){d[2].length>0?c?(c.p(d,E),E&4&&k(c,1)):(c=Se(d),c.c(),k(c,1),c.m(t,null)):c&&(ue(),L(c,1,1,()=>{c=null}),me()),g&&g.p&&(!h||E&131072)&&Be(g,N,d,d[17],h?Ue(N,d[17],E,Dt):Pe(d[17]),Oe);const I={};E&16&&(I.chartOptions=d[4]),D.$set(I),d[8].footer?m?(m.p(d,E),E&256&&k(m,1)):(m=Fe(d),m.c(),k(m,1),m.m(e,null)):m&&(ue(),L(m,1,1,()=>{m=null}),me())},i(d){h||(k(c),k(g,d),k(D.$$.fragment,d),k(m),h=!0)},o(d){L(c),L(g,d),L(D.$$.fragment,d),L(m),h=!1},d(d){d&&v(e),c&&c.d(),g&&g.d(d),z(D),m&&m.d()}}}const Me={PLAIN:"PLAIN",REPARTITION:"REPARTITION"};function At(n,e,a){let{$$slots:t={},$$scope:r}=e;const s=Xe(t);let{type:o=Me.PLAIN}=e,{showAverageMarkline:l=!1}=e,{unit:i=X.UNDEFINED}=e,{aggregation:D=F.UNDEFINED}=e,{maximumFractionDigits:u=Ve}=e,{color:h=j}=e,{timeseries:c=[]}=e,{referencePower:N=void 0}=e,{referencePowerOptions:g=tt}=e,{labels:m=["Consumption","Exceedance"]}=e,{onclick:d=at}=e,E=!1,I=[0,NaN],b={color:[],categories:[],series:[]};const B=(f,S,Z,$,ee,te,K,Ee,je)=>{E=W(Z,$);const be=!!Ee,De=f===Me.REPARTITION;let ae=0,ke=0;const H=K.reduce((_,O)=>{const{startedAt:R,value:y=NaN,anotherValue:T=NaN}=O;return ae+=y??0,ke+=T??0,_.startedAtData.push(R),De?(_.valueData.push(y),_.anotherValueData.push(T),_):(_.valueData.push(y),_)},{startedAtData:[],valueData:[],anotherValueData:[]});if(a(4,b.color=Array.isArray(te)?te:[te],b),a(4,b.categories=H.startedAtData,b),De||be){a(3,I=[ae,ke]);const _={type:"bar",stack:"energy",data:H.valueData},O={type:"bar",stack:"energy",data:H.anotherValueData};a(4,b.series=[_,O],b)}else{a(3,I=[ae,NaN]);const _={type:"bar",data:H.valueData};a(4,b.series=[_],b)}b.series.forEach(_=>{if(S){let O=_.markLine;const R={type:"average",label:{fontWeight:"bold",formatter:y=>Y(y.value,ee)}};if(O){const{symbol:y=ye,data:T=[]}=O;_.markLine={symbol:y,data:[...T,R]}}else _.markLine={symbol:ye,data:[R]}}}),console.log("EnergyChart.updateChartOptions",{type:f,showAverageMarkline:S,unit:Z,aggregation:$,maximumFractionDigits:ee,timeseries:K,isDrilldownEnabled:E,hasReferencePower:be,referencePower:Ee,referencePowerOptions:je,data:H});let ne=nt,se=_=>st(_.startedAt);switch($){case F.MONTH:ne=re,se=_=>re(_.startedAt);break;case F.WEEK:ne=K.length>4?re:le,se=_=>`${le(_.startedAt)} - ${le(_.endedAt)}`;break}a(4,b.xAxisLabelFormatter=ne,b),a(4,b.tooltipFormatter=_=>{const O=_;let R=K[O[0].dataIndex],y="";return y+=`<div>${se(R)}</div>`,O.forEach(T=>{R=K[T.dataIndex],y+=ot({color:T.color,value:`${Y(T.value,ee)} ${Z}`})}),y},b)},W=(f,S)=>{switch(f){case X.M3:return![F.HOUR,F.MINUTES,F.UNDEFINED].includes(S);case X.KW:case X.KWH:return![F.MINUTES,F.UNDEFINED].includes(S);default:return!1}},P=(f=0)=>Array.isArray(m)?m[f]??"":m,Ke=(f=0)=>{let S=j;return h&&(S=Array.isArray(h)?h[f]??j:f===0?h:j),S},He=f=>{console.log("EnergyChart.onChartClick",{isDrilldownEnabled:E,event:f}),f.data&&d(c[f.dataIndex])};return n.$$set=f=>{"type"in f&&a(9,o=f.type),"showAverageMarkline"in f&&a(10,l=f.showAverageMarkline),"unit"in f&&a(0,i=f.unit),"aggregation"in f&&a(11,D=f.aggregation),"maximumFractionDigits"in f&&a(1,u=f.maximumFractionDigits),"color"in f&&a(12,h=f.color),"timeseries"in f&&a(2,c=f.timeseries),"referencePower"in f&&a(13,N=f.referencePower),"referencePowerOptions"in f&&a(14,g=f.referencePowerOptions),"labels"in f&&a(15,m=f.labels),"onclick"in f&&a(16,d=f.onclick),"$$scope"in f&&a(17,r=f.$$scope)},n.$$.update=()=>{n.$$.dirty&32263&&B(o,l,i,D,u,h,c,N,g)},[i,u,c,I,b,P,Ke,He,s,o,l,D,h,N,g,m,d,r,t]}class yt extends de{constructor(e){super(),ge(this,e,At,kt,_e,{type:9,showAverageMarkline:10,unit:0,aggregation:11,maximumFractionDigits:1,color:12,timeseries:2,referencePower:13,referencePowerOptions:14,labels:15,onclick:16})}}export{F as A,yt as E,X as U};
