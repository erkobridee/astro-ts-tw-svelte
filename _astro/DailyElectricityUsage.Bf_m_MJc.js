import{S as $,i as tt,s as et,E as At,a as yt,b as rt,c as ot,d as _,e as S,t as L,f as I,g as at,h as G,j as y,m as T,k as v,l as k,n as x,o as nt,p as R,q as E,r as st,u as F,v as kt,w as xt,x as Et,y as Dt}from"./ECharts.CpYfIO0D.js";import{d as K}from"./dayjs.min.2rai63wT.js";import"./index.DACIwEDX.js";import{h as H}from"./colors.DRy8vmPD.js";import{C as X,a as Ot,D as wt,b as St,W as Lt,c as It,d as J,L as Tt,e as Q,f as Rt,g as Ft,h as Nt}from"./ChartLoadingSpinner.CXen_2vL.js";import{T as Pt}from"./Toggle.DSrT7CON.js";function Z(s){let t,e,r,n;return{c(){t=E("div"),e=E("span"),r=Dt(s[0]),this.h()},l(i){t=k(i,"DIV",{class:!0});var c=x(t);e=k(c,"SPAN",{class:!0,title:!0});var l=x(e);r=Et(l,s[0]),l.forEach(_),c.forEach(_),this.h()},h(){v(e,"class","text-[0.7rem]"),v(e,"title",n="Unit: "+s[0]),v(t,"class","absolute top-2 left-4 z-10")},m(i,c){G(i,t,c),y(t,e),y(e,r)},p(i,c){c&1&&xt(r,i[0]),c&1&&n!==(n="Unit: "+i[0])&&v(e,"title",n)},d(i){i&&_(t)}}}function Gt(s){let t,e;return t=new It({props:{color:s[1]}}),{c(){F(t.$$.fragment)},l(r){R(t.$$.fragment,r)},m(r,n){T(t,r,n),e=!0},p(r,n){const i={};n&2&&(i.color=r[1]),t.$set(i)},i(r){e||(I(t.$$.fragment,r),e=!0)},o(r){L(t.$$.fragment,r),e=!1},d(r){S(t,r)}}}function Mt(s){let t,e,r,n,i,c,l=s[0]&&Z(s);function f(u){s[13](u)}let C={init:yt,options:s[3],notMerge:!0,$$slots:{default:[Gt]},$$scope:{ctx:s}};return s[2]!==void 0&&(C.chart=s[2]),n=new At({props:C}),rt.push(()=>ot(n,"chart",f)),{c(){t=E("div"),l&&l.c(),e=st(),r=E("div"),F(n.$$.fragment),this.h()},l(u){t=k(u,"DIV",{class:!0});var a=x(t);l&&l.l(a),e=nt(a),r=k(a,"DIV",{class:!0});var d=x(r);R(n.$$.fragment,d),d.forEach(_),a.forEach(_),this.h()},h(){v(r,"class","absolute top-0 right-0 bottom-0 left-0 overflow-hidden rounded-lg border border-gray-100"),v(t,"class","relative grow")},m(u,a){G(u,t,a),l&&l.m(t,null),y(t,e),y(t,r),T(n,r,null),c=!0},p(u,[a]){u[0]?l?l.p(u,a):(l=Z(u),l.c(),l.m(t,e)):l&&(l.d(1),l=null);const d={};a&8&&(d.options=u[3]),a&131074&&(d.$$scope={dirty:a,ctx:u}),!i&&a&4&&(i=!0,d.chart=u[2],at(()=>i=!1)),n.$set(d)},i(u){c||(I(n.$$.fragment,u),c=!0)},o(u){L(n.$$.fragment,u),c=!1},d(u){u&&_(t),l&&l.d(),S(n)}}}function Vt(s,t,e){let{unit:r=""}=t;const n=St,i=Lt;let{xAxisAttribute:c="startedAt"}=t,{yAxisAttribute:l="value"}=t,{currentColor:f=X}=t,{previousColor:C=X}=t,{colorOpacity:u=.55}=t,{backgroundColor:a=Ot}=t,{data:d={current:[],previous:[]}}=t,{onclick:p=wt}=t,h,M={};const it=(o,m,b,O,w,W,ut)=>{const dt=H(O,W),ft=H(w,W),ht=o.current.length>0;o=lt(o);const{current:B,previous:U}=o,Y=B.length-1,N=B.reduce((g,D,A)=>{const j=A===Y?O:dt,q=A===Y?w:ft;return g.xAxis.push(D[m]),g.current.push({value:D[b],date:D[m],itemStyle:{borderRadius:J,borderWidth:1,borderColor:j,color:j}}),g.previous.push({value:U[A][b],date:U[A][m],itemStyle:{borderRadius:J,borderWidth:1,borderColor:q,color:q}}),g},{xAxis:[],current:[],previous:[]}),P="2%",z=30,mt={top:z,bottom:z,left:"15%",right:P},gt={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:"rgba(150,150,150,0.1)"}},formatter:g=>{let D="";return g.forEach(A=>{D+=Rt({color:A.color,label:Q({date:A.data.date,template:n}),value:Ft(A.value)})}),D}},_t={type:"category",data:N.xAxis,axisLabel:{formatter:g=>Q({date:g,template:i}),color:Tt},axisLine:{show:!1},axisTick:{show:!1}},pt={type:"value",show:!1},bt={type:"bar",data:N.previous},vt=ht?{symbol:["none","none"],data:[{type:"average",x:P,lineStyle:{color:O,width:2,type:"solid"},emphasis:{disabled:!0},label:{show:!0,position:"insideStartTop",fontWeight:"bold",fontSize:12,formatter:g=>Number(g.value).toFixed(3)}},{type:"average",name:"Average",x:P,lineStyle:{color:"transparent"},label:{show:!0,position:"insideStartBottom",fontSize:12,formatter:"{b}",opacity:.8}}]}:void 0,Ct={type:"bar",data:N.current,barCategoryGap:25,markLine:vt};e(3,M={backgroundColor:ut,grid:mt,tooltip:gt,xAxis:_t,yAxis:pt,series:[bt,Ct]})},lt=o=>{if(o.current.length>0)return o;for(let m=6;m>=0;m--){let b=(m>0?K().subtract(m,"day"):K()).startOf("day");const O={startedAt:b.format(),endedAt:b.endOf("day").format(),value:0};b=b.subtract(1,"week").startOf("day");const w={startedAt:b.format(),endedAt:b.endOf("day").format(),value:0};o.current.push(O),o.previous.push(w)}return o},V=o=>{if(console.log("onChartClick",o),!o.data)return;const m=o.dataIndex;p({current:d.current[m],previous:d.previous[m]})};kt(()=>(h.on("click",V),console.log("EnergyOverviewChart - mounted",{chart:h}),()=>{h.off("click",V),console.log("EnergyOverviewChart - destroyed",{chart:h})}));function ct(o){h=o,e(2,h)}return s.$$set=o=>{"unit"in o&&e(0,r=o.unit),"xAxisAttribute"in o&&e(6,c=o.xAxisAttribute),"yAxisAttribute"in o&&e(7,l=o.yAxisAttribute),"currentColor"in o&&e(1,f=o.currentColor),"previousColor"in o&&e(8,C=o.previousColor),"colorOpacity"in o&&e(9,u=o.colorOpacity),"backgroundColor"in o&&e(10,a=o.backgroundColor),"data"in o&&e(11,d=o.data),"onclick"in o&&e(12,p=o.onclick)},s.$$.update=()=>{s.$$.dirty&4034&&it(d,c,l,f,C,u,a)},[r,f,h,M,n,i,c,l,C,u,a,d,p,ct]}class Wt extends ${constructor(t){super(),tt(this,t,Vt,Mt,et,{unit:0,tooltipDatetimeFormat:4,xAxisDatetimeFormat:5,xAxisAttribute:6,yAxisAttribute:7,currentColor:1,previousColor:8,colorOpacity:9,backgroundColor:10,data:11,onclick:12})}get tooltipDatetimeFormat(){return this.$$.ctx[4]}get xAxisDatetimeFormat(){return this.$$.ctx[5]}}function Bt(s){let t,e,r,n,i,c,l,f;r=new Wt({props:{data:s[1],unit:"kWh",currentColor:Nt,onclick:s[2]}});function C(a){s[4](a)}let u={label:"show data"};return s[0]!==void 0&&(u.checked=s[0]),c=new Pt({props:u}),rt.push(()=>ot(c,"checked",C)),{c(){t=E("div"),e=E("div"),F(r.$$.fragment),n=st(),i=E("div"),F(c.$$.fragment),this.h()},l(a){t=k(a,"DIV",{class:!0});var d=x(t);e=k(d,"DIV",{class:!0});var p=x(e);R(r.$$.fragment,p),p.forEach(_),n=nt(d),i=k(d,"DIV",{class:!0});var h=x(i);R(c.$$.fragment,h),h.forEach(_),d.forEach(_),this.h()},h(){v(e,"class","flex h-[250px] w-full sm:h-[300px] sm:w-[500px] lg:w-[600px]"),v(i,"class","flex"),v(t,"class","flex flex-col gap-2")},m(a,d){G(a,t,d),y(t,e),T(r,e,null),y(t,n),y(t,i),T(c,i,null),f=!0},p(a,[d]){const p={};d&2&&(p.data=a[1]),r.$set(p);const h={};!l&&d&1&&(l=!0,h.checked=a[0],at(()=>l=!1)),c.$set(h)},i(a){f||(I(r.$$.fragment,a),I(c.$$.fragment,a),f=!0)},o(a){L(r.$$.fragment,a),L(c.$$.fragment,a),f=!1},d(a){a&&_(t),S(r),S(c)}}}function Ut(s,t,e){let r,n=!0,{data:i}=t;const c=f=>{console.log("DailyElectricityUsage.onChartClick dayUsage:",f)};function l(f){n=f,e(0,n)}return s.$$set=f=>{"data"in f&&e(3,i=f.data)},s.$$.update=()=>{s.$$.dirty&9&&e(1,r=n?i:{current:[],previous:[]})},[n,r,c,i,l]}class Jt extends ${constructor(t){super(),tt(this,t,Ut,Bt,et,{data:3})}}export{Jt as default};
