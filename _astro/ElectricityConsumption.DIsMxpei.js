import{S as _e,i as Ce,s as de,d as M,e as Q,t as L,f as S,h as fe,j as T,m as Z,k as H,l as P,n as Y,p as $,q as D,u as ee,z as ce,A as ie,w as be,B as le,o as q,x as Ie,r as z,y as Te,b as we,c as Oe,g as ke}from"./ECharts.BHMBe_i9.js";import{g as Ne,d as x}from"./dayjs.min.2rai63wT.js";import{E as Re,a as C,U as G,A as E,b as W,c as Se,d as Pe}from"./AggregationLevelSelection.Dc_MvoRT.js";import{T as De}from"./Toggle.D1UBLrgt.js";import{B as he}from"./ButtonsToggle.Cjd6e8aE.js";import{k as Me,j as ae,o as ye,m as ue,n as J}from"./ChartLoadingSpinner.1sCZ1qjV.js";import{g as Le,a as ve,b as He}from"./random.DTBvWXaA.js";import{g as Ye}from"./math.4fE8PRGd.js";import"./index.CFpG30dg.js";var se={exports:{}},Ve=se.exports,ge;function Ke(){return ge||(ge=1,function(a,r){(function(e,s){a.exports=s()})(Ve,function(){return function(e,s){s.prototype.isSameOrAfter=function(f,t){return this.isSame(f,t)||this.isAfter(f,t)}}})}(se)),se.exports}var Ue=Ke();const We=Ne(Ue);function Be(a){let r,e;return r=new Se({props:{aggregation:a[4],energyType:Pe.ELECTRICITY,layout:a[5],onclick:a[13]}}),{c(){ee(r.$$.fragment)},l(s){$(r.$$.fragment,s)},m(s,f){Z(r,s,f),e=!0},p(s,f){const t={};f&16&&(t.aggregation=s[4]),f&32&&(t.layout=s[5]),r.$set(t)},i(s){e||(S(r.$$.fragment,s),e=!0)},o(s){L(r.$$.fragment,s),e=!1},d(s){Q(r,s)}}}function me(a){let r,e,s;function f(n){a[16](n)}let t={id:"showAverageToggle",label:"show average mark line"};return a[6]!==void 0&&(t.checked=a[6]),r=new De({props:t}),we.push(()=>Oe(r,"checked",f)),{c(){ee(r.$$.fragment)},l(n){$(r.$$.fragment,n)},m(n,o){Z(r,n,o),s=!0},p(n,o){const h={};!e&&o&64&&(e=!0,h.checked=n[6],ke(()=>e=!1)),r.$set(h)},i(n){s||(S(r.$$.fragment,n),s=!0)},o(n){L(r.$$.fragment,n),s=!1},d(n){Q(r,n)}}}function pe(a){let r,e,s="Reference power amount",f,t,n;return t=new he({props:{name:"reference-power-toggle",selected:a[9],onchange:a[12],list:a[10]}}),{c(){r=D("div"),e=D("span"),e.textContent=s,f=z(),ee(t.$$.fragment),this.h()},l(o){r=P(o,"DIV",{class:!0});var h=Y(r);e=P(h,"SPAN",{"data-svelte-h":!0}),le(e)!=="svelte-ukeiym"&&(e.textContent=s),f=q(h),$(t.$$.fragment,h),h.forEach(M),this.h()},h(){H(r,"class","flex flex-col items-center gap-2 md:flex-row")},m(o,h){fe(o,r,h),T(r,e),T(r,f),Z(t,r,null),n=!0},p(o,h){const m={};h&512&&(m.selected=o[9]),h&1024&&(m.list=o[10]),t.$set(m)},i(o){n||(S(t.$$.fragment,o),n=!0)},o(o){L(t.$$.fragment,o),n=!1},d(o){o&&M(r),Q(t)}}}function Xe(a){let r,e,s,f,t="Consumption",n,o,h,m,O,w,d,c="Data started at:",k,b,y=ue(a[7])+"",A,V;o=new he({props:{name:"chart-type-toggle",selected:a[0],onchange:a[11],list:[{label:"Exceedance",value:C.EXCEEDANCE},{label:"Measured",value:C.PLAIN},{label:"Repartition",value:C.REPARTITION}]}});let u=a[0]===C.PLAIN&&me(a),g=a[0]===C.EXCEEDANCE&&pe(a);return{c(){r=D("div"),e=D("div"),s=D("div"),f=D("span"),f.textContent=t,n=z(),ee(o.$$.fragment),h=z(),u&&u.c(),m=z(),g&&g.c(),O=z(),w=D("div"),d=D("span"),d.textContent=c,k=z(),b=D("span"),A=Te(y),this.h()},l(l){r=P(l,"DIV",{class:!0});var I=Y(r);e=P(I,"DIV",{class:!0});var N=Y(e);s=P(N,"DIV",{class:!0});var R=Y(s);f=P(R,"SPAN",{"data-svelte-h":!0}),le(f)!=="svelte-1vrp2az"&&(f.textContent=t),n=q(R),$(o.$$.fragment,R),R.forEach(M),h=q(N),u&&u.l(N),m=q(N),g&&g.l(N),N.forEach(M),O=q(I),w=P(I,"DIV",{class:!0});var K=Y(w);d=P(K,"SPAN",{"data-svelte-h":!0}),le(d)!=="svelte-1cta1ja"&&(d.textContent=c),k=q(K),b=P(K,"SPAN",{class:!0});var te=Y(b);A=Ie(te,y),te.forEach(M),K.forEach(M),I.forEach(M),this.h()},h(){H(s,"class","flex flex-col items-center gap-2 md:flex-row"),H(e,"class","flex flex-col items-center gap-4 lg:flex-row"),H(b,"class","font-semibold"),H(w,"class","flex items-center gap-1 text-sm"),H(r,"class","flex flex-col-reverse items-center gap-4 py-4 lg:flex-row lg:justify-between lg:gap-0 lg:py-2")},m(l,I){fe(l,r,I),T(r,e),T(e,s),T(s,f),T(s,n),Z(o,s,null),T(e,h),u&&u.m(e,null),T(e,m),g&&g.m(e,null),T(r,O),T(r,w),T(w,d),T(w,k),T(w,b),T(b,A),V=!0},p(l,I){const N={};I&1&&(N.selected=l[0]),o.$set(N),l[0]===C.PLAIN?u?(u.p(l,I),I&1&&S(u,1)):(u=me(l),u.c(),S(u,1),u.m(e,m)):u&&(ce(),L(u,1,1,()=>{u=null}),ie()),l[0]===C.EXCEEDANCE?g?(g.p(l,I),I&1&&S(g,1)):(g=pe(l),g.c(),S(g,1),g.m(e,null)):g&&(ce(),L(g,1,1,()=>{g=null}),ie()),(!V||I&128)&&y!==(y=ue(l[7])+"")&&be(A,y)},i(l){V||(S(o.$$.fragment,l),S(u),S(g),V=!0)},o(l){L(o.$$.fragment,l),L(u),L(g),V=!1},d(l){l&&M(r),Q(o),u&&u.d(),g&&g.d()}}}function je(a){let r,e,s,f;return s=new Re({props:{type:a[0],color:a[1],labels:a[2],unit:a[3],aggregation:a[4],timeseries:a[8],showAverageMarkline:a[6],onclick:a[14],$$slots:{footer:[Xe],headerActions:[Be]},$$scope:{ctx:a}}}),{c(){r=D("div"),e=D("div"),ee(s.$$.fragment),this.h()},l(t){r=P(t,"DIV",{class:!0});var n=Y(r);e=P(n,"DIV",{class:!0});var o=Y(e);$(s.$$.fragment,o),o.forEach(M),n.forEach(M),this.h()},h(){H(e,"class","absolute top-0 right-0 bottom-0 left-0"),H(r,"class","relative grow")},m(t,n){fe(t,r,n),T(r,e),Z(s,e,null),f=!0},p(t,[n]){const o={};n&1&&(o.type=t[0]),n&2&&(o.color=t[1]),n&4&&(o.labels=t[2]),n&8&&(o.unit=t[3]),n&16&&(o.aggregation=t[4]),n&256&&(o.timeseries=t[8]),n&64&&(o.showAverageMarkline=t[6]),n&67110641&&(o.$$scope={dirty:n,ctx:t}),s.$set(o)},i(t){f||(S(s.$$.fragment,t),f=!0)},o(t){L(s.$$.fragment,t),f=!1},d(t){t&&M(r),Q(s)}}}function xe(a,r,e){x.extend(We);const s={[`${C.PLAIN}`]:["Consumption"],[`${C.EXCEEDANCE}`]:["Consumption","Exceedance"],[`${C.REPARTITION}`]:["Shared with me","Bought from market"]},f={[`${C.PLAIN}`]:[ae],[`${C.EXCEEDANCE}`]:[ae,ye],[`${C.REPARTITION}`]:[Me,ae]};let t=C.PLAIN,n=f[t],o=s[t],h=G.KWH,m=E.MONTH,O=W.YEAR,w=!1,d,c=[],k=[],b="0",y=[],{data:A}=r;const V=i=>{e(0,t=C.PLAIN),e(3,h=G.KWH),e(4,m=E.MONTH),e(5,O=W.YEAR),e(8,c=i.months.plain),e(7,d=c[0].startedAt),e(1,n=f[t]),e(2,o=s[t]),R(),console.log("ElectricityConsumption.onData",i)};let u=[];const g=i=>i.map(({startedAt:_,endedAt:p,value:B,anotherValue:X})=>({startedAt:_,endedAt:p,value:B,anotherValue:X})),l=i=>{const _=t===C.REPARTITION?"repartition":"plain",p=i[_];return t===C.EXCEEDANCE&&Array.isArray(p)&&p.length>0&&(u=g(p)),c},I=i=>{e(0,t=i),e(3,h=G.KWH),e(6,w=!1),e(4,m=E.MONTH),e(5,O=W.YEAR),e(8,c=l(A.months)),e(7,d=c[0].startedAt),e(1,n=f[t]),e(2,o=s[t]),R()},N=i=>{if(e(9,b=i),console.log("ElectricityConsumption.onReferencePowerAmountChange ",b),b==="0"){k=[],e(8,c=g(u));return}K()},R=()=>{if(t!==C.EXCEEDANCE){e(9,b="0"),k=[],e(10,y=[]);return}const i=c.length;let _=3;i<=6?_=1:i<=12&&(_=2),e(10,y=[{label:"None",value:"0"}]);for(let p=1;p<=_;p++)y.push({value:String(p)});Number(b)>_&&e(9,b=String(_)),K()},K=()=>{const i=Number(b);if(e(8,c=g(u)),i<1)return;k=Le(c,i).map(({startedAt:v,value:re},oe)=>{const F=10*oe;return{startedAt:v,value:Ye(re,He(50-F,80-F))}}),ve()&&(k[0].startedAt=void 0);let B=0,X=0,U=k[X],j=k[X+1];e(8,c=c.map(v=>{const{startedAt:re,value:oe}=v;U&&(!U.startedAt||x(re).isSameOrAfter(U.startedAt))&&(B=U?.value??0),j&&j.startedAt&&x(re).isSameOrAfter(j.startedAt)&&(X++,U=j,j=k[X+1],B=U?.value??0);let F=oe??0;const ne=F-B;return B<=0||ne<=0?(v.anotherValue=0,v):(v.value=F-ne,v.anotherValue=ne,v)})),U=void 0,j=void 0},te=(i,_)=>{if(e(3,h=G.KWH),_===W.YEAR){switch(i){case E.MONTH:e(8,c=l(A.months));break;case E.WEEK:e(8,c=l(A.weeks));break}e(7,d=c[0].startedAt),e(4,m=i),e(5,O=_),R();return}let p=J(x(d).startOf("month"));switch(i){case E.WEEK:e(8,c=l(A.weeksMap[p]));break;case E.DAY:e(8,c=l(A.daysMap[p]));break;case E.HOUR:p=J(d),e(8,c=l(A.hoursMap[p]));break}e(7,d=c[0].startedAt),e(4,m=i),e(5,O=_),R()},Ee=i=>{const{startedAt:_}=i;let p=J(_);if(console.log("ElectricityConsumption.onChartClick timeserie",i),O===W.YEAR){switch(m){case E.MONTH:e(4,m=E.WEEK),e(8,c=l(A.weeksMap[p]));break;case E.WEEK:p=J(x(_).startOf("month")),e(4,m=E.DAY),e(8,c=l(A.daysMap[p]));break}e(7,d=c[0].startedAt),e(5,O=W.MONTH),R();return}switch(m){case E.WEEK:p=J(x(_).startOf("month")),e(4,m=E.DAY),e(8,c=l(A.daysMap[p]));break;case E.DAY:e(4,m=E.HOUR),e(8,c=l(A.hoursMap[p]));break;case E.HOUR:e(4,m=E.MINUTES),e(8,c=l(A.minutesMap[p])),e(3,h=G.KW);break}e(7,d=c[0].startedAt),[E.HOUR,E.MINUTES].includes(m)&&e(5,O=W.DAY),m!==E.MINUTES&&R()};function Ae(i){w=i,e(6,w)}return a.$$set=i=>{"data"in i&&e(15,A=i.data)},a.$$.update=()=>{a.$$.dirty&32768&&V(A)},[t,n,o,h,m,O,w,d,c,b,y,I,N,te,Ee,A,Ae]}class tt extends _e{constructor(r){super(),Ce(this,r,xe,je,de,{data:15})}}export{tt as default};
