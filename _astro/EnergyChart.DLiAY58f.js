import{B as tt,f as N,t as T,S as Ae,i as ve,s as we,E as at,a as nt,b as Ne,c as Ce,e as le,g as Le,m as ie,p as ce,u as fe,v as st,z as Te,d as C,w as ke,U as Se,h as J,j as L,k as Y,l as R,n as B,x as ye,o as oe,q as U,y as De,r as re,I as ze,F as de,G as _e,K as Ze,L as Je,M as Qe,V as ot,T as z}from"./ECharts.C5Iir41h.js";import{g as rt,d as lt}from"./dayjs.min.2rai63wT.js";import{o as it,C as se,c as ct,g as Z,p as Ee,L as pe,q as Me,d as Oe,T as Fe,r as Re,s as $e,t as ft,u as ut,v as Be,w as mt,x as ht,f as dt,i as ne,y as Ue}from"./ChartLoadingSpinner.CnPI2XLW.js";import"./index.BAn-HqPX.js";function Pe(n){return n?.length!==void 0?n:Array.from(n)}function Ht(n,e){n.d(1),e.delete(n.key)}function _t(n,e){T(n,1,1,()=>{e.delete(n.key)})}function gt(n,e,a,t,s,r,i,l,o,u,f,h){let d=n.length,v=r.length,b=d;const p={};for(;b--;)p[n[b].key]=b;const w=[],S=new Map,g=new Map,m=[];for(b=v;b--;){const E=h(s,r,b),A=a(E);let c=i.get(A);c?m.push(()=>c.p(E,e)):(c=u(A,E),c.c()),S.set(A,w[b]=c),A in p&&g.set(A,Math.abs(b-p[A]))}const k=new Set,_=new Set;function y(E){N(E,1),E.m(l,f),i.set(E.key,E),f=E.first,v--}for(;d&&v;){const E=w[v-1],A=n[d-1],c=E.key,I=A.key;E===A?(f=E.first,d--,v--):S.has(I)?!i.has(c)||k.has(c)?y(E):_.has(I)?d--:g.get(c)>g.get(I)?(_.add(c),y(E)):(k.add(I),d--):(o(A,i),d--)}for(;d--;){const E=n[d];S.has(E.key)||o(E,i)}for(;v;)y(w[v-1]);return tt(m),w}var he={exports:{}},Et=he.exports,Ve;function bt(){return Ve||(Ve=1,function(n,e){(function(a,t){n.exports=t()})(Et,function(){return function(a,t){t.prototype.isSameOrBefore=function(s,r){return this.isSame(s,r)||this.isBefore(s,r)}}})}(he)),he.exports}var kt=bt();const yt=rt(kt);lt.extend(yt);const me={KW:"kW",KWH:"kWh",M3:"mÂ³",UNDEFINED:""},W={MONTH:"month",WEEK:"week",DAY:"day",HOUR:"hour",MINUTES:"15_minutes",UNDEFINED:""},Kt={GAS:"GAS",ELECTRICITY:"ELECTRICITY"},Dt=300,pt=(n,e=Dt)=>{let a;const t=()=>{clearTimeout(a)},s=function(...r){t(),a=setTimeout(()=>n.apply(this,r),e)};return s.cleanup=t,s};function At(n){let e,a;return e=new ct({props:{color:n[3]}}),{c(){fe(e.$$.fragment)},l(t){ce(e.$$.fragment,t)},m(t,s){ie(e,t,s),a=!0},p(t,s){const r={};s&8&&(r.color=t[3]),e.$set(r)},i(t){a||(N(e.$$.fragment,t),a=!0)},o(t){T(e.$$.fragment,t),a=!1},d(t){le(e,t)}}}function vt(n){let e,a,t,s;function r(o){n[7](o)}function i(o){n[8](o)}let l={init:nt,options:n[2],notMerge:!0,$$slots:{default:[At]},$$scope:{ctx:n}};return n[1]!==void 0&&(l.chart=n[1]),n[0]!==void 0&&(l.chartContainerDOMRect=n[0]),e=new at({props:l}),Ne.push(()=>Ce(e,"chart",r)),Ne.push(()=>Ce(e,"chartContainerDOMRect",i)),{c(){fe(e.$$.fragment)},l(o){ce(e.$$.fragment,o)},m(o,u){ie(e,o,u),s=!0},p(o,[u]){const f={};u&4&&(f.options=o[2]),u&32776&&(f.$$scope={dirty:u,ctx:o}),!a&&u&2&&(a=!0,f.chart=o[1],Le(()=>a=!1)),!t&&u&1&&(t=!0,f.chartContainerDOMRect=o[0],Le(()=>t=!1)),e.$set(f)},i(o){s||(N(e.$$.fragment,o),s=!0)},o(o){T(e.$$.fragment,o),s=!1},d(o){le(e,o)}}}const wt=n=>{const e={};for(let a=0;a<n[0].data.length;++a)for(let t=0;t<n.length;++t){const s=n[t],r=s.stack;if(!r)continue;e[r]||(e[r]={stackStart:[],stackEnd:[]});const i=e[r],l=s.data[a];(()=>{const u=l&&l.value?l.value:l;if(!u||u===null)return!1;switch(typeof u){case"number":return!isNaN(u);case"string":return u!=="-"}})()&&(i.stackStart[a]==null&&(i.stackStart[a]=t),i.stackEnd[a]=t)}return e},It=n=>{const e=wt(n);for(let a=0;a<n.length;++a){const t=n[a];if(!t.stack){t.itemStyle=Me(Oe);continue}const s=t.data,r=s.length,i=e[t.stack];for(let l=0;l<r;++l){const o=i.stackEnd[l]===a,u=s[l]&&s[l].value||s[l],f=Me(o?Oe:0);s[l]={value:u,itemStyle:f}}}return n},We="click",be="mousemove";function Nt(n,e,a){let t,{isTinyScreen:s=!1}=e,{chartOptions:r}=e,{onclick:i=it}=e,l,o={},u,f="",h="";const d=(g,m)=>{const{color:k,categories:_,series:y,xAxisLabelFormatter:E,yAxisLabelFormatter:A=H=>Z(H),tooltipFormatter:c,dataZoomLabelFormatter:I}=g;f="",h="",a(4,s=(()=>{if(!m)return!1;const{width:H,height:X}=m;switch(screen.orientation.angle){case 0:return H<=Re&&X<=Fe;case 90:return H<=Fe&&X<=Re}return!1})());const V={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:"rgba(150,150,150,0.1)"}},formatter:c},q={containLabel:!0,left:0,right:0,top:0,bottom:0},M=_.length,Q={type:"category",data:_,axisLabel:{color:pe,formatter:E,hideOverlap:!0,showMinLabel:!(s&&M>10||M>12)},axisTick:{show:!1,alignWithLabel:!0},axisLine:{lineStyle:Ee},splitLine:{show:!0,lineStyle:Ee,showMinLine:!1,showMaxLine:!1,interval:M>50?10:2}};a(2,o={color:k,tooltip:V,grid:q,xAxis:Q,yAxis:{type:"value",position:"right",axisLabel:{verticalAlign:"bottom",padding:[0,-10,2,0],color:pe,showMinLabel:!1,showMaxLabel:!1,formatter:A},splitLine:{lineStyle:Ee,showMaxLine:!1}},series:It(y)});const G=12;if(s&&M>G){q.bottom=55;const H=M,x=G/2*100/H,ee=M-1,te=_[ee-G],K=100;a(2,o.dataZoom=[{type:"inside",startValue:te,end:K,minSpan:x},{show:!0,type:"slider",startValue:te,end:K,minSpan:x,labelFormatter:I}],o)}},b=pt(g=>{!s||g.event?.type!==be||(h=g.name)},500),p=g=>{if(!s){i(g);return}b.cleanup();const m=g.name;if(f&&m===f||h&&m===h){f="",h="",i(g);return}f=m,h=""};st(()=>(l.on(We,"series",p),l.on(be,"series",b),console.log("BaseColumnsChart - mounted",{chart:l}),()=>{l.off(We,p),l.off(be,b),console.log("BaseColumnsChart - destroyed",{chart:l})}));function w(g){l=g,a(1,l)}function S(g){u=g,a(0,u)}return n.$$set=g=>{"isTinyScreen"in g&&a(4,s=g.isTinyScreen),"chartOptions"in g&&a(5,r=g.chartOptions),"onclick"in g&&a(6,i=g.onclick)},n.$$.update=()=>{n.$$.dirty&32&&a(3,t=r.color[1]??r.color[0]??se),n.$$.dirty&33&&d(r,u)},[u,l,o,t,s,r,i,w,S]}class Ct extends Ae{constructor(e){super(),ve(this,e,Nt,vt,we,{isTinyScreen:4,chartOptions:5,onclick:6})}}function He(n){let e,a;return{c(){e=U("span"),a=De(n[3])},l(t){e=R(t,"SPAN",{});var s=B(e);a=ye(s,n[3]),s.forEach(C)},m(t,s){J(t,e,s),L(e,a)},p(t,s){s&8&&ke(a,t[3])},d(t){t&&C(e)}}}function Lt(n){let e,a,t,s,r,i,l=Z(n[1],n[4])+"",o,u,f=n[3]&&He(n);return{c(){e=U("div"),a=U("span"),t=De(n[0]),s=re(),r=U("div"),i=U("span"),o=De(l),u=re(),f&&f.c(),this.h()},l(h){e=R(h,"DIV",{class:!0});var d=B(e);a=R(d,"SPAN",{});var v=B(a);t=ye(v,n[0]),v.forEach(C),s=oe(d),r=R(d,"DIV",{class:!0,style:!0});var b=B(r);i=R(b,"SPAN",{class:!0});var p=B(i);o=ye(p,l),p.forEach(C),u=oe(b),f&&f.l(b),b.forEach(C),d.forEach(C),this.h()},h(){Y(i,"class","text-sm tabular-nums"),Y(r,"class","text-sm font-semibold"),Se(r,"color",n[2]),Y(e,"class","flex flex-col md:flex-row md:items-center md:gap-2")},m(h,d){J(h,e,d),L(e,a),L(a,t),L(e,s),L(e,r),L(r,i),L(i,o),L(r,u),f&&f.m(r,null)},p(h,[d]){d&1&&ke(t,h[0]),d&18&&l!==(l=Z(h[1],h[4])+"")&&ke(o,l),h[3]?f?f.p(h,d):(f=He(h),f.c(),f.m(r,null)):f&&(f.d(1),f=null),d&4&&Se(r,"color",h[2])},i:Te,o:Te,d(h){h&&C(e),f&&f.d()}}}function Tt(n,e,a){let{label:t}=e,{value:s}=e,{valueColor:r=pe}=e,{unit:i}=e,{maximumFractionDigits:l=$e}=e;return n.$$set=o=>{"label"in o&&a(0,t=o.label),"value"in o&&a(1,s=o.value),"valueColor"in o&&a(2,r=o.valueColor),"unit"in o&&a(3,i=o.unit),"maximumFractionDigits"in o&&a(4,l=o.maximumFractionDigits)},[t,s,r,i,l]}class et extends Ae{constructor(e){super(),ve(this,e,Tt,Lt,we,{label:0,value:1,valueColor:2,unit:3,maximumFractionDigits:4})}}const St=n=>({}),Ke=n=>({}),Mt=n=>({}),Ye=n=>({});function je(n,e,a){const t=n.slice();t[22]=e[a],t[25]=a;const s=t[3][t[25]];return t[23]=s,t}function Ot(n){let e,a;return e=new et({props:{label:n[5](0),value:n[3][0],valueColor:n[6](0),unit:n[0],maximumFractionDigits:n[1]}}),{c(){fe(e.$$.fragment)},l(t){ce(e.$$.fragment,t)},m(t,s){ie(e,t,s),a=!0},p(t,s){const r={};s&8&&(r.value=t[3][0]),s&1&&(r.unit=t[0]),s&2&&(r.maximumFractionDigits=t[1]),e.$set(r)},i(t){a||(N(e.$$.fragment,t),a=!0)},o(t){T(e.$$.fragment,t),a=!1},d(t){le(e,t)}}}function Ft(n){let e=[],a=new Map,t,s,r=Pe(n[2]);const i=l=>l[25];for(let l=0;l<r.length;l+=1){let o=je(n,r,l),u=i(o);a.set(u,e[l]=Ge(u,o))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=z()},l(l){for(let o=0;o<e.length;o+=1)e[o].l(l);t=z()},m(l,o){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(l,o);J(l,t,o),s=!0},p(l,o){o&79&&(r=Pe(l[2]),de(),e=gt(e,o,i,1,l,r,a,t.parentNode,_t,Ge,t,je),_e())},i(l){if(!s){for(let o=0;o<r.length;o+=1)N(e[o]);s=!0}},o(l){for(let o=0;o<e.length;o+=1)T(e[o]);s=!1},d(l){l&&C(t);for(let o=0;o<e.length;o+=1)e[o].d(l)}}}function qe(n){let e,a;return e=new et({props:{label:n[22],value:n[3][n[25]],valueColor:n[6](n[25]),unit:n[0],maximumFractionDigits:n[1]}}),{c(){fe(e.$$.fragment)},l(t){ce(e.$$.fragment,t)},m(t,s){ie(e,t,s),a=!0},p(t,s){const r={};s&4&&(r.label=t[22]),s&12&&(r.value=t[3][t[25]]),s&4&&(r.valueColor=t[6](t[25])),s&1&&(r.unit=t[0]),s&2&&(r.maximumFractionDigits=t[1]),e.$set(r)},i(t){a||(N(e.$$.fragment,t),a=!0)},o(t){T(e.$$.fragment,t),a=!1},d(t){le(e,t)}}}function Ge(n,e){let a,t=!isNaN(e[23]),s,r,i=t&&qe(e);return{key:n,first:null,c(){a=z(),i&&i.c(),s=z(),this.h()},l(l){a=z(),i&&i.l(l),s=z(),this.h()},h(){this.first=a},m(l,o){J(l,a,o),i&&i.m(l,o),J(l,s,o),r=!0},p(l,o){e=l,o&12&&(t=!isNaN(e[23])),t?i?(i.p(e,o),o&12&&N(i,1)):(i=qe(e),i.c(),N(i,1),i.m(s.parentNode,s)):i&&(de(),T(i,1,1,()=>{i=null}),_e())},i(l){r||(N(i),r=!0)},o(l){T(i),r=!1},d(l){l&&(C(a),C(s)),i&&i.d(l)}}}function Xe(n){let e;const a=n[18].footer,t=ze(a,n,n[17],Ke);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,r){t&&t.p&&(!e||r&131072)&&Ze(t,a,s,s[17],e?Qe(a,s[17],r,St):Je(s[17]),Ke)},i(s){e||(N(t,s),e=!0)},o(s){T(t,s),e=!1},d(s){t&&t.d(s)}}}function Rt(n){let e,a,t,s,r,i,l,o,u,f,h,d,v,b;const p=[Ft,Ot],w=[];function S(_,y){return y&4&&(s=null),s==null&&(s=!!Array.isArray(_[2])),s?0:1}r=S(n,-1),i=w[r]=p[r](n);const g=n[18].headerActions,m=ze(g,n,n[17],Ye);d=new Ct({props:{chartOptions:n[4],onclick:n[7]}});let k=n[8].footer&&Xe(n);return{c(){e=U("div"),a=U("div"),t=U("div"),i.c(),l=re(),o=U("div"),m&&m.c(),u=re(),f=U("div"),h=U("div"),fe(d.$$.fragment),v=re(),k&&k.c(),this.h()},l(_){e=R(_,"DIV",{class:!0});var y=B(e);a=R(y,"DIV",{class:!0});var E=B(a);t=R(E,"DIV",{class:!0});var A=B(t);i.l(A),A.forEach(C),l=oe(E),o=R(E,"DIV",{});var c=B(o);m&&m.l(c),c.forEach(C),E.forEach(C),u=oe(y),f=R(y,"DIV",{class:!0});var I=B(f);h=R(I,"DIV",{class:!0});var V=B(h);ce(d.$$.fragment,V),V.forEach(C),I.forEach(C),v=oe(y),k&&k.l(y),y.forEach(C),this.h()},h(){Y(t,"class","flex justify-center gap-4 md:items-center md:justify-start"),Y(a,"class","flex flex-col gap-4 sm:flex-row sm:flex-wrap sm:justify-between"),Y(h,"class","absolute top-0 right-0 bottom-0 left-0"),Y(f,"class","relative min-h-[200px] grow"),Y(e,"class","flex min-h-full grow flex-col gap-2")},m(_,y){J(_,e,y),L(e,a),L(a,t),w[r].m(t,null),L(a,l),L(a,o),m&&m.m(o,null),L(e,u),L(e,f),L(f,h),ie(d,h,null),L(e,v),k&&k.m(e,null),b=!0},p(_,[y]){let E=r;r=S(_,y),r===E?w[r].p(_,y):(de(),T(w[E],1,1,()=>{w[E]=null}),_e(),i=w[r],i?i.p(_,y):(i=w[r]=p[r](_),i.c()),N(i,1),i.m(t,null)),m&&m.p&&(!b||y&131072)&&Ze(m,g,_,_[17],b?Qe(g,_[17],y,Mt):Je(_[17]),Ye);const A={};y&16&&(A.chartOptions=_[4]),d.$set(A),_[8].footer?k?(k.p(_,y),y&256&&N(k,1)):(k=Xe(_),k.c(),N(k,1),k.m(e,null)):k&&(de(),T(k,1,1,()=>{k=null}),_e())},i(_){b||(N(i),N(m,_),N(d.$$.fragment,_),N(k),b=!0)},o(_){T(i),T(m,_),T(d.$$.fragment,_),T(k),b=!1},d(_){_&&C(e),w[r].d(),m&&m.d(_),le(d),k&&k.d()}}}const xe={PLAIN:"PLAIN",REPARTITION:"REPARTITION",EXCEEDANCE:"EXCEEDANCE"};function Bt(n,e,a){let{$$slots:t={},$$scope:s}=e;const r=ot(t);let{type:i=xe.PLAIN}=e,{showAverageMarkline:l=!1}=e,{unit:o=me.UNDEFINED}=e,{aggregation:u=W.UNDEFINED}=e,{maximumFractionDigits:f=$e}=e,{color:h=se}=e,{timeseries:d=[]}=e,{referencePower:v=void 0}=e,{referencePowerOptions:b=ft}=e,{labels:p=["Consumption","Exceedance"]}=e,{onclick:w=ut}=e,S=!1,g=[0,NaN],m={color:[],categories:[],series:[]};const k=(c,I,V,q,M,Q,$,G,H)=>{S=_(V,q);const X=!!G,x=c===xe.REPARTITION;let ee=0,te=0;const K=$.reduce((D,O)=>{const{startedAt:j,value:P=NaN,anotherValue:F=NaN}=O;return ee+=P??0,te+=F??0,D.startedAtData.push(j),x?(D.valueData.push(P),D.anotherValueData.push(F),D):(D.valueData.push(P),D)},{startedAtData:[],valueData:[],anotherValueData:[]});if(a(4,m.color=Array.isArray(Q)?Q:[Q],m),a(4,m.categories=K.startedAtData,m),x||X){a(3,g=[ee,te]);const D={type:"bar",stack:"energy",name:p[0],data:K.valueData},O={type:"bar",stack:"energy",name:p[1],data:K.anotherValueData};a(4,m.series=[D,O],m)}else{a(3,g=[ee,NaN]);const D={type:"bar",data:K.valueData};a(4,m.series=[D],m)}m.series.forEach(D=>{if(I){let O=D.markLine;const j={type:"average",label:{fontWeight:"bold",position:"insideEndTop",backgroundColor:"white",padding:2,borderRadius:5,textBorderColor:"white",textBorderWidth:3,formatter:P=>Z(P.value,M)}};if(O){const{symbol:P=Be,data:F=[]}=O;D.markLine={symbol:P,data:[...F,j]}}else D.markLine={symbol:Be,data:[j]}}D.cursor=S?"zoom-in":"default"}),console.log("EnergyChart.updateChartOptions",{type:c,showAverageMarkline:I,unit:V,aggregation:q,maximumFractionDigits:M,timeseries:$,isDrilldownEnabled:S,hasReferencePower:X,referencePower:G,referencePowerOptions:H,data:K});let ae=mt,ue=D=>ht(D.startedAt);switch(q){case W.MONTH:ae=Ue,ue=D=>Ue(D.startedAt);break;case W.WEEK:ae=ne,ue=D=>`${ne(D.startedAt)} - ${ne(D.endedAt)}`;break;case W.DAY:ae=ne,ue=D=>ne(D.startedAt);break}a(4,m.xAxisLabelFormatter=ae,m),a(4,m.tooltipFormatter=D=>{const O=D;let j=$[O[0].dataIndex],P=0,F="";return F+=`<div>${ue(j)}</div>`,O.reverse().forEach(ge=>{j=$[ge.dataIndex];const Ie=ge.value;P+=Ie,F+=dt({color:ge.color,value:`${Z(Ie,M)} ${V}`})}),x&&(F+='<div style="padding-top: 5px;"><hr>',F+=`<span style="float:right;margin-left:20px;font-weight:600">${Z(P,M)} ${V}</span>`,F+="</div>"),F},m),a(4,m.dataZoomLabelFormatter=(D,O)=>ae(O),m)},_=(c,I)=>{switch(c){case me.M3:return![W.HOUR,W.MINUTES,W.UNDEFINED].includes(I);case me.KW:case me.KWH:return![W.MINUTES,W.UNDEFINED].includes(I);default:return!1}},y=(c=0)=>Array.isArray(p)?p[c]??"":p,E=(c=0)=>{let I=se;return h&&(I=Array.isArray(h)?h[c]??se:c===0?h:se),I},A=c=>{c.data&&w(d[c.dataIndex])};return n.$$set=c=>{"type"in c&&a(9,i=c.type),"showAverageMarkline"in c&&a(10,l=c.showAverageMarkline),"unit"in c&&a(0,o=c.unit),"aggregation"in c&&a(11,u=c.aggregation),"maximumFractionDigits"in c&&a(1,f=c.maximumFractionDigits),"color"in c&&a(12,h=c.color),"timeseries"in c&&a(13,d=c.timeseries),"referencePower"in c&&a(14,v=c.referencePower),"referencePowerOptions"in c&&a(15,b=c.referencePowerOptions),"labels"in c&&a(2,p=c.labels),"onclick"in c&&a(16,w=c.onclick),"$$scope"in c&&a(17,s=c.$$scope)},n.$$.update=()=>{n.$$.dirty&65027&&k(i,l,o,u,f,h,d,v,b)},[o,f,p,g,m,y,E,A,r,i,l,u,h,d,v,b,w,s,t]}class Yt extends Ae{constructor(e){super(),ve(this,e,Bt,Rt,we,{type:9,showAverageMarkline:10,unit:0,aggregation:11,maximumFractionDigits:1,color:12,timeseries:13,referencePower:14,referencePowerOptions:15,labels:2,onclick:16})}}export{W as A,Yt as E,me as U,xe as a,Kt as b,Ht as d,Pe as e,_t as o,gt as u};
