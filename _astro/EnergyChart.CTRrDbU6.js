import{S as ge,i as Ee,s as De,E as ze,a as Qe,b as Ie,c as Ce,e as x,t as y,f as k,g as Ne,m as z,p as Q,u as J,v as Je,Q as ye,d as I,w as fe,R as Le,h as G,j as v,k as F,l as T,n as w,x as ue,o as W,q as p,y as me,r as H,A as Ke,M as he,N as de,C as je,D as Ye,F as qe,T as Ze,O as Te}from"./ECharts.D_PwvaFx.js";import{g as $e,d as et}from"./dayjs.min.2rai63wT.js";import{m as tt,C as q,c as at,g as X,n as le,L as _e,o as we,d as pe,T as Oe,p as Se,q as Ge,r as nt,s as rt,t as Me,u as ce,k as Y,v as st,w as ot,f as it}from"./ChartLoadingSpinner.8T2WVZcL.js";import"./index.t4S9YAZx.js";var te={exports:{}},lt=te.exports,Fe;function ct(){return Fe||(Fe=1,function(n,e){(function(a,t){n.exports=t()})(lt,function(){return function(a,t){t.prototype.isSameOrBefore=function(s,r){return this.isSame(s,r)||this.isBefore(s,r)}}})}(te)),te.exports}var ft=ct();const ut=$e(ft);et.extend(ut);const ee={KW:"kW",KWH:"kWh",M3:"mÂ³",UNDEFINED:""},S={MONTH:"month",WEEK:"week",DAY:"day",HOUR:"hour",MINUTES:"15_minutes",UNDEFINED:""},Tt={GAS:"GAS"};function mt(n){let e,a;return e=new at({props:{color:n[3]}}),{c(){J(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,s){z(e,t,s),a=!0},p(t,s){const r={};s&8&&(r.color=t[3]),e.$set(r)},i(t){a||(k(e.$$.fragment,t),a=!0)},o(t){y(e.$$.fragment,t),a=!1},d(t){x(e,t)}}}function ht(n){let e,a,t,s;function r(o){n[7](o)}function i(o){n[8](o)}let l={init:Qe,options:n[2],notMerge:!0,$$slots:{default:[mt]},$$scope:{ctx:n}};return n[1]!==void 0&&(l.chart=n[1]),n[0]!==void 0&&(l.chartContainerDOMRect=n[0]),e=new ze({props:l}),Ie.push(()=>Ce(e,"chart",r)),Ie.push(()=>Ce(e,"chartContainerDOMRect",i)),{c(){J(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,_){z(e,o,_),s=!0},p(o,[_]){const u={};_&4&&(u.options=o[2]),_&1032&&(u.$$scope={dirty:_,ctx:o}),!a&&_&2&&(a=!0,u.chart=o[1],Ne(()=>a=!1)),!t&&_&1&&(t=!0,u.chartContainerDOMRect=o[0],Ne(()=>t=!1)),e.$set(u)},i(o){s||(k(e.$$.fragment,o),s=!0)},o(o){y(e.$$.fragment,o),s=!1},d(o){x(e,o)}}}const dt=n=>{const e={};for(let a=0;a<n[0].data.length;++a)for(let t=0;t<n.length;++t){const s=n[t],r=s.stack;if(!r)continue;e[r]||(e[r]={stackStart:[],stackEnd:[]});const i=e[r],l=s.data[a];l&&!isNaN(l)&&(i.stackStart[a]==null&&(i.stackStart[a]=t),i.stackEnd[a]=t)}return e},_t=n=>{const e=dt(n);for(let a=0;a<n.length;++a){const t=n[a];if(!t.stack){t.itemStyle=we(pe);continue}const s=t.data,r=s.length,i=e[t.stack];for(let l=0;l<r;++l){const o=i.stackEnd[l]===a;s[l]={value:s[l],itemStyle:we(o?pe:0)}}}return n};function gt(n,e,a){let t,{isTinyScreen:s=!1}=e,{chartOptions:r}=e,{onclick:i=tt}=e,l,o={},_;const u=(D,E)=>{const{color:h,categories:m,series:b,xAxisLabelFormatter:C,yAxisLabelFormatter:A=N=>X(N),tooltipFormatter:B}=D;a(4,s=(()=>{if(!E)return!1;const{width:N,height:V}=E;switch(screen.orientation.angle){case 0:return N<=Se&&V<=Oe;case 90:return N<=Oe&&V<=Se}return!1})()),console.log({isTinyScreen:s,chartOptions:D});const U={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:"rgba(150,150,150,0.1)"}},formatter:B},P={containLabel:!0,left:0,right:0,top:0,bottom:0},ae=m.length,ne={type:"category",data:m,axisLabel:{color:_e,formatter:C,hideOverlap:!0,showMinLabel:!(s&&m.length>10)},axisTick:{show:!1,alignWithLabel:!0},axisLine:{lineStyle:le},splitLine:{show:!0,lineStyle:le,showMinLine:!1,showMaxLine:!1,interval:ae>50?10:2}};a(2,o={color:h,tooltip:U,grid:P,xAxis:ne,yAxis:{type:"value",position:"right",axisLabel:{verticalAlign:"bottom",padding:[0,-10,2,0],color:_e,showMinLabel:!1,showMaxLabel:!1,formatter:A},splitLine:{lineStyle:le,showMaxLine:!1}},series:_t(b)})};Je(()=>(l.on("click",i),console.log("BaseColumnsChart - mounted",{chart:l}),()=>{l.off("click",i),console.log("BaseColumnsChart - destroyed",{chart:l})}));function d(D){l=D,a(1,l)}function c(D){_=D,a(0,_)}return n.$$set=D=>{"isTinyScreen"in D&&a(4,s=D.isTinyScreen),"chartOptions"in D&&a(5,r=D.chartOptions),"onclick"in D&&a(6,i=D.onclick)},n.$$.update=()=>{n.$$.dirty&32&&a(3,t=r.color[0]??q),n.$$.dirty&33&&u(r,_)},[_,l,o,t,s,r,i,d,c]}class Et extends ge{constructor(e){super(),Ee(this,e,gt,ht,De,{isTinyScreen:4,chartOptions:5,onclick:6})}}function Re(n){let e,a;return{c(){e=p("span"),a=me(n[3])},l(t){e=T(t,"SPAN",{});var s=w(e);a=ue(s,n[3]),s.forEach(I)},m(t,s){G(t,e,s),v(e,a)},p(t,s){s&8&&fe(a,t[3])},d(t){t&&I(e)}}}function Dt(n){let e,a,t,s,r,i,l=X(n[1],n[4])+"",o,_,u=n[3]&&Re(n);return{c(){e=p("div"),a=p("span"),t=me(n[0]),s=H(),r=p("div"),i=p("span"),o=me(l),_=H(),u&&u.c(),this.h()},l(d){e=T(d,"DIV",{class:!0});var c=w(e);a=T(c,"SPAN",{});var D=w(a);t=ue(D,n[0]),D.forEach(I),s=W(c),r=T(c,"DIV",{class:!0,style:!0});var E=w(r);i=T(E,"SPAN",{class:!0});var h=w(i);o=ue(h,l),h.forEach(I),_=W(E),u&&u.l(E),E.forEach(I),c.forEach(I),this.h()},h(){F(i,"class","text-sm tabular-nums"),F(r,"class","text-sm font-semibold"),Le(r,"color",n[2]),F(e,"class","flex items-center gap-2")},m(d,c){G(d,e,c),v(e,a),v(a,t),v(e,s),v(e,r),v(r,i),v(i,o),v(r,_),u&&u.m(r,null)},p(d,[c]){c&1&&fe(t,d[0]),c&18&&l!==(l=X(d[1],d[4])+"")&&fe(o,l),d[3]?u?u.p(d,c):(u=Re(d),u.c(),u.m(r,null)):u&&(u.d(1),u=null),c&4&&Le(r,"color",d[2])},i:ye,o:ye,d(d){d&&I(e),u&&u.d()}}}function bt(n,e,a){let{label:t}=e,{value:s}=e,{valueColor:r=_e}=e,{unit:i}=e,{maximumFractionDigits:l=Ge}=e;return n.$$set=o=>{"label"in o&&a(0,t=o.label),"value"in o&&a(1,s=o.value),"valueColor"in o&&a(2,r=o.valueColor),"unit"in o&&a(3,i=o.unit),"maximumFractionDigits"in o&&a(4,l=o.maximumFractionDigits)},[t,s,r,i,l]}class Xe extends ge{constructor(e){super(),Ee(this,e,bt,Dt,De,{label:0,value:1,valueColor:2,unit:3,maximumFractionDigits:4})}}const At=n=>({}),Be=n=>({}),kt=n=>({}),Ue=n=>({});function Pe(n){let e,a,t,s;e=new Xe({props:{label:n[5](0),value:n[3][0],valueColor:n[6](0),unit:n[0],maximumFractionDigits:n[1]}});let r=n[3][1]&&Ve(n);return{c(){J(e.$$.fragment),a=H(),r&&r.c(),t=Te()},l(i){Q(e.$$.fragment,i),a=W(i),r&&r.l(i),t=Te()},m(i,l){z(e,i,l),G(i,a,l),r&&r.m(i,l),G(i,t,l),s=!0},p(i,l){const o={};l&8&&(o.value=i[3][0]),l&1&&(o.unit=i[0]),l&2&&(o.maximumFractionDigits=i[1]),e.$set(o),i[3][1]?r?(r.p(i,l),l&8&&k(r,1)):(r=Ve(i),r.c(),k(r,1),r.m(t.parentNode,t)):r&&(he(),y(r,1,1,()=>{r=null}),de())},i(i){s||(k(e.$$.fragment,i),k(r),s=!0)},o(i){y(e.$$.fragment,i),y(r),s=!1},d(i){i&&(I(a),I(t)),x(e,i),r&&r.d(i)}}}function Ve(n){let e,a;return e=new Xe({props:{label:n[5](1),value:n[3][1],valueColor:n[6](1),unit:n[0],maximumFractionDigits:n[1]}}),{c(){J(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,s){z(e,t,s),a=!0},p(t,s){const r={};s&8&&(r.value=t[3][1]),s&1&&(r.unit=t[0]),s&2&&(r.maximumFractionDigits=t[1]),e.$set(r)},i(t){a||(k(e.$$.fragment,t),a=!0)},o(t){y(e.$$.fragment,t),a=!1},d(t){x(e,t)}}}function We(n){let e;const a=n[18].footer,t=Ke(a,n,n[17],Be);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,r){t&&t.p&&(!e||r&131072)&&je(t,a,s,s[17],e?qe(a,s[17],r,At):Ye(s[17]),Be)},i(s){e||(k(t,s),e=!0)},o(s){y(t,s),e=!1},d(s){t&&t.d(s)}}}function vt(n){let e,a,t,s,r,i,l,o,_,u,d,c=n[2].length>0&&Pe(n);const D=n[18].headerActions,E=Ke(D,n,n[17],Ue);_=new Et({props:{chartOptions:n[4],onclick:n[7]}});let h=n[8].footer&&We(n);return{c(){e=p("div"),a=p("div"),t=p("div"),c&&c.c(),s=H(),r=p("div"),E&&E.c(),i=H(),l=p("div"),o=p("div"),J(_.$$.fragment),u=H(),h&&h.c(),this.h()},l(m){e=T(m,"DIV",{class:!0});var b=w(e);a=T(b,"DIV",{class:!0});var C=w(a);t=T(C,"DIV",{class:!0});var A=w(t);c&&c.l(A),A.forEach(I),s=W(C),r=T(C,"DIV",{});var B=w(r);E&&E.l(B),B.forEach(I),C.forEach(I),i=W(b),l=T(b,"DIV",{class:!0});var U=w(l);o=T(U,"DIV",{class:!0});var P=w(o);Q(_.$$.fragment,P),P.forEach(I),U.forEach(I),u=W(b),h&&h.l(b),b.forEach(I),this.h()},h(){F(t,"class","flex items-center gap-4"),F(a,"class","flex flex-col gap-4 md:flex-row md:items-center md:justify-between md:gap-0"),F(o,"class","absolute top-0 right-0 bottom-0 left-0"),F(l,"class","relative min-h-[300px] grow"),F(e,"class","flex min-h-full grow flex-col gap-2")},m(m,b){G(m,e,b),v(e,a),v(a,t),c&&c.m(t,null),v(a,s),v(a,r),E&&E.m(r,null),v(e,i),v(e,l),v(l,o),z(_,o,null),v(e,u),h&&h.m(e,null),d=!0},p(m,[b]){m[2].length>0?c?(c.p(m,b),b&4&&k(c,1)):(c=Pe(m),c.c(),k(c,1),c.m(t,null)):c&&(he(),y(c,1,1,()=>{c=null}),de()),E&&E.p&&(!d||b&131072)&&je(E,D,m,m[17],d?qe(D,m[17],b,kt):Ye(m[17]),Ue);const C={};b&16&&(C.chartOptions=m[4]),_.$set(C),m[8].footer?h?(h.p(m,b),b&256&&k(h,1)):(h=We(m),h.c(),k(h,1),h.m(e,null)):h&&(he(),y(h,1,1,()=>{h=null}),de())},i(m){d||(k(c),k(E,m),k(_.$$.fragment,m),k(h),d=!0)},o(m){y(c),y(E,m),y(_.$$.fragment,m),y(h),d=!1},d(m){m&&I(e),c&&c.d(),E&&E.d(m),x(_),h&&h.d()}}}const He={PLAIN:"PLAIN",REPARTITION:"REPARTITION"};function It(n,e,a){let{$$slots:t={},$$scope:s}=e;const r=Ze(t);let{type:i=He.PLAIN}=e,{showAverageMarkline:l=!1}=e,{unit:o=ee.UNDEFINED}=e,{aggregation:_=S.UNDEFINED}=e,{maximumFractionDigits:u=Ge}=e,{color:d=q}=e,{timeseries:c=[]}=e,{referencePower:D=void 0}=e,{referencePowerOptions:E=nt}=e,{labels:h=["Consumption","Exceedance"]}=e,{onclick:m=rt}=e,b=!1,C=[0,NaN],A={color:[],categories:[],series:[]};const B=(f,N,V,re,se,oe,K,be,xe)=>{b=U(V,re);const Ae=!!be,ke=f===He.REPARTITION;let ie=0,ve=0;const j=K.reduce((g,O)=>{const{startedAt:R,value:L=NaN,anotherValue:M=NaN}=O;return ie+=L??0,ve+=M??0,g.startedAtData.push(R),ke?(g.valueData.push(L),g.anotherValueData.push(M),g):(g.valueData.push(L),g)},{startedAtData:[],valueData:[],anotherValueData:[]});if(a(4,A.color=Array.isArray(oe)?oe:[oe],A),a(4,A.categories=j.startedAtData,A),ke||Ae){a(3,C=[ie,ve]);const g={type:"bar",stack:"energy",data:j.valueData},O={type:"bar",stack:"energy",data:j.anotherValueData};a(4,A.series=[g,O],A)}else{a(3,C=[ie,NaN]);const g={type:"bar",data:j.valueData};a(4,A.series=[g],A)}A.series.forEach(g=>{if(N){let O=g.markLine;const R={type:"average",label:{fontWeight:"bold",position:"insideEndTop",backgroundColor:"white",padding:2,borderRadius:5,textBorderColor:"white",textBorderWidth:3,formatter:L=>X(L.value,se)}};if(O){const{symbol:L=Me,data:M=[]}=O;g.markLine={symbol:L,data:[...M,R]}}else g.markLine={symbol:Me,data:[R]}}g.cursor=b?"zoom-in":"default"}),console.log("EnergyChart.updateChartOptions",{type:f,showAverageMarkline:N,unit:V,aggregation:re,maximumFractionDigits:se,timeseries:K,isDrilldownEnabled:b,hasReferencePower:Ae,referencePower:be,referencePowerOptions:xe,data:j});let Z=st,$=g=>ot(g.startedAt);switch(re){case S.MONTH:Z=ce,$=g=>ce(g.startedAt);break;case S.WEEK:Z=K.length>6?ce:Y,$=g=>`${Y(g.startedAt)} - ${Y(g.endedAt)}`;break;case S.DAY:Z=Y,$=g=>Y(g.startedAt);break}a(4,A.xAxisLabelFormatter=Z,A),a(4,A.tooltipFormatter=g=>{const O=g;let R=K[O[0].dataIndex],L="";return L+=`<div>${$(R)}</div>`,O.forEach(M=>{R=K[M.dataIndex],L+=it({color:M.color,value:`${X(M.value,se)} ${V}`})}),L},A)},U=(f,N)=>{switch(f){case ee.M3:return![S.HOUR,S.MINUTES,S.UNDEFINED].includes(N);case ee.KW:case ee.KWH:return![S.MINUTES,S.UNDEFINED].includes(N);default:return!1}},P=(f=0)=>Array.isArray(h)?h[f]??"":h,ae=(f=0)=>{let N=q;return d&&(N=Array.isArray(d)?d[f]??q:f===0?d:q),N},ne=f=>{console.log("EnergyChart.onChartClick",{isDrilldownEnabled:b,event:f}),f.data&&m(c[f.dataIndex])};return n.$$set=f=>{"type"in f&&a(9,i=f.type),"showAverageMarkline"in f&&a(10,l=f.showAverageMarkline),"unit"in f&&a(0,o=f.unit),"aggregation"in f&&a(11,_=f.aggregation),"maximumFractionDigits"in f&&a(1,u=f.maximumFractionDigits),"color"in f&&a(12,d=f.color),"timeseries"in f&&a(2,c=f.timeseries),"referencePower"in f&&a(13,D=f.referencePower),"referencePowerOptions"in f&&a(14,E=f.referencePowerOptions),"labels"in f&&a(15,h=f.labels),"onclick"in f&&a(16,m=f.onclick),"$$scope"in f&&a(17,s=f.$$scope)},n.$$.update=()=>{n.$$.dirty&32263&&B(i,l,o,_,u,d,c,D,E)},[o,u,c,C,A,P,ae,ne,r,i,l,_,d,D,E,h,m,s,t]}class wt extends ge{constructor(e){super(),Ee(this,e,It,vt,De,{type:9,showAverageMarkline:10,unit:0,aggregation:11,maximumFractionDigits:1,color:12,timeseries:2,referencePower:13,referencePowerOptions:14,labels:15,onclick:16})}}export{S as A,wt as E,ee as U,Tt as a};
