import{S as le,i as ce,s as fe,d as D,e as q,t as y,f as R,h as $,j as k,m as z,k as S,l as O,n as H,p as F,q as P,u as G,z as te,w as ge,A as x,o as v,x as ue,r as V,y as ie,b as me,c as pe,g as he,B as se}from"./ECharts.CpYfIO0D.js";import{d as Q}from"./dayjs.min.2rai63wT.js";import{E as Ee,a as A,U as X,A as f,b as K,c as _e,d as Ae}from"./AggregationLevelSelection.Dy3oRmDF.js";import{T as Ce}from"./Toggle.DSrT7CON.js";import{B as ae}from"./ButtonsToggle.DzOjSIbH.js";import{i as be,h as Z,j as ke,k as re,l as j}from"./ChartLoadingSpinner.BbKX_Jhn.js";import{g as de,a as we}from"./random.CeNFGipF.js";import"./index.DACIwEDX.js";function Ie(a){let t,e;return t=new _e({props:{aggregation:a[4],energyType:Ae.ELECTRICITY,layout:a[5],onclick:a[14]}}),{c(){G(t.$$.fragment)},l(o){F(t.$$.fragment,o)},m(o,c){z(t,o,c),e=!0},p(o,c){const s={};c&16&&(s.aggregation=o[4]),c&32&&(s.layout=o[5]),t.$set(s)},i(o){e||(R(t.$$.fragment,o),e=!0)},o(o){y(t.$$.fragment,o),e=!1},d(o){q(t,o)}}}function oe(a){let t,e,o;function c(n){a[17](n)}let s={id:"showAverageToggle",label:"show average mark line"};return a[6]!==void 0&&(s.checked=a[6]),t=new Ce({props:s}),me.push(()=>pe(t,"checked",c)),{c(){G(t.$$.fragment)},l(n){F(t.$$.fragment,n)},m(n,r){z(t,n,r),o=!0},p(n,r){const m={};!e&&r&64&&(e=!0,m.checked=n[6],he(()=>e=!1)),t.$set(m)},i(n){o||(R(t.$$.fragment,n),o=!0)},o(n){y(t.$$.fragment,n),o=!1},d(n){q(t,n)}}}function ne(a){let t,e,o="Reference power amount",c,s,n;return s=new ae({props:{name:"reference-power-toggle",selected:a[10],onchange:a[13],list:a[11]}}),{c(){t=P("div"),e=P("span"),e.textContent=o,c=V(),G(s.$$.fragment),this.h()},l(r){t=O(r,"DIV",{class:!0});var m=H(t);e=O(m,"SPAN",{"data-svelte-h":!0}),x(e)!=="svelte-ukeiym"&&(e.textContent=o),c=v(m),F(s.$$.fragment,m),m.forEach(D),this.h()},h(){S(t,"class","flex flex-col items-center gap-2 md:flex-row")},m(r,m){$(r,t,m),k(t,e),k(t,c),z(s,t,null),n=!0},p(r,m){const g={};m&1024&&(g.selected=r[10]),m&2048&&(g.list=r[11]),s.$set(g)},i(r){n||(R(s.$$.fragment,r),n=!0)},o(r){y(s.$$.fragment,r),n=!1},d(r){r&&D(t),q(s)}}}function Te(a){let t,e,o,c,s="Consumption",n,r,m,g,I,d,C,i="Data started at:",L,w,M=re(a[7])+"",_,Y;r=new ae({props:{name:"chart-type-toggle",selected:a[0],onchange:a[12],list:[{label:"Exceedance",value:A.EXCEEDANCE},{label:"Measured",value:A.PLAIN},{label:"Repartition",value:A.REPARTITION}]}});let l=a[0]===A.PLAIN&&oe(a),p=a[0]===A.EXCEEDANCE&&ne(a);return{c(){t=P("div"),e=P("div"),o=P("div"),c=P("span"),c.textContent=s,n=V(),G(r.$$.fragment),m=V(),l&&l.c(),g=V(),p&&p.c(),I=V(),d=P("div"),C=P("span"),C.textContent=i,L=V(),w=P("span"),_=ie(M),this.h()},l(h){t=O(h,"DIV",{class:!0});var E=H(t);e=O(E,"DIV",{class:!0});var T=H(e);o=O(T,"DIV",{class:!0});var U=H(o);c=O(U,"SPAN",{"data-svelte-h":!0}),x(c)!=="svelte-1vrp2az"&&(c.textContent=s),n=v(U),F(r.$$.fragment,U),U.forEach(D),m=v(T),l&&l.l(T),g=v(T),p&&p.l(T),T.forEach(D),I=v(E),d=O(E,"DIV",{class:!0});var W=H(d);C=O(W,"SPAN",{"data-svelte-h":!0}),x(C)!=="svelte-1cta1ja"&&(C.textContent=i),L=v(W),w=O(W,"SPAN",{class:!0});var J=H(w);_=ue(J,M),J.forEach(D),W.forEach(D),E.forEach(D),this.h()},h(){S(o,"class","flex flex-col items-center gap-2 md:flex-row"),S(e,"class","flex flex-col items-center gap-4 lg:flex-row"),S(w,"class","font-semibold"),S(d,"class","flex items-center gap-1 text-sm"),S(t,"class","flex flex-col-reverse items-center gap-4 py-4 lg:flex-row lg:justify-between lg:gap-0 lg:py-2")},m(h,E){$(h,t,E),k(t,e),k(e,o),k(o,c),k(o,n),z(r,o,null),k(e,m),l&&l.m(e,null),k(e,g),p&&p.m(e,null),k(t,I),k(t,d),k(d,C),k(d,L),k(d,w),k(w,_),Y=!0},p(h,E){const T={};E&1&&(T.selected=h[0]),r.$set(T),h[0]===A.PLAIN?l?(l.p(h,E),E&1&&R(l,1)):(l=oe(h),l.c(),R(l,1),l.m(e,g)):l&&(se(),y(l,1,1,()=>{l=null}),te()),h[0]===A.EXCEEDANCE?p?(p.p(h,E),E&1&&R(p,1)):(p=ne(h),p.c(),R(p,1),p.m(e,null)):p&&(se(),y(p,1,1,()=>{p=null}),te()),(!Y||E&128)&&M!==(M=re(h[7])+"")&&ge(_,M)},i(h){Y||(R(r.$$.fragment,h),R(l),R(p),Y=!0)},o(h){y(r.$$.fragment,h),y(l),y(p),Y=!1},d(h){h&&D(t),q(r),l&&l.d(),p&&p.d()}}}function Ne(a){let t,e,o,c;return o=new Ee({props:{type:a[0],color:a[1],labels:a[2],unit:a[3],aggregation:a[4],timeseries:a[8],referencePower:a[9],showAverageMarkline:a[6],onclick:a[15],$$slots:{footer:[Te],headerActions:[Ie]},$$scope:{ctx:a}}}),{c(){t=P("div"),e=P("div"),G(o.$$.fragment),this.h()},l(s){t=O(s,"DIV",{class:!0});var n=H(t);e=O(n,"DIV",{class:!0});var r=H(e);F(o.$$.fragment,r),r.forEach(D),n.forEach(D),this.h()},h(){S(e,"class","absolute top-0 right-0 bottom-0 left-0"),S(t,"class","relative grow")},m(s,n){$(s,t,n),k(t,e),z(o,e,null),c=!0},p(s,[n]){const r={};n&1&&(r.type=s[0]),n&2&&(r.color=s[1]),n&4&&(r.labels=s[2]),n&8&&(r.unit=s[3]),n&16&&(r.aggregation=s[4]),n&256&&(r.timeseries=s[8]),n&512&&(r.referencePower=s[9]),n&64&&(r.showAverageMarkline=s[6]),n&16780529&&(r.$$scope={dirty:n,ctx:s}),o.$set(r)},i(s){c||(R(o.$$.fragment,s),c=!0)},o(s){y(o.$$.fragment,s),c=!1},d(s){s&&D(t),q(o)}}}function Re(a,t,e){const o={[`${A.PLAIN}`]:["Consumption"],[`${A.EXCEEDANCE}`]:["Consumption","Exceedance"],[`${A.REPARTITION}`]:["Shared with me","Bought from market"]},c={[`${A.PLAIN}`]:[Z],[`${A.EXCEEDANCE}`]:[Z,ke],[`${A.REPARTITION}`]:[be,Z]};let s=A.PLAIN,n=c[s],r=o[s],m=X.KWH,g=f.MONTH,I=K.YEAR,d=!1,C,i=[],L=[],w="0",M=[],{data:_}=t;const Y=u=>{e(0,s=A.PLAIN),e(3,m=X.KWH),e(4,g=f.MONTH),e(5,I=K.YEAR),e(8,i=u.months.plain),e(7,C=i[0].startedAt),e(1,n=c[s]),e(2,r=o[s]),E(),console.log("ElectricityConsumption.onData",u)},l=u=>{const N=s===A.REPARTITION?"repartition":"plain";return u[N]},p=u=>{e(0,s=u),e(3,m=X.KWH),e(6,d=!1),e(4,g=f.MONTH),e(5,I=K.YEAR),e(8,i=l(_.months)),e(7,C=i[0].startedAt),e(1,n=c[s]),e(2,r=o[s]),E()},h=u=>{if(e(10,w=u),console.log("ElectricityConsumption.onReferencePowerAmountChange ",w),w==="0"){e(9,L=[]);return}T()},E=()=>{if(s!==A.EXCEEDANCE){e(10,w="0"),e(9,L=[]),e(11,M=[]);return}e(11,M=[{label:"None",value:"0"},{value:"1"}]),T()},T=()=>{const u=Number(w),N=we();if(u>0){const b=de(i);let B=0;switch(g){case f.MONTH:B=1e3;break;case f.WEEK:B=100;break;case f.DAY:B=10;break;case f.HOUR:B=2;break}const ee={startedAt:N?void 0:b.startedAt,value:b.value-B};e(9,L=[ee]),console.log("ElectricityConsumption.defineReferencePower ",{amount:u,startAtBeginning:N,timeserie:b,referencePowerItem:ee})}},U=(u,N)=>{if(e(3,m=X.KWH),N===K.YEAR){switch(u){case f.MONTH:e(8,i=l(_.months));break;case f.WEEK:e(8,i=l(_.weeks));break}e(7,C=i[0].startedAt),e(4,g=u),e(5,I=N),E();return}let b=j(Q(C).startOf("month"));switch(u){case f.WEEK:e(8,i=l(_.weeksMap[b]));break;case f.DAY:e(8,i=l(_.daysMap[b]));break;case f.HOUR:b=j(C),e(8,i=l(_.hoursMap[b]));break}e(7,C=i[0].startedAt),e(4,g=u),e(5,I=N),E()},W=u=>{const{startedAt:N}=u;let b=j(N);if(console.log("ElectricityConsumption.onChartClick timeserie",u),I===K.YEAR){switch(g){case f.MONTH:e(4,g=f.WEEK),e(8,i=l(_.weeksMap[b]));break;case f.WEEK:b=j(Q(N).startOf("month")),e(4,g=f.DAY),e(8,i=l(_.daysMap[b]));break}e(7,C=i[0].startedAt),e(5,I=K.MONTH),E();return}switch(g){case f.WEEK:b=j(Q(N).startOf("month")),e(4,g=f.DAY),e(8,i=l(_.daysMap[b]));break;case f.DAY:e(4,g=f.HOUR),e(8,i=l(_.hoursMap[b]));break;case f.HOUR:e(4,g=f.MINUTES),e(8,i=l(_.minutesMap[b])),e(3,m=X.KW);break}e(7,C=i[0].startedAt),[f.HOUR,f.MINUTES].includes(g)&&e(5,I=K.DAY),g!==f.MINUTES&&E()};function J(u){d=u,e(6,d)}return a.$$set=u=>{"data"in u&&e(16,_=u.data)},a.$$.update=()=>{a.$$.dirty&65536&&Y(_)},[s,n,r,m,g,I,d,C,i,L,w,M,p,h,U,W,_,J]}class Ye extends le{constructor(t){super(),ce(this,t,Re,Ne,fe,{data:16})}}export{Ye as default};
