import{S as $,i as tt,s as et,F as At,G as yt,x as rt,y as at,d as _,a as w,t as S,b as T,z as ot,c as G,e as y,m as I,f as v,g as k,h as O,r as nt,j as R,k as x,v as st,l as F,H as kt,p as Ot,u as xt,w as Dt}from"./ECharts.aTH0d2T3.js";import{d as K}from"./dayjs.min.2rai63wT.js";import"./index.DKEAfG0C.js";import{h as q}from"./colors.DRy8vmPD.js";import{e as X,g as Et,h as Lt,D as wt,i as St,W as Tt,j as It,k as J,L as Rt,l as Q,m as Ft,n as Pt,o as Nt,a as Gt}from"./ChartLoadingSpinner.BJ802ZHd.js";import{T as Ut}from"./Toggle.DnFSIGz6.js";function Z(s){let t,e,r,n;return{c(){t=x("div"),e=x("span"),r=Dt(s[0]),this.h()},l(i){t=k(i,"DIV",{class:!0});var c=O(t);e=k(c,"SPAN",{class:!0,title:!0});var l=O(e);r=xt(l,s[0]),l.forEach(_),c.forEach(_),this.h()},h(){v(e,"class","text-[0.7rem]"),v(e,"title",n="Unit: "+s[0]),v(t,"class","absolute top-2 left-4 z-10")},m(i,c){G(i,t,c),y(t,e),y(e,r)},p(i,c){c&1&&Ot(r,i[0]),c&1&&n!==(n="Unit: "+i[0])&&v(e,"title",n)},d(i){i&&_(t)}}}function Wt(s){let t,e;return t=new It({props:{color:s[1]}}),{c(){F(t.$$.fragment)},l(r){R(t.$$.fragment,r)},m(r,n){I(t,r,n),e=!0},p(r,n){const i={};n&2&&(i.color=r[1]),t.$set(i)},i(r){e||(T(t.$$.fragment,r),e=!0)},o(r){S(t.$$.fragment,r),e=!1},d(r){w(t,r)}}}function Mt(s){let t,e,r,n,i,c,l=s[0]&&Z(s);function f(u){s[13](u)}let C={init:yt,options:s[3],notMerge:!0,$$slots:{default:[Wt]},$$scope:{ctx:s}};return s[2]!==void 0&&(C.chart=s[2]),n=new At({props:C}),rt.push(()=>at(n,"chart",f)),{c(){t=x("div"),l&&l.c(),e=st(),r=x("div"),F(n.$$.fragment),this.h()},l(u){t=k(u,"DIV",{class:!0});var o=O(t);l&&l.l(o),e=nt(o),r=k(o,"DIV",{class:!0});var d=O(r);R(n.$$.fragment,d),d.forEach(_),o.forEach(_),this.h()},h(){v(r,"class","absolute top-0 right-0 bottom-0 left-0 overflow-hidden rounded-lg border border-gray-100"),v(t,"class","relative grow")},m(u,o){G(u,t,o),l&&l.m(t,null),y(t,e),y(t,r),I(n,r,null),c=!0},p(u,[o]){u[0]?l?l.p(u,o):(l=Z(u),l.c(),l.m(t,e)):l&&(l.d(1),l=null);const d={};o&8&&(d.options=u[3]),o&131074&&(d.$$scope={dirty:o,ctx:u}),!i&&o&4&&(i=!0,d.chart=u[2],ot(()=>i=!1)),n.$set(d)},i(u){c||(T(n.$$.fragment,u),c=!0)},o(u){S(n.$$.fragment,u),c=!1},d(u){u&&_(t),l&&l.d(),w(n)}}}function Vt(s,t,e){let{unit:r=""}=t;const n=St,i=Tt;let{xAxisAttribute:c="startedAt"}=t,{yAxisAttribute:l="value"}=t,{currentColor:f=X}=t,{previousColor:C=X}=t,{colorOpacity:u=Et}=t,{backgroundColor:o=Lt}=t,{data:d={current:[],previous:[]}}=t,{onclick:p=wt}=t,h,U={};const it=(a,m,b,E,L,M,ut)=>{const dt=q(E,M),ft=q(L,M),ht=a.current.length>0;a=lt(a);const{current:V,previous:Y}=a,z=V.length-1,P=V.reduce((g,D,A)=>{const j=A===z?E:dt,H=A===z?L:ft;return g.xAxis.push(D[m]),g.current.push({value:D[b],date:D[m],itemStyle:{borderRadius:J,borderWidth:1,borderColor:j,color:j}}),g.previous.push({value:Y[A][b],date:Y[A][m],itemStyle:{borderRadius:J,borderWidth:1,borderColor:H,color:H}}),g},{xAxis:[],current:[],previous:[]}),N="2%",B=30,mt={top:B,bottom:B,left:"15%",right:N},gt={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:Ft}},formatter:g=>{let D="";return g.forEach(A=>{D+=Pt({color:A.color,label:Q({date:A.data.date,template:n}),value:Nt(A.value)})}),D}},_t={type:"category",data:P.xAxis,axisLabel:{formatter:g=>Q({date:g,template:i}),color:Rt},axisLine:{show:!1},axisTick:{show:!1}},pt={type:"value",show:!1},bt={type:"bar",data:P.previous},vt=ht?{symbol:["none","none"],data:[{type:"average",x:N,lineStyle:{color:E,width:2,type:"solid"},emphasis:{disabled:!0},label:{show:!0,position:"insideStartTop",fontWeight:"bold",fontSize:12,formatter:g=>Number(g.value).toFixed(3)}},{type:"average",name:"Average",x:N,lineStyle:{color:"transparent"},label:{show:!0,position:"insideStartBottom",fontSize:12,formatter:"{b}",opacity:.8}}]}:void 0,Ct={type:"bar",data:P.current,barCategoryGap:25,markLine:vt};e(3,U={backgroundColor:ut,grid:mt,tooltip:gt,xAxis:_t,yAxis:pt,series:[bt,Ct]})},lt=a=>{if(a.current.length>0)return a;for(let m=6;m>=0;m--){let b=(m>0?K().subtract(m,"day"):K()).startOf("day");const E={startedAt:b.format(),endedAt:b.endOf("day").format(),value:0};b=b.subtract(1,"week").startOf("day");const L={startedAt:b.format(),endedAt:b.endOf("day").format(),value:0};a.current.push(E),a.previous.push(L)}return a},W=a=>{if(console.log("onChartClick",a),!a.data)return;const m=a.dataIndex;p({current:d.current[m],previous:d.previous[m]})};kt(()=>(h.on("click",W),console.log("EnergyOverviewChart - mounted",{chart:h}),()=>{h.off("click",W),console.log("EnergyOverviewChart - destroyed",{chart:h})}));function ct(a){h=a,e(2,h)}return s.$$set=a=>{"unit"in a&&e(0,r=a.unit),"xAxisAttribute"in a&&e(6,c=a.xAxisAttribute),"yAxisAttribute"in a&&e(7,l=a.yAxisAttribute),"currentColor"in a&&e(1,f=a.currentColor),"previousColor"in a&&e(8,C=a.previousColor),"colorOpacity"in a&&e(9,u=a.colorOpacity),"backgroundColor"in a&&e(10,o=a.backgroundColor),"data"in a&&e(11,d=a.data),"onclick"in a&&e(12,p=a.onclick)},s.$$.update=()=>{s.$$.dirty&4034&&it(d,c,l,f,C,u,o)},[r,f,h,U,n,i,c,l,C,u,o,d,p,ct]}class Yt extends ${constructor(t){super(),tt(this,t,Vt,Mt,et,{unit:0,tooltipDatetimeFormat:4,xAxisDatetimeFormat:5,xAxisAttribute:6,yAxisAttribute:7,currentColor:1,previousColor:8,colorOpacity:9,backgroundColor:10,data:11,onclick:12})}get tooltipDatetimeFormat(){return this.$$.ctx[4]}get xAxisDatetimeFormat(){return this.$$.ctx[5]}}function zt(s){let t,e,r,n,i,c,l,f;r=new Yt({props:{data:s[1],unit:"kWh",currentColor:Gt,onclick:s[2]}});function C(o){s[4](o)}let u={label:"show data"};return s[0]!==void 0&&(u.checked=s[0]),c=new Ut({props:u}),rt.push(()=>at(c,"checked",C)),{c(){t=x("div"),e=x("div"),F(r.$$.fragment),n=st(),i=x("div"),F(c.$$.fragment),this.h()},l(o){t=k(o,"DIV",{class:!0});var d=O(t);e=k(d,"DIV",{class:!0});var p=O(e);R(r.$$.fragment,p),p.forEach(_),n=nt(d),i=k(d,"DIV",{class:!0});var h=O(i);R(c.$$.fragment,h),h.forEach(_),d.forEach(_),this.h()},h(){v(e,"class","flex h-[250px] w-full sm:h-[300px] sm:w-[500px] lg:w-[600px]"),v(i,"class","flex"),v(t,"class","flex flex-col gap-2")},m(o,d){G(o,t,d),y(t,e),I(r,e,null),y(t,n),y(t,i),I(c,i,null),f=!0},p(o,[d]){const p={};d&2&&(p.data=o[1]),r.$set(p);const h={};!l&&d&1&&(l=!0,h.checked=o[0],ot(()=>l=!1)),c.$set(h)},i(o){f||(T(r.$$.fragment,o),T(c.$$.fragment,o),f=!0)},o(o){S(r.$$.fragment,o),S(c.$$.fragment,o),f=!1},d(o){o&&_(t),w(r),w(c)}}}function Bt(s,t,e){let r,n=!0,{data:i}=t;const c=f=>{console.log("DailyElectricityUsage.onChartClick dayUsage:",f)};function l(f){n=f,e(0,n)}return s.$$set=f=>{"data"in f&&e(3,i=f.data)},s.$$.update=()=>{s.$$.dirty&9&&e(1,r=n?i:{current:[],previous:[]})},[n,r,c,i,l]}class Zt extends ${constructor(t){super(),tt(this,t,Bt,zt,et,{data:3})}}export{Zt as default};
