import{S as $,i as tt,s as et,E as At,A as yt,b as rt,a as ot,d as _,c as w,t as S,e as T,f as at,g as U,h as y,m as I,j as v,k,l as O,o as nt,n as R,p as x,r as st,q as F,B as kt,v as Ot,x as xt,y as Et}from"./ECharts.6qOP-yiC.js";import{d as H}from"./dayjs.min.2rai63wT.js";import"./index.Bn5gjWO9.js";import{h as K}from"./colors.DRy8vmPD.js";import{e as X,g as Dt,h as Lt,D as wt,i as St,W as Tt,j as It,k as J,L as Rt,l as Q,m as Ft,n as Pt,o as Nt,C as Ut}from"./ChartLoadingSpinner.DDnJmpK1.js";import{T as Wt}from"./Toggle.C1ZBg3Cm.js";function Z(s){let t,e,r,n;return{c(){t=x("div"),e=x("span"),r=Et(s[0]),this.h()},l(i){t=k(i,"DIV",{class:!0});var c=O(t);e=k(c,"SPAN",{class:!0,title:!0});var l=O(e);r=xt(l,s[0]),l.forEach(_),c.forEach(_),this.h()},h(){v(e,"class","text-[0.7rem]"),v(e,"title",n="Unit: "+s[0]),v(t,"class","absolute top-2 left-4 z-10")},m(i,c){U(i,t,c),y(t,e),y(e,r)},p(i,c){c&1&&Ot(r,i[0]),c&1&&n!==(n="Unit: "+i[0])&&v(e,"title",n)},d(i){i&&_(t)}}}function Bt(s){let t,e;return t=new It({props:{color:s[1]}}),{c(){F(t.$$.fragment)},l(r){R(t.$$.fragment,r)},m(r,n){I(t,r,n),e=!0},p(r,n){const i={};n&2&&(i.color=r[1]),t.$set(i)},i(r){e||(T(t.$$.fragment,r),e=!0)},o(r){S(t.$$.fragment,r),e=!1},d(r){w(t,r)}}}function Gt(s){let t,e,r,n,i,c,l=s[0]&&Z(s);function f(u){s[13](u)}let C={init:yt,options:s[3],notMerge:!0,$$slots:{default:[Bt]},$$scope:{ctx:s}};return s[2]!==void 0&&(C.chart=s[2]),n=new At({props:C}),rt.push(()=>ot(n,"chart",f)),{c(){t=x("div"),l&&l.c(),e=st(),r=x("div"),F(n.$$.fragment),this.h()},l(u){t=k(u,"DIV",{class:!0});var a=O(t);l&&l.l(a),e=nt(a),r=k(a,"DIV",{class:!0});var d=O(r);R(n.$$.fragment,d),d.forEach(_),a.forEach(_),this.h()},h(){v(r,"class","absolute top-0 right-0 bottom-0 left-0 overflow-hidden rounded-lg border border-gray-100"),v(t,"class","relative grow")},m(u,a){U(u,t,a),l&&l.m(t,null),y(t,e),y(t,r),I(n,r,null),c=!0},p(u,[a]){u[0]?l?l.p(u,a):(l=Z(u),l.c(),l.m(t,e)):l&&(l.d(1),l=null);const d={};a&8&&(d.options=u[3]),a&131074&&(d.$$scope={dirty:a,ctx:u}),!i&&a&4&&(i=!0,d.chart=u[2],at(()=>i=!1)),n.$set(d)},i(u){c||(T(n.$$.fragment,u),c=!0)},o(u){S(n.$$.fragment,u),c=!1},d(u){u&&_(t),l&&l.d(),w(n)}}}function Mt(s,t,e){let{unit:r=""}=t;const n=St,i=Tt;let{xAxisAttribute:c="startedAt"}=t,{yAxisAttribute:l="value"}=t,{currentColor:f=X}=t,{previousColor:C=X}=t,{colorOpacity:u=Dt}=t,{backgroundColor:a=Lt}=t,{data:d={current:[],previous:[]}}=t,{onclick:p=wt}=t,h,W={};const it=(o,m,b,D,L,G,ut)=>{const dt=K(D,G),ft=K(L,G),ht=o.current.length>0;o=lt(o);const{current:M,previous:V}=o,Y=M.length-1,P=M.reduce((g,E,A)=>{const z=A===Y?D:dt,q=A===Y?L:ft;return g.xAxis.push(E[m]),g.current.push({value:E[b],date:E[m],itemStyle:{borderRadius:J,borderWidth:1,borderColor:z,color:z}}),g.previous.push({value:V[A][b],date:V[A][m],itemStyle:{borderRadius:J,borderWidth:1,borderColor:q,color:q}}),g},{xAxis:[],current:[],previous:[]}),N="2%",j=30,mt={top:j,bottom:j,left:"15%",right:N},gt={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:Ft}},formatter:g=>{let E="";return g.forEach(A=>{E+=Pt({color:A.color,label:Q({date:A.data.date,template:n}),value:Nt(A.value)})}),E}},_t={type:"category",data:P.xAxis,axisLabel:{formatter:g=>Q({date:g,template:i}),color:Rt},axisLine:{show:!1},axisTick:{show:!1}},pt={type:"value",show:!1},bt={type:"bar",data:P.previous},vt=ht?{symbol:["none","none"],data:[{type:"average",x:N,lineStyle:{color:D,width:2,type:"solid"},emphasis:{disabled:!0},label:{show:!0,position:"insideStartTop",fontWeight:"bold",fontSize:12,formatter:g=>Number(g.value).toFixed(3)}},{type:"average",name:"Average",x:N,lineStyle:{color:"transparent"},label:{show:!0,position:"insideStartBottom",fontSize:12,formatter:"{b}",opacity:.8}}]}:void 0,Ct={type:"bar",data:P.current,barCategoryGap:25,markLine:vt};e(3,W={backgroundColor:ut,grid:mt,tooltip:gt,xAxis:_t,yAxis:pt,series:[bt,Ct]})},lt=o=>{if(o.current.length>0)return o;for(let m=6;m>=0;m--){let b=(m>0?H().subtract(m,"day"):H()).startOf("day");const D={startedAt:b.format(),endedAt:b.endOf("day").format(),value:0};b=b.subtract(1,"week").startOf("day");const L={startedAt:b.format(),endedAt:b.endOf("day").format(),value:0};o.current.push(D),o.previous.push(L)}return o},B=o=>{if(console.log("onChartClick",o),!o.data)return;const m=o.dataIndex;p({current:d.current[m],previous:d.previous[m]})};kt(()=>(h.on("click",B),console.log("EnergyOverviewChart - mounted",{chart:h}),()=>{h.off("click",B),console.log("EnergyOverviewChart - destroyed",{chart:h})}));function ct(o){h=o,e(2,h)}return s.$$set=o=>{"unit"in o&&e(0,r=o.unit),"xAxisAttribute"in o&&e(6,c=o.xAxisAttribute),"yAxisAttribute"in o&&e(7,l=o.yAxisAttribute),"currentColor"in o&&e(1,f=o.currentColor),"previousColor"in o&&e(8,C=o.previousColor),"colorOpacity"in o&&e(9,u=o.colorOpacity),"backgroundColor"in o&&e(10,a=o.backgroundColor),"data"in o&&e(11,d=o.data),"onclick"in o&&e(12,p=o.onclick)},s.$$.update=()=>{s.$$.dirty&4034&&it(d,c,l,f,C,u,a)},[r,f,h,W,n,i,c,l,C,u,a,d,p,ct]}class Vt extends ${constructor(t){super(),tt(this,t,Mt,Gt,et,{unit:0,tooltipDatetimeFormat:4,xAxisDatetimeFormat:5,xAxisAttribute:6,yAxisAttribute:7,currentColor:1,previousColor:8,colorOpacity:9,backgroundColor:10,data:11,onclick:12})}get tooltipDatetimeFormat(){return this.$$.ctx[4]}get xAxisDatetimeFormat(){return this.$$.ctx[5]}}function Yt(s){let t,e,r,n,i,c,l,f;r=new Vt({props:{data:s[1],unit:"kWh",currentColor:Ut,onclick:s[2]}});function C(a){s[4](a)}let u={label:"show data"};return s[0]!==void 0&&(u.checked=s[0]),c=new Wt({props:u}),rt.push(()=>ot(c,"checked",C)),{c(){t=x("div"),e=x("div"),F(r.$$.fragment),n=st(),i=x("div"),F(c.$$.fragment),this.h()},l(a){t=k(a,"DIV",{class:!0});var d=O(t);e=k(d,"DIV",{class:!0});var p=O(e);R(r.$$.fragment,p),p.forEach(_),n=nt(d),i=k(d,"DIV",{class:!0});var h=O(i);R(c.$$.fragment,h),h.forEach(_),d.forEach(_),this.h()},h(){v(e,"class","flex h-[250px] w-full sm:h-[300px] sm:w-[500px] lg:w-[600px]"),v(i,"class","flex"),v(t,"class","flex flex-col gap-2")},m(a,d){U(a,t,d),y(t,e),I(r,e,null),y(t,n),y(t,i),I(c,i,null),f=!0},p(a,[d]){const p={};d&2&&(p.data=a[1]),r.$set(p);const h={};!l&&d&1&&(l=!0,h.checked=a[0],at(()=>l=!1)),c.$set(h)},i(a){f||(T(r.$$.fragment,a),T(c.$$.fragment,a),f=!0)},o(a){S(r.$$.fragment,a),S(c.$$.fragment,a),f=!1},d(a){a&&_(t),w(r),w(c)}}}function jt(s,t,e){let r,n=!0,{data:i}=t;const c=f=>{console.log("DailyElectricityUsage.onChartClick dayUsage:",f)};function l(f){n=f,e(0,n)}return s.$$set=f=>{"data"in f&&e(3,i=f.data)},s.$$.update=()=>{s.$$.dirty&9&&e(1,r=n?i:{current:[],previous:[]})},[n,r,c,i,l]}class Zt extends ${constructor(t){super(),tt(this,t,jt,Yt,et,{data:3})}}export{Zt as default};
