import{P as tt,f as I,t as L,S as De,i as Ae,s as ve,E as at,a as nt,b as Ne,c as Ie,e as ee,g as Ce,m as te,p as ae,u as ne,v as st,Q as Te,d as C,w as ge,R as Le,h as G,j as T,k as H,l as S,n as F,x as Ee,o as Z,q as R,y as be,r as $,A as Xe,M as ce,N as fe,C as ze,D as Qe,F as Je,T as rt,O as Y}from"./ECharts.BA_zIMAu.js";import{g as ot,d as lt}from"./dayjs.min.2rai63wT.js";import{o as it,C as J,c as ct,g as q,p as _e,L as ke,q as Oe,d as Me,T as Se,r as Fe,s as Ze,t as ft,u as ut,v as Re,w as ht,x as mt,f as _t,j as Q,y as Be}from"./ChartLoadingSpinner.DTggnxbL.js";import"./index.hEkYiYuq.js";function Ue(n){return n?.length!==void 0?n:Array.from(n)}function dt(n,e){L(n,1,1,()=>{e.delete(n.key)})}function gt(n,e,a,t,s,l,i,o,r,f,u,d){let h=n.length,p=l.length,b=h;const v={};for(;b--;)v[n[b].key]=b;const w=[],O=new Map,g=new Map,m=[];for(b=p;b--;){const E=d(s,l,b),y=a(E);let c=i.get(y);c?m.push(()=>c.p(E,e)):(c=f(y,E),c.c()),O.set(y,w[b]=c),y in v&&g.set(y,Math.abs(b-v[y]))}const k=new Set,_=new Set;function D(E){I(E,1),E.m(o,u),i.set(E.key,E),u=E.first,p--}for(;h&&p;){const E=w[p-1],y=n[h-1],c=E.key,N=y.key;E===y?(u=E.first,h--,p--):O.has(N)?!i.has(c)||k.has(c)?D(E):_.has(N)?h--:g.get(c)>g.get(N)?(_.add(c),D(E)):(k.add(N),h--):(r(y,i),h--)}for(;h--;){const E=n[h];O.has(E.key)||r(E,i)}for(;p;)D(w[p-1]);return tt(m),w}var ie={exports:{}},Et=ie.exports,Pe;function bt(){return Pe||(Pe=1,function(n,e){(function(a,t){n.exports=t()})(Et,function(){return function(a,t){t.prototype.isSameOrBefore=function(s,l){return this.isSame(s,l)||this.isBefore(s,l)}}})}(ie)),ie.exports}var kt=bt();const Dt=ot(kt);lt.extend(Dt);const le={KW:"kW",KWH:"kWh",M3:"mÂ³",UNDEFINED:""},W={MONTH:"month",WEEK:"week",DAY:"day",HOUR:"hour",MINUTES:"15_minutes",UNDEFINED:""},Ht={GAS:"GAS"},At=300,vt=(n,e=At)=>{let a;return function(...t){clearTimeout(a),a=setTimeout(()=>n.apply(this,t),e)}};function yt(n){let e,a;return e=new ct({props:{color:n[3]}}),{c(){ne(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,s){te(e,t,s),a=!0},p(t,s){const l={};s&8&&(l.color=t[3]),e.$set(l)},i(t){a||(I(e.$$.fragment,t),a=!0)},o(t){L(e.$$.fragment,t),a=!1},d(t){ee(e,t)}}}function pt(n){let e,a,t,s;function l(r){n[7](r)}function i(r){n[8](r)}let o={init:nt,options:n[2],notMerge:!0,$$slots:{default:[yt]},$$scope:{ctx:n}};return n[1]!==void 0&&(o.chart=n[1]),n[0]!==void 0&&(o.chartContainerDOMRect=n[0]),e=new at({props:o}),Ne.push(()=>Ie(e,"chart",l)),Ne.push(()=>Ie(e,"chartContainerDOMRect",i)),{c(){ne(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,f){te(e,r,f),s=!0},p(r,[f]){const u={};f&4&&(u.options=r[2]),f&32776&&(u.$$scope={dirty:f,ctx:r}),!a&&f&2&&(a=!0,u.chart=r[1],Ce(()=>a=!1)),!t&&f&1&&(t=!0,u.chartContainerDOMRect=r[0],Ce(()=>t=!1)),e.$set(u)},i(r){s||(I(e.$$.fragment,r),s=!0)},o(r){L(e.$$.fragment,r),s=!1},d(r){ee(e,r)}}}const wt=n=>{const e={};for(let a=0;a<n[0].data.length;++a)for(let t=0;t<n.length;++t){const s=n[t],l=s.stack;if(!l)continue;e[l]||(e[l]={stackStart:[],stackEnd:[]});const i=e[l],o=s.data[a];(()=>{const f=o&&o.value?o.value:o;if(!f||f===null)return!1;switch(typeof f){case"number":return!isNaN(f);case"string":return f!=="-"}})()&&(i.stackStart[a]==null&&(i.stackStart[a]=t),i.stackEnd[a]=t)}return e},Nt=n=>{const e=wt(n);for(let a=0;a<n.length;++a){const t=n[a];if(!t.stack){t.itemStyle=Oe(Me);continue}const s=t.data,l=s.length,i=e[t.stack];for(let o=0;o<l;++o){const r=i.stackEnd[o]===a,f=s[o]&&s[o].value||s[o],u=Oe(r?Me:0);s[o]={value:f,itemStyle:u}}}return n},Ve="click",de="mousemove";function It(n,e,a){let t,{isTinyScreen:s=!1}=e,{chartOptions:l}=e,{onclick:i=it}=e,o,r={},f;const u=(g,m)=>{const{color:k,categories:_,series:D,xAxisLabelFormatter:E,yAxisLabelFormatter:y=P=>q(P),tooltipFormatter:c}=g;a(4,s=(()=>{if(!m)return!1;const{width:P,height:X}=m;switch(screen.orientation.angle){case 0:return P<=Fe&&X<=Se;case 90:return P<=Se&&X<=Fe}return!1})());const N={trigger:"axis",axisPointer:{type:"shadow",z:0,shadowStyle:{color:"rgba(150,150,150,0.1)"}},formatter:c},U={containLabel:!0,left:0,right:0,top:0,bottom:0},x=_.length,j={type:"category",data:_,axisLabel:{color:ke,formatter:E,hideOverlap:!0,showMinLabel:!(s&&_.length>10||_.length>12)},axisTick:{show:!1,alignWithLabel:!0},axisLine:{lineStyle:_e},splitLine:{show:!0,lineStyle:_e,showMinLine:!1,showMaxLine:!1,interval:x>50?10:2}};a(2,r={color:k,tooltip:N,grid:U,xAxis:j,yAxis:{type:"value",position:"right",axisLabel:{verticalAlign:"bottom",padding:[0,-10,2,0],color:ke,showMinLabel:!1,showMaxLabel:!1,formatter:y},splitLine:{lineStyle:_e,showMaxLine:!1}},series:Nt(D)})};let d="",h="";const b=vt(g=>{!s||g.event?.type!==de||(h=g.name)}),v=g=>{if(!s){i(g);return}const m=g.name;if(d&&m===d||h&&m===h){i(g),d="",h="";return}d=m,h=""};st(()=>(o.on(Ve,"series",v),o.on(de,"series",b),console.log("BaseColumnsChart - mounted",{chart:o}),()=>{o.off(Ve,v),o.off(de,b),console.log("BaseColumnsChart - destroyed",{chart:o})}));function w(g){o=g,a(1,o)}function O(g){f=g,a(0,f)}return n.$$set=g=>{"isTinyScreen"in g&&a(4,s=g.isTinyScreen),"chartOptions"in g&&a(5,l=g.chartOptions),"onclick"in g&&a(6,i=g.onclick)},n.$$.update=()=>{n.$$.dirty&32&&a(3,t=l.color[1]??l.color[0]??J),n.$$.dirty&33&&u(l,f)},[f,o,r,t,s,l,i,w,O]}class Ct extends De{constructor(e){super(),Ae(this,e,It,pt,ve,{isTinyScreen:4,chartOptions:5,onclick:6})}}function We(n){let e,a;return{c(){e=R("span"),a=be(n[3])},l(t){e=S(t,"SPAN",{});var s=F(e);a=Ee(s,n[3]),s.forEach(C)},m(t,s){G(t,e,s),T(e,a)},p(t,s){s&8&&ge(a,t[3])},d(t){t&&C(e)}}}function Tt(n){let e,a,t,s,l,i,o=q(n[1],n[4])+"",r,f,u=n[3]&&We(n);return{c(){e=R("div"),a=R("span"),t=be(n[0]),s=$(),l=R("div"),i=R("span"),r=be(o),f=$(),u&&u.c(),this.h()},l(d){e=S(d,"DIV",{class:!0});var h=F(e);a=S(h,"SPAN",{});var p=F(a);t=Ee(p,n[0]),p.forEach(C),s=Z(h),l=S(h,"DIV",{class:!0,style:!0});var b=F(l);i=S(b,"SPAN",{class:!0});var v=F(i);r=Ee(v,o),v.forEach(C),f=Z(b),u&&u.l(b),b.forEach(C),h.forEach(C),this.h()},h(){H(i,"class","text-sm tabular-nums"),H(l,"class","text-sm font-semibold"),Le(l,"color",n[2]),H(e,"class","flex flex-col md:flex-row md:items-center md:gap-2")},m(d,h){G(d,e,h),T(e,a),T(a,t),T(e,s),T(e,l),T(l,i),T(i,r),T(l,f),u&&u.m(l,null)},p(d,[h]){h&1&&ge(t,d[0]),h&18&&o!==(o=q(d[1],d[4])+"")&&ge(r,o),d[3]?u?u.p(d,h):(u=We(d),u.c(),u.m(l,null)):u&&(u.d(1),u=null),h&4&&Le(l,"color",d[2])},i:Te,o:Te,d(d){d&&C(e),u&&u.d()}}}function Lt(n,e,a){let{label:t}=e,{value:s}=e,{valueColor:l=ke}=e,{unit:i}=e,{maximumFractionDigits:o=Ze}=e;return n.$$set=r=>{"label"in r&&a(0,t=r.label),"value"in r&&a(1,s=r.value),"valueColor"in r&&a(2,l=r.valueColor),"unit"in r&&a(3,i=r.unit),"maximumFractionDigits"in r&&a(4,o=r.maximumFractionDigits)},[t,s,l,i,o]}class $e extends De{constructor(e){super(),Ae(this,e,Lt,Tt,ve,{label:0,value:1,valueColor:2,unit:3,maximumFractionDigits:4})}}const Ot=n=>({}),He=n=>({}),Mt=n=>({}),Ke=n=>({});function je(n,e,a){const t=n.slice();t[22]=e[a],t[25]=a;const s=t[3][t[25]];return t[23]=s,t}function St(n){let e,a;return e=new $e({props:{label:n[5](0),value:n[3][0],valueColor:n[6](0),unit:n[0],maximumFractionDigits:n[1]}}),{c(){ne(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,s){te(e,t,s),a=!0},p(t,s){const l={};s&8&&(l.value=t[3][0]),s&1&&(l.unit=t[0]),s&2&&(l.maximumFractionDigits=t[1]),e.$set(l)},i(t){a||(I(e.$$.fragment,t),a=!0)},o(t){L(e.$$.fragment,t),a=!1},d(t){ee(e,t)}}}function Ft(n){let e=[],a=new Map,t,s,l=Ue(n[2]);const i=o=>o[25];for(let o=0;o<l.length;o+=1){let r=je(n,l,o),f=i(r);a.set(f,e[o]=qe(f,r))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();t=Y()},l(o){for(let r=0;r<e.length;r+=1)e[r].l(o);t=Y()},m(o,r){for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(o,r);G(o,t,r),s=!0},p(o,r){r&79&&(l=Ue(o[2]),ce(),e=gt(e,r,i,1,o,l,a,t.parentNode,dt,qe,t,je),fe())},i(o){if(!s){for(let r=0;r<l.length;r+=1)I(e[r]);s=!0}},o(o){for(let r=0;r<e.length;r+=1)L(e[r]);s=!1},d(o){o&&C(t);for(let r=0;r<e.length;r+=1)e[r].d(o)}}}function Ye(n){let e,a;return e=new $e({props:{label:n[22],value:n[3][n[25]],valueColor:n[6](n[25]),unit:n[0],maximumFractionDigits:n[1]}}),{c(){ne(e.$$.fragment)},l(t){ae(e.$$.fragment,t)},m(t,s){te(e,t,s),a=!0},p(t,s){const l={};s&4&&(l.label=t[22]),s&12&&(l.value=t[3][t[25]]),s&4&&(l.valueColor=t[6](t[25])),s&1&&(l.unit=t[0]),s&2&&(l.maximumFractionDigits=t[1]),e.$set(l)},i(t){a||(I(e.$$.fragment,t),a=!0)},o(t){L(e.$$.fragment,t),a=!1},d(t){ee(e,t)}}}function qe(n,e){let a,t=!isNaN(e[23]),s,l,i=t&&Ye(e);return{key:n,first:null,c(){a=Y(),i&&i.c(),s=Y(),this.h()},l(o){a=Y(),i&&i.l(o),s=Y(),this.h()},h(){this.first=a},m(o,r){G(o,a,r),i&&i.m(o,r),G(o,s,r),l=!0},p(o,r){e=o,r&12&&(t=!isNaN(e[23])),t?i?(i.p(e,r),r&12&&I(i,1)):(i=Ye(e),i.c(),I(i,1),i.m(s.parentNode,s)):i&&(ce(),L(i,1,1,()=>{i=null}),fe())},i(o){l||(I(i),l=!0)},o(o){L(i),l=!1},d(o){o&&(C(a),C(s)),i&&i.d(o)}}}function Ge(n){let e;const a=n[18].footer,t=Xe(a,n,n[17],He);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,l){t&&t.m(s,l),e=!0},p(s,l){t&&t.p&&(!e||l&131072)&&ze(t,a,s,s[17],e?Je(a,s[17],l,Ot):Qe(s[17]),He)},i(s){e||(I(t,s),e=!0)},o(s){L(t,s),e=!1},d(s){t&&t.d(s)}}}function Rt(n){let e,a,t,s,l,i,o,r,f,u,d,h,p,b;const v=[Ft,St],w=[];function O(_,D){return D&4&&(s=null),s==null&&(s=!!Array.isArray(_[2])),s?0:1}l=O(n,-1),i=w[l]=v[l](n);const g=n[18].headerActions,m=Xe(g,n,n[17],Ke);h=new Ct({props:{chartOptions:n[4],onclick:n[7]}});let k=n[8].footer&&Ge(n);return{c(){e=R("div"),a=R("div"),t=R("div"),i.c(),o=$(),r=R("div"),m&&m.c(),f=$(),u=R("div"),d=R("div"),ne(h.$$.fragment),p=$(),k&&k.c(),this.h()},l(_){e=S(_,"DIV",{class:!0});var D=F(e);a=S(D,"DIV",{class:!0});var E=F(a);t=S(E,"DIV",{class:!0});var y=F(t);i.l(y),y.forEach(C),o=Z(E),r=S(E,"DIV",{});var c=F(r);m&&m.l(c),c.forEach(C),E.forEach(C),f=Z(D),u=S(D,"DIV",{class:!0});var N=F(u);d=S(N,"DIV",{class:!0});var U=F(d);ae(h.$$.fragment,U),U.forEach(C),N.forEach(C),p=Z(D),k&&k.l(D),D.forEach(C),this.h()},h(){H(t,"class","flex justify-center gap-4 md:items-center md:justify-start"),H(a,"class","flex flex-col gap-4 sm:flex-row sm:flex-wrap sm:justify-between"),H(d,"class","absolute top-0 right-0 bottom-0 left-0"),H(u,"class","relative min-h-[200px] grow"),H(e,"class","flex min-h-full grow flex-col gap-2")},m(_,D){G(_,e,D),T(e,a),T(a,t),w[l].m(t,null),T(a,o),T(a,r),m&&m.m(r,null),T(e,f),T(e,u),T(u,d),te(h,d,null),T(e,p),k&&k.m(e,null),b=!0},p(_,[D]){let E=l;l=O(_,D),l===E?w[l].p(_,D):(ce(),L(w[E],1,1,()=>{w[E]=null}),fe(),i=w[l],i?i.p(_,D):(i=w[l]=v[l](_),i.c()),I(i,1),i.m(t,null)),m&&m.p&&(!b||D&131072)&&ze(m,g,_,_[17],b?Je(g,_[17],D,Mt):Qe(_[17]),Ke);const y={};D&16&&(y.chartOptions=_[4]),h.$set(y),_[8].footer?k?(k.p(_,D),D&256&&I(k,1)):(k=Ge(_),k.c(),I(k,1),k.m(e,null)):k&&(ce(),L(k,1,1,()=>{k=null}),fe())},i(_){b||(I(i),I(m,_),I(h.$$.fragment,_),I(k),b=!0)},o(_){L(i),L(m,_),L(h.$$.fragment,_),L(k),b=!1},d(_){_&&C(e),w[l].d(),m&&m.d(_),ee(h),k&&k.d()}}}const xe={PLAIN:"PLAIN",REPARTITION:"REPARTITION"};function Bt(n,e,a){let{$$slots:t={},$$scope:s}=e;const l=rt(t);let{type:i=xe.PLAIN}=e,{showAverageMarkline:o=!1}=e,{unit:r=le.UNDEFINED}=e,{aggregation:f=W.UNDEFINED}=e,{maximumFractionDigits:u=Ze}=e,{color:d=J}=e,{timeseries:h=[]}=e,{referencePower:p=void 0}=e,{referencePowerOptions:b=ft}=e,{labels:v=["Consumption","Exceedance"]}=e,{onclick:w=ut}=e,O=!1,g=[0,NaN],m={color:[],categories:[],series:[]};const k=(c,N,U,x,j,se,P,X,et)=>{O=_(U,x);const ye=!!X,ue=c===xe.REPARTITION;let he=0,pe=0;const z=P.reduce((A,V)=>{const{startedAt:K,value:B=NaN,anotherValue:M=NaN}=V;return he+=B??0,pe+=M??0,A.startedAtData.push(K),ue?(A.valueData.push(B),A.anotherValueData.push(M),A):(A.valueData.push(B),A)},{startedAtData:[],valueData:[],anotherValueData:[]});if(a(4,m.color=Array.isArray(se)?se:[se],m),a(4,m.categories=z.startedAtData,m),ue||ye){a(3,g=[he,pe]);const A={type:"bar",stack:"energy",name:v[0],data:z.valueData},V={type:"bar",stack:"energy",name:v[1],data:z.anotherValueData};a(4,m.series=[A,V],m)}else{a(3,g=[he,NaN]);const A={type:"bar",data:z.valueData};a(4,m.series=[A],m)}m.series.forEach(A=>{if(N){let V=A.markLine;const K={type:"average",label:{fontWeight:"bold",position:"insideEndTop",backgroundColor:"white",padding:2,borderRadius:5,textBorderColor:"white",textBorderWidth:3,formatter:B=>q(B.value,j)}};if(V){const{symbol:B=Re,data:M=[]}=V;A.markLine={symbol:B,data:[...M,K]}}else A.markLine={symbol:Re,data:[K]}}A.cursor=O?"zoom-in":"default"}),console.log("EnergyChart.updateChartOptions",{type:c,showAverageMarkline:N,unit:U,aggregation:x,maximumFractionDigits:j,timeseries:P,isDrilldownEnabled:O,hasReferencePower:ye,referencePower:X,referencePowerOptions:et,data:z});let re=ht,oe=A=>mt(A.startedAt);switch(x){case W.MONTH:re=Be,oe=A=>Be(A.startedAt);break;case W.WEEK:re=Q,oe=A=>`${Q(A.startedAt)} - ${Q(A.endedAt)}`;break;case W.DAY:re=Q,oe=A=>Q(A.startedAt);break}a(4,m.xAxisLabelFormatter=re,m),a(4,m.tooltipFormatter=A=>{const V=A;let K=P[V[0].dataIndex],B=0,M="";return M+=`<div>${oe(K)}</div>`,V.reverse().forEach(me=>{K=P[me.dataIndex];const we=me.value;B+=we,M+=_t({color:me.color,value:`${q(we,j)} ${U}`})}),ue&&(M+='<div style="padding-top: 5px;"><hr>',M+=`<span style="float:right;margin-left:20px;font-weight:600">${q(B,j)} ${U}</span>`,M+="</div>"),M},m)},_=(c,N)=>{switch(c){case le.M3:return![W.HOUR,W.MINUTES,W.UNDEFINED].includes(N);case le.KW:case le.KWH:return![W.MINUTES,W.UNDEFINED].includes(N);default:return!1}},D=(c=0)=>Array.isArray(v)?v[c]??"":v,E=(c=0)=>{let N=J;return d&&(N=Array.isArray(d)?d[c]??J:c===0?d:J),N},y=c=>{c.data&&w(h[c.dataIndex])};return n.$$set=c=>{"type"in c&&a(9,i=c.type),"showAverageMarkline"in c&&a(10,o=c.showAverageMarkline),"unit"in c&&a(0,r=c.unit),"aggregation"in c&&a(11,f=c.aggregation),"maximumFractionDigits"in c&&a(1,u=c.maximumFractionDigits),"color"in c&&a(12,d=c.color),"timeseries"in c&&a(13,h=c.timeseries),"referencePower"in c&&a(14,p=c.referencePower),"referencePowerOptions"in c&&a(15,b=c.referencePowerOptions),"labels"in c&&a(2,v=c.labels),"onclick"in c&&a(16,w=c.onclick),"$$scope"in c&&a(17,s=c.$$scope)},n.$$.update=()=>{n.$$.dirty&65027&&k(i,o,r,f,u,d,h,p,b)},[r,u,v,g,m,D,E,y,l,i,o,f,d,h,p,b,w,s,t]}class Kt extends De{constructor(e){super(),Ae(this,e,Bt,Rt,ve,{type:9,showAverageMarkline:10,unit:0,aggregation:11,maximumFractionDigits:1,color:12,timeseries:13,referencePower:14,referencePowerOptions:15,labels:2,onclick:16})}}export{W as A,Kt as E,le as U,xe as a,Ht as b,Ue as e,dt as o,gt as u};
